<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VA Driving Clinic - Inclement Weather Simulation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --color-primary: #5f17eb;
            --color-primary-soft: #8a5feb;
            --color-secondary: #000000;
            --color-success: #10b981;
            --color-error: #ef4444;
            --color-warning: #f59e0b;
            --color-info: #3b82f6;
            --color-bg: #ffffff;
            --color-text: #000000;
            --color-muted: #6b7280;
            --color-light: #f9fafb;
            --radius-lg: 20px;
            --radius-md: 12px;
            --radius-sm: 8px;
            --shadow-soft: 0 10px 30px rgba(95, 23, 235, 0.1);
            --shadow-hover: 0 15px 35px rgba(95, 23, 235, 0.15);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 15px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            color: var(--color-text);
            line-height: 1.6;
            min-height: 100vh;
        }

        @media (max-width: 600px) {
            body { padding: 10px; }
        }

        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes rain {
            0% { transform: translateY(-100px); }
            100% { transform: translateY(100vh); }
        }

        @keyframes snow {
            0% { transform: translateY(-100px) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(360deg); }
        }

        @keyframes fog {
            0% { opacity: 0.3; }
            50% { opacity: 0.7; }
            100% { opacity: 0.3; }
        }

        /* Main Container */
        .page {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            background: var(--color-bg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 20px;
            animation: fadeInUp 0.8s ease-out;
            border: 1px solid rgba(95, 23, 235, 0.1);
        }

        /* Header */
        .brand-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .brand-logo {
            height: 40px;
            width: auto;
            transition: transform 0.3s ease;
        }

        .course-meta {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .course-name {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--color-primary);
            font-weight: 700;
        }

        .week-label {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 999px;
            background: rgba(95, 23, 235, 0.1);
            font-size: 0.7rem;
            color: var(--color-primary);
            font-weight: 600;
            border: 1px solid rgba(95, 23, 235, 0.2);
        }

        .week-label-dot {
            width: 6px;
            height: 6px;
            border-radius: 999px;
            background: var(--color-primary);
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }

        .badge-mode {
            padding: 4px 8px;
            border-radius: 999px;
            background: rgba(95, 23, 235, 0.08);
            border: 1px solid rgba(95, 23, 235, 0.15);
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-primary);
            white-space: nowrap;
            font-weight: 600;
        }

        h1 {
            font-size: 1.4rem;
            line-height: 1.1;
            color: var(--color-text);
            margin-bottom: 8px;
        }

        .module-subtitle {
            font-size: 0.85rem;
            color: var(--color-muted);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* Time Banner */
        .time-banner {
            background: linear-gradient(135deg, rgba(95, 23, 235, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%);
            border: 2px solid rgba(95, 23, 235, 0.2);
            border-radius: var(--radius-md);
            padding: 10px 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .time-icon {
            font-size: 1rem;
            color: var(--color-primary);
            background: rgba(95, 23, 235, 0.1);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .time-content h3 {
            color: var(--color-primary);
            font-size: 0.8rem;
            margin-bottom: 3px;
            font-weight: 700;
        }

        .time-content p {
            color: var(--color-text);
            font-size: 0.75rem;
            margin: 0;
        }

        .time-highlight {
            color: var(--color-primary);
            font-weight: 800;
            font-size: 0.9em;
        }

        /* Weather Selector */
        .weather-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .weather-btn {
            padding: 12px;
            background: rgba(95, 23, 235, 0.05);
            border: 2px solid rgba(95, 23, 235, 0.1);
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            color: var(--color-primary);
            font-size: 0.8rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .weather-btn:hover {
            background: rgba(95, 23, 235, 0.1);
            transform: translateY(-2px);
        }

        .weather-btn.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
            animation: pulse 2s infinite;
        }

        .weather-icon {
            font-size: 1.2rem;
        }

        /* Driving Simulation */
        .driving-simulation {
            background: var(--color-light);
            border-radius: var(--radius-md);
            padding: 15px;
            border: 2px solid rgba(95, 23, 235, 0.1);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            min-height: 400px;
        }

        .simulation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .weather-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--color-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .weather-icon-large {
            font-size: 1.4rem;
        }

        .simulation-time {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--color-muted);
            background: white;
            padding: 4px 10px;
            border-radius: 20px;
            border: 1px solid rgba(95, 23, 235, 0.1);
        }

        /* Road Visualization */
        .road-visualization {
            width: 100%;
            height: 200px;
            background: #2a2a2a;
            border-radius: var(--radius-sm);
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
            border: 3px solid #333;
        }

        .road-lane {
            position: absolute;
            width: 100%;
            height: 2px;
            background: repeating-linear-gradient(
                90deg,
                #ffffff 0,
                #ffffff 20px,
                transparent 20px,
                transparent 40px
            );
        }

        .car {
            position: absolute;
            width: 40px;
            height: 25px;
            background: var(--color-primary);
            border-radius: 4px;
            transition: all 0.5s ease;
            z-index: 10;
        }

        .player-car {
            background: var(--color-success);
            z-index: 20;
        }

        .other-car {
            background: var(--color-warning);
        }

        .water-effect {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        .rain-drop {
            position: absolute;
            width: 2px;
            height: 20px;
            background: rgba(59, 130, 246, 0.7);
            animation: rain linear infinite;
        }

        .snow-flake {
            position: absolute;
            width: 10px;
            height: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: snow linear infinite;
        }

        .fog-layer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.3);
            animation: fog 3s ease-in-out infinite;
            pointer-events: none;
        }

        .ice-effect {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(0deg, rgba(173, 216, 230, 0.2) 0%, transparent 100%);
            pointer-events: none;
        }

        /* Controls Panel */
        .controls-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .control-btn {
            padding: 10px;
            background: white;
            border: 2px solid rgba(95, 23, 235, 0.2);
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.75rem;
            text-align: center;
            color: var(--color-primary);
        }

        .control-btn:hover {
            background: rgba(95, 23, 235, 0.1);
            border-color: var(--color-primary);
        }

        .control-btn.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        /* Hazard Dashboard */
        .hazard-dashboard {
            background: rgba(95, 23, 235, 0.05);
            border-radius: var(--radius-md);
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--color-primary);
        }

        .hazard-title {
            color: var(--color-primary);
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hazard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
        }

        .hazard-stat {
            padding: 10px;
            background: white;
            border-radius: var(--radius-sm);
            border: 1px solid rgba(95, 23, 235, 0.1);
            text-align: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 900;
            color: var(--color-primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--color-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* Decision Making */
        .decision-making {
            background: rgba(95, 23, 235, 0.03);
            border-radius: var(--radius-md);
            padding: 15px;
            margin-bottom: 15px;
            border: 2px dashed rgba(95, 23, 235, 0.2);
        }

        .decision-title {
            color: var(--color-primary);
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .decision-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .decision-option {
            padding: 12px;
            background: white;
            border: 2px solid rgba(95, 23, 235, 0.1);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            color: var(--color-text);
        }

        .decision-option:hover {
            border-color: var(--color-primary);
            transform: translateX(5px);
        }

        .decision-option.correct {
            border-color: var(--color-success);
            background: rgba(16, 185, 129, 0.1);
            color: var(--color-success);
        }

        .decision-option.incorrect {
            border-color: var(--color-error);
            background: rgba(239, 68, 68, 0.1);
            color: var(--color-error);
        }

        /* Safety Tips */
        .safety-tips {
            background: rgba(95, 23, 235, 0.05);
            border-radius: var(--radius-md);
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid var(--color-success);
            display: none;
        }

        .safety-tips.show {
            display: block;
            animation: fadeInUp 0.5s ease;
        }

        .tips-title {
            color: var(--color-success);
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tips-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .tips-list li {
            font-size: 0.8rem;
            color: var(--color-text);
            line-height: 1.5;
            display: flex;
            gap: 8px;
            align-items: flex-start;
        }

        .tip-icon {
            width: 20px;
            height: 20px;
            background: var(--color-success);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* Results Display */
        .results-display {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: white;
            border-radius: var(--radius-md);
            padding: 20px;
            margin-top: 20px;
            display: none;
            border: 2px solid var(--color-primary);
        }

        .results-display.show {
            display: block;
            animation: fadeInUp 0.6s ease;
        }

        .results-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .results-header h3 {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .results-score {
            font-size: 2rem;
            font-weight: 900;
            color: var(--color-primary);
            text-shadow: 0 0 15px rgba(95, 23, 235, 0.7);
            animation: pulse 2s infinite;
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .result-stat {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 15px;
            text-align: center;
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--color-primary);
            margin-bottom: 5px;
        }

        .result-label {
            font-size: 0.75rem;
            color: #e5e7eb;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .weather-mastery {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 15px;
            border-left: 4px solid var(--color-primary);
        }

        .mastery-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mastery-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .mastery-list li {
            font-size: 0.8rem;
            color: #e5e7eb;
            line-height: 1.5;
            display: flex;
            gap: 8px;
            align-items: flex-start;
        }

        .mastery-dot {
            width: 6px;
            height: 6px;
            background: var(--color-primary);
            border-radius: 50%;
            margin-top: 6px;
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border-radius: var(--radius-md);
            border: none;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
            border: 2px solid var(--color-primary);
        }

        .btn-primary:hover {
            background: #4c0fcf;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(95, 23, 235, 0.3);
        }

        .btn-secondary {
            background: white;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .btn-secondary:hover {
            background: rgba(95, 23, 235, 0.1);
            transform: translateY(-2px);
        }

        .btn-icon {
            font-size: 1em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <main class="page">
        <!-- Header -->
        <header class="brand-row">
            <div class="brand">
                <img
                    src="https://lwfiles.mycourse.app/vadrivingclinic-public/9f5c6b8121721c8ef241f929fd983b3e.png"
                    alt="VA Driving Clinic logo"
                    class="brand-logo"
                />
                <div class="course-meta">
                    <span class="course-name">VA Driving Clinic ‚Ä¢ Quick Simulation</span>
                    <div class="week-label">
                        <span class="week-label-dot"></span>
                        <span>Inclement Weather</span>
                    </div>
                </div>
            </div>
            <span class="badge-mode">5-Min Challenge</span>
        </header>

        <h1>Inclement Weather Driving Challenge</h1>
        <p class="module-subtitle">
            Experience 4 different weather conditions in 5 minutes. Learn to adapt your driving
            for rain, snow, fog, and ice through interactive decision-making.
        </p>

        <!-- Time Banner -->
        <div class="time-banner">
            <div class="time-icon">
                ‚è±Ô∏è
            </div>
            <div class="time-content">
                <h3>5-Minute Weather Simulation</h3>
                <p>Complete all 4 weather challenges in <span class="time-highlight">5 minutes</span> to master safe driving in adverse conditions.</p>
            </div>
        </div>

        <!-- Weather Selector -->
        <div class="weather-selector">
            <button class="weather-btn active" data-weather="rain">
                <span class="weather-icon">üåßÔ∏è</span>
                Rain Challenge
            </button>
            <button class="weather-btn" data-weather="snow">
                <span class="weather-icon">‚ùÑÔ∏è</span>
                Snow Challenge
            </button>
            <button class="weather-btn" data-weather="fog">
                <span class="weather-icon">üå´Ô∏è</span>
                Fog Challenge
            </button>
            <button class="weather-btn" data-weather="ice">
                <span class="weather-icon">üßä</span>
                Ice Challenge
            </button>
        </div>

        <!-- Driving Simulation -->
        <div class="driving-simulation" id="weather-simulation">
            <div class="simulation-header">
                <div class="weather-title">
                    <span class="weather-icon-large" id="weather-icon">üåßÔ∏è</span>
                    <span id="weather-title">Heavy Rain Challenge</span>
                </div>
                <div class="simulation-time">Time: <span id="weather-time">0:00</span></div>
            </div>

            <!-- Road Visualization -->
            <div class="road-visualization" id="road-visualization">
                <!-- Weather effects and road elements added by JavaScript -->
            </div>

            <!-- Hazard Dashboard -->
            <div class="hazard-dashboard">
                <div class="hazard-title">‚ö†Ô∏è Hazard Monitoring</div>
                <div class="hazard-stats">
                    <div class="hazard-stat">
                        <div class="stat-value" id="traction-level">85%</div>
                        <div class="stat-label">Traction</div>
                    </div>
                    <div class="hazard-stat">
                        <div class="stat-value" id="visibility-level">60%</div>
                        <div class="stat-label">Visibility</div>
                    </div>
                    <div class="hazard-stat">
                        <div class="stat-value" id="stopping-distance">+40%</div>
                        <div class="stat-label">Stopping Distance</div>
                    </div>
                    <div class="hazard-stat">
                        <div class="stat-value" id="risk-level">High</div>
                        <div class="stat-label">Risk Level</div>
                    </div>
                </div>
            </div>

            <!-- Controls Panel -->
            <div class="controls-panel">
                <button class="control-btn" data-action="slow-down">‚¨áÔ∏è Slow Down</button>
                <button class="control-btn" data-action="maintain">‚è±Ô∏è Maintain Speed</button>
                <button class="control-btn active" data-action="lights">üöó Use Headlights</button>
                <button class="control-btn" data-action="distance">‚ÜîÔ∏è Increase Distance</button>
                <button class="control-btn" data-action="defrost">üå´Ô∏è Defrost Windows</button>
                <button class="control-btn" data-action="wipers">üåÄ Use Wipers</button>
            </div>

            <!-- Decision Making -->
            <div class="decision-making">
                <div class="decision-title">‚ùì Critical Decision Point</div>
                <div class="decision-options" id="decision-options">
                    <!-- Decision options populated by JavaScript -->
                </div>
            </div>

            <!-- Safety Tips -->
            <div class="safety-tips" id="safety-tips">
                <div class="tips-title">üí° Weather-Specific Safety Tips</div>
                <ul class="tips-list" id="tips-list">
                    <!-- Tips populated by JavaScript -->
                </ul>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary" id="start-challenge">
                    <span class="btn-icon">‚ñ∂</span>
                    Start Challenge
                </button>
                <button class="btn btn-secondary" id="next-weather">
                    <span class="btn-icon">‚Üí</span>
                    Next Weather Condition
                </button>
                <button class="btn btn-secondary" id="show-results" style="display: none;">
                    <span class="btn-icon">üìä</span>
                    View Final Results
                </button>
            </div>
        </div>

        <!-- Results Display -->
        <div class="results-display" id="results-display">
            <div class="results-header">
                <h3>Weather Driving Mastery</h3>
                <div class="results-score" id="final-score">0%</div>
                <p style="color: #e5e7eb; font-size: 0.8rem;">Your performance across all weather conditions</p>
            </div>
            
            <div class="results-stats">
                <div class="result-stat">
                    <div class="result-value" id="rain-score">0%</div>
                    <div class="result-label">Rain Score</div>
                </div>
                <div class="result-stat">
                    <div class="result-value" id="snow-score">0%</div>
                    <div class="result-label">Snow Score</div>
                </div>
                <div class="result-stat">
                    <div class="result-value" id="fog-score">0%</div>
                    <div class="result-label">Fog Score</div>
                </div>
                <div class="result-stat">
                    <div class="result-value" id="ice-score">0%</div>
                    <div class="result-label">Ice Score</div>
                </div>
            </div>

            <div class="weather-mastery">
                <div class="mastery-title">üéØ Key Safety Principles Mastered</div>
                <ul class="mastery-list">
                    <li>
                        <span class="mastery-dot"></span>
                        <span><strong>Speed Adjustment:</strong> Reduced speed by 30-50% in adverse conditions</span>
                    </li>
                    <li>
                        <span class="mastery-dot"></span>
                        <span><strong>Increased Following Distance:</strong> Doubled or tripled stopping distance from other vehicles</span>
                    </li>
                    <li>
                        <span class="mastery-dot"></span>
                        <span><strong>Proper Lighting:</strong> Used appropriate headlights/fog lights for each condition</span>
                    </li>
                    <li>
                        <span class="mastery-dot"></span>
                        <span><strong>Smooth Control Inputs:</strong> Avoided sudden braking, acceleration, or steering</span>
                    </li>
                    <li>
                        <span class="mastery-dot"></span>
                        <span><strong>Hazard Anticipation:</strong> Successfully identified and responded to weather-specific risks</span>
                    </li>
                </ul>
            </div>

            <div class="action-buttons" style="margin-top: 20px;">
                <button class="btn btn-primary" id="retake-challenge">
                    <span class="btn-icon">üîÑ</span>
                    Retake Challenge
                </button>
                <button class="btn btn-secondary" onclick="window.print()">
                    <span class="btn-icon">üñ®Ô∏è</span>
                    Print Certificate
                </button>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Weather Data Configuration
            const weatherConditions = {
                rain: {
                    title: "Heavy Rain Challenge",
                    icon: "üåßÔ∏è",
                    hazards: {
                        traction: 65,
                        visibility: 50,
                        stoppingDistance: 50,
                        risk: "High"
                    },
                    decisions: [
                        {
                            question: "You approach a large puddle on the road. What should you do?",
                            options: [
                                "A. Speed up to get through quickly",
                                "B. Slow down and avoid if possible",
                                "C. Maintain speed and drive straight through",
                                "D. Stop completely before the puddle"
                            ],
                            correct: "B",
                            explanation: "Slow down to avoid hydroplaning. If unavoidable, drive through slowly."
                        },
                        {
                            question: "Your wipers are on high but visibility is still poor. What's your next action?",
                            options: [
                                "A. Pull over safely and wait for rain to lighten",
                                "B. Drive slower and get closer to see better",
                                "C. Use high beams to see further",
                                "D. Increase speed to reach destination faster"
                            ],
                            correct: "A",
                            explanation: "When visibility is severely reduced, the safest option is to pull over until conditions improve."
                        }
                    ],
                    tips: [
                        "Reduce speed by at least 20-30%",
                        "Turn on headlights (not just daytime running lights)",
                        "Increase following distance to 4+ seconds",
                        "Avoid using cruise control",
                        "Be prepared for sudden hydroplaning"
                    ]
                },
                snow: {
                    title: "Snow Storm Challenge",
                    icon: "‚ùÑÔ∏è",
                    hazards: {
                        traction: 40,
                        visibility: 60,
                        stoppingDistance: 100,
                        risk: "Very High"
                    },
                    decisions: [
                        {
                            question: "You start to skid on an icy patch. What should you do?",
                            options: [
                                "A. Slam on the brakes",
                                "B. Steer into the skid and ease off accelerator",
                                "C. Accelerate to regain control",
                                "D. Turn wheel sharply opposite direction"
                            ],
                            correct: "B",
                            explanation: "Steer in the direction you want to go and gently ease off the accelerator."
                        },
                        {
                            question: "You're driving uphill in deep snow and wheels start spinning. What do you do?",
                            options: [
                                "A. Floor the accelerator to power through",
                                "B. Rock the vehicle back and forth",
                                "C. Gently ease off and try again with less power",
                                "D. Turn around and find another route"
                            ],
                            correct: "C",
                            explanation: "Excessive acceleration causes wheel spin. Use gentle pressure on accelerator."
                        }
                    ],
                    tips: [
                        "Reduce speed by 50% or more",
                        "Accelerate and decelerate slowly",
                        "Increase following distance to 5-6 seconds",
                        "Clear ALL snow from windows, lights, and roof",
                        "Use winter tires for better traction"
                    ]
                },
                fog: {
                    title: "Dense Fog Challenge",
                    icon: "üå´Ô∏è",
                    hazards: {
                        traction: 80,
                        visibility: 30,
                        stoppingDistance: 60,
                        risk: "Extreme"
                    },
                    decisions: [
                        {
                            question: "What lights should you use in dense fog?",
                            options: [
                                "A. High beams only",
                                "B. Low beams or fog lights",
                                "C. Parking lights only",
                                "D. No lights to reduce glare"
                            ],
                            correct: "B",
                            explanation: "Low beams or fog lights provide better visibility. High beams reflect off fog."
                        },
                        {
                            question: "You can barely see the taillights of the car ahead. What should you do?",
                            options: [
                                "A. Get closer so you can see better",
                                "B. Pull over safely and wait for fog to lift",
                                "C. Use emergency flashers and continue slowly",
                                "D. Speed up to get through fog faster"
                            ],
                            correct: "B",
                            explanation: "When visibility is severely limited, the safest option is to pull over until conditions improve."
                        }
                    ],
                    tips: [
                        "Use low beam headlights or fog lights",
                        "Reduce speed significantly",
                        "Increase following distance dramatically",
                        "Use right edge of road as guide (not center line)",
                        "Listen for traffic you can't see"
                    ]
                },
                ice: {
                    title: "Black Ice Challenge",
                    icon: "üßä",
                    hazards: {
                        traction: 20,
                        visibility: 80,
                        stoppingDistance: 150,
                        risk: "Extreme"
                    },
                    decisions: [
                        {
                            question: "You encounter black ice on a bridge. What's the safest response?",
                            options: [
                                "A. Brake hard to stop quickly",
                                "B. Steer gently and don't brake",
                                "C. Accelerate to maintain control",
                                "D. Make sharp steering corrections"
                            ],
                            correct: "B",
                            explanation: "On ice, avoid braking. Steer gently in desired direction and let vehicle slow naturally."
                        },
                        {
                            question: "The temperature is 34¬∞F and roads look wet. What should you suspect?",
                            options: [
                                "A. Normal wet roads, drive normally",
                                "B. Possible black ice, reduce speed",
                                "C. Ice only forms below freezing",
                                "D. Roads are safer when wet"
                            ],
                            correct: "B",
                            explanation: "Black ice can form at temperatures slightly above freezing, especially on bridges and overpasses."
                        }
                    ],
                    tips: [
                        "Assume ice on bridges and overpasses first",
                        "Avoid sudden steering, braking, or acceleration",
                        "Increase following distance to 8+ seconds",
                        "Test traction gently when starting",
                        "Consider postponing trip if possible"
                    ]
                }
            };

            // State Management
            const state = {
                currentWeather: 'rain',
                weatherScores: {
                    rain: 0,
                    snow: 0,
                    fog: 0,
                    ice: 0
                },
                weatherCompleted: {
                    rain: false,
                    snow: false,
                    fog: false,
                    ice: false
                },
                currentDecision: 0,
                timer: null,
                elapsedTime: 0,
                decisionsMade: 0,
                correctDecisions: 0
            };

            // DOM Elements
            const weatherBtns = document.querySelectorAll('.weather-btn');
            const startBtn = document.getElementById('start-challenge');
            const nextBtn = document.getElementById('next-weather');
            const showResultsBtn = document.getElementById('show-results');
            const retakeBtn = document.getElementById('retake-challenge');
            const resultsDisplay = document.getElementById('results-display');
            
            const weatherTitle = document.getElementById('weather-title');
            const weatherIcon = document.getElementById('weather-icon');
            const weatherTime = document.getElementById('weather-time');
            const roadVisualization = document.getElementById('road-visualization');
            const decisionOptions = document.getElementById('decision-options');
            const safetyTips = document.getElementById('safety-tips');
            const tipsList = document.getElementById('tips-list');
            
            // Hazard display elements
            const tractionLevel = document.getElementById('traction-level');
            const visibilityLevel = document.getElementById('visibility-level');
            const stoppingDistance = document.getElementById('stopping-distance');
            const riskLevel = document.getElementById('risk-level');
            
            // Results elements
            const finalScore = document.getElementById('final-score');
            const rainScoreEl = document.getElementById('rain-score');
            const snowScoreEl = document.getElementById('snow-score');
            const fogScoreEl = document.getElementById('fog-score');
            const iceScoreEl = document.getElementById('ice-score');

            // Control buttons
            const controlBtns = document.querySelectorAll('.control-btn');

            // Weather Selection
            weatherBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const weather = btn.dataset.weather;
                    
                    // Update buttons
                    weatherBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Update weather
                    state.currentWeather = weather;
                    loadWeatherCondition(weather);
                    
                    // Reset timer and decisions for new weather
                    if (state.timer) {
                        clearInterval(state.timer);
                        state.timer = null;
                    }
                    state.currentDecision = 0;
                    state.elapsedTime = 0;
                    
                    // Reset UI
                    startBtn.disabled = false;
                    startBtn.innerHTML = '<span class="btn-icon">‚ñ∂</span> Start Challenge';
                    safetyTips.classList.remove('show');
                    
                    // Update time display
                    weatherTime.textContent = '0:00';
                });
            });

            // Load weather condition
            function loadWeatherCondition(weather) {
                const condition = weatherConditions[weather];
                
                // Update display
                weatherTitle.textContent = condition.title;
                weatherIcon.textContent = condition.icon;
                
                // Update hazard dashboard
                tractionLevel.textContent = `${condition.hazards.traction}%`;
                visibilityLevel.textContent = `${condition.hazards.visibility}%`;
                stoppingDistance.textContent = `+${condition.hazards.stoppingDistance}%`;
                riskLevel.textContent = condition.hazards.risk;
                
                // Update tips
                tipsList.innerHTML = '';
                condition.tips.forEach((tip, index) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span class="tip-icon">${index + 1}</span>
                        <span>${tip}</span>
                    `;
                    tipsList.appendChild(li);
                });
                
                // Update decisions
                loadDecision(0);
                
                // Create road visualization
                createRoadVisualization(weather);
            }

            // Create road visualization with weather effects
            function createRoadVisualization(weather) {
                roadVisualization.innerHTML = '';
                
                // Create road lanes
                for (let i = 0; i < 2; i++) {
                    const lane = document.createElement('div');
                    lane.className = 'road-lane';
                    lane.style.top = `${70 + i * 40}px`;
                    roadVisualization.appendChild(lane);
                }
                
                // Create player car
                const playerCar = document.createElement('div');
                playerCar.className = 'car player-car';
                playerCar.style.left = '100px';
                playerCar.style.top = '70px';
                roadVisualization.appendChild(playerCar);
                
                // Create other car
                const otherCar = document.createElement('div');
                otherCar.className = 'car other-car';
                otherCar.style.left = '300px';
                otherCar.style.top = '70px';
                roadVisualization.appendChild(otherCar);
                
                // Add weather effects
                const weatherEffect = document.createElement('div');
                weatherEffect.className = 'water-effect';
                
                switch(weather) {
                    case 'rain':
                        // Create rain drops
                        for (let i = 0; i < 50; i++) {
                            const drop = document.createElement('div');
                            drop.className = 'rain-drop';
                            drop.style.left = `${Math.random() * 100}%`;
                            drop.style.animationDuration = `${0.5 + Math.random() * 1}s`;
                            drop.style.animationDelay = `${Math.random() * 2}s`;
                            weatherEffect.appendChild(drop);
                        }
                        break;
                        
                    case 'snow':
                        // Create snow flakes
                        for (let i = 0; i < 30; i++) {
                            const flake = document.createElement('div');
                            flake.className = 'snow-flake';
                            flake.style.left = `${Math.random() * 100}%`;
                            flake.style.animationDuration = `${3 + Math.random() * 5}s`;
                            flake.style.animationDelay = `${Math.random() * 3}s`;
                            weatherEffect.appendChild(flake);
                        }
                        // Add snow on road
                        const snowLayer = document.createElement('div');
                        snowLayer.style.position = 'absolute';
                        snowLayer.style.bottom = '0';
                        snowLayer.style.left = '0';
                        snowLayer.style.right = '0';
                        snowLayer.style.height = '30px';
                        snowLayer.style.background = 'linear-gradient(0deg, rgba(255,255,255,0.8) 0%, transparent 100%)';
                        roadVisualization.appendChild(snowLayer);
                        break;
                        
                    case 'fog':
                        // Create fog layer
                        const fogLayer = document.createElement('div');
                        fogLayer.className = 'fog-layer';
                        weatherEffect.appendChild(fogLayer);
                        break;
                        
                    case 'ice':
                        // Create ice effect
                        const iceLayer = document.createElement('div');
                        iceLayer.className = 'ice-effect';
                        weatherEffect.appendChild(iceLayer);
                        
                        // Add reflective shine
                        const shine = document.createElement('div');
                        shine.style.position = 'absolute';
                        shine.style.top = '0';
                        shine.style.left = '0';
                        shine.style.right = '0';
                        shine.style.bottom = '0';
                        shine.style.background = 'radial-gradient(circle at 30% 30%, rgba(255,255,255,0.1) 0%, transparent 70%)';
                        weatherEffect.appendChild(shine);
                        break;
                }
                
                roadVisualization.appendChild(weatherEffect);
                
                // Animate scene
                animateWeatherScene(weather);
            }

            function animateWeatherScene(weather) {
                const otherCar = roadVisualization.querySelector('.other-car');
                
                if (otherCar) {
                    const currentLeft = parseInt(otherCar.style.left);
                    let newLeft;
                    
                    // Different movement patterns for different weather
                    switch(weather) {
                        case 'rain':
                            newLeft = (currentLeft + 2) % 700;
                            break;
                        case 'snow':
                            newLeft = (currentLeft + 1) % 700; // Slower in snow
                            break;
                        case 'fog':
                            newLeft = (currentLeft + 1.5) % 700;
                            break;
                        case 'ice':
                            // Simulate sliding on ice
                            newLeft = (currentLeft + (Math.random() > 0.5 ? 2.5 : 1.5)) % 700;
                            break;
                        default:
                            newLeft = (currentLeft + 2) % 700;
                    }
                    
                    otherCar.style.left = `${newLeft}px`;
                }
                
                // Continue animation
                requestAnimationFrame(() => animateWeatherScene(weather));
            }

            // Load decision
            function loadDecision(decisionIndex) {
                const condition = weatherConditions[state.currentWeather];
                const decision = condition.decisions[decisionIndex];
                
                decisionOptions.innerHTML = '';
                
                // Create question element
                const question = document.createElement('div');
                question.className = 'decision-title';
                question.textContent = decision.question;
                decisionOptions.appendChild(question);
                
                // Create options
                decision.options.forEach(optionText => {
                    const option = document.createElement('div');
                    option.className = 'decision-option';
                    option.textContent = optionText;
                    option.dataset.option = optionText.charAt(0);
                    
                    option.addEventListener('click', () => {
                        if (state.timer) {
                            checkDecision(option, decision.correct, decision.explanation);
                        }
                    });
                    
                    decisionOptions.appendChild(option);
                });
                
                state.currentDecision = decisionIndex;
            }

            // Check decision
            function checkDecision(selectedOption, correctAnswer, explanation) {
                const options = decisionOptions.querySelectorAll('.decision-option');
                
                // Disable all options
                options.forEach(opt => {
                    opt.style.pointerEvents = 'none';
                });
                
                // Mark correct/incorrect
                options.forEach(opt => {
                    if (opt.dataset.option === correctAnswer) {
                        opt.classList.add('correct');
                    }
                    if (opt === selectedOption && opt.dataset.option !== correctAnswer) {
                        opt.classList.add('incorrect');
                        opt.style.animation = 'shake 0.5s ease';
                    }
                });
                
                // Update score
                state.decisionsMade++;
                if (selectedOption.dataset.option === correctAnswer) {
                    state.correctDecisions++;
                }
                
                // Show safety tips after decision
                setTimeout(() => {
                    safetyTips.classList.add('show');
                    
                    // Load next decision or complete weather
                    setTimeout(() => {
                        const condition = weatherConditions[state.currentWeather];
                        if (state.currentDecision < condition.decisions.length - 1) {
                            loadDecision(state.currentDecision + 1);
                        } else {
                            completeWeatherCondition();
                        }
                    }, 3000);
                }, 1000);
            }

            // Complete weather condition
            function completeWeatherCondition() {
                // Stop timer
                if (state.timer) {
                    clearInterval(state.timer);
                    state.timer = null;
                }
                
                // Calculate score for this weather
                const decisionScore = state.decisionsMade > 0 ? 
                    (state.correctDecisions / state.decisionsMade) * 100 : 0;
                const timeScore = Math.max(0, 100 - (state.elapsedTime / 10));
                const weatherScore = Math.round((decisionScore + timeScore) / 2);
                
                state.weatherScores[state.currentWeather] = weatherScore;
                state.weatherCompleted[state.currentWeather] = true;
                
                // Update button text
                nextBtn.textContent = 'Next Weather Condition';
                nextBtn.disabled = false;
                
                // Check if all weather conditions completed
                const allCompleted = Object.values(state.weatherCompleted).every(Boolean);
                if (allCompleted) {
                    nextBtn.style.display = 'none';
                    showResultsBtn.style.display = 'inline-flex';
                }
                
                // Reset for next weather
                state.decisionsMade = 0;
                state.correctDecisions = 0;
            }

            // Start challenge
            startBtn.addEventListener('click', () => {
                if (state.timer) return;
                
                // Start timer
                state.elapsedTime = 0;
                state.timer = setInterval(() => {
                    state.elapsedTime++;
                    const minutes = Math.floor(state.elapsedTime / 60);
                    const seconds = state.elapsedTime % 60;
                    weatherTime.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
                
                // Disable start button
                startBtn.disabled = true;
                startBtn.innerHTML = '<span class="btn-icon">‚è≥</span> Challenge Running';
                
                // Enable next button
                nextBtn.disabled = true;
                
                // Load first decision
                loadDecision(0);
            });

            // Next weather condition
            nextBtn.addEventListener('click', () => {
                const weatherOrder = ['rain', 'snow', 'fog', 'ice'];
                const currentIndex = weatherOrder.indexOf(state.currentWeather);
                
                if (currentIndex < weatherOrder.length - 1) {
                    const nextWeather = weatherOrder[currentIndex + 1];
                    document.querySelector(`[data-weather="${nextWeather}"]`).click();
                }
                
                // Reset next button
                nextBtn.disabled = true;
                nextBtn.textContent = 'Start Next Challenge';
            });

            // Show results
            showResultsBtn.addEventListener('click', () => {
                // Calculate final score
                const scores = Object.values(state.weatherScores);
                const averageScore = Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
                
                // Update results display
                finalScore.textContent = `${averageScore}%`;
                rainScoreEl.textContent = `${state.weatherScores.rain}%`;
                snowScoreEl.textContent = `${state.weatherScores.snow}%`;
                fogScoreEl.textContent = `${state.weatherScores.fog}%`;
                iceScoreEl.textContent = `${state.weatherScores.ice}%`;
                
                // Show results
                resultsDisplay.classList.add('show');
                resultsDisplay.scrollIntoView({ behavior: 'smooth' });
            });

            // Retake challenge
            retakeBtn.addEventListener('click', () => {
                // Reset state
                state.weatherScores = { rain: 0, snow: 0, fog: 0, ice: 0 };
                state.weatherCompleted = { rain: false, snow: false, fog: false, ice: false };
                state.currentWeather = 'rain';
                state.currentDecision = 0;
                state.elapsedTime = 0;
                state.decisionsMade = 0;
                state.correctDecisions = 0;
                
                // Reset timer
                if (state.timer) {
                    clearInterval(state.timer);
                    state.timer = null;
                }
                
                // Reset UI
                startBtn.disabled = false;
                startBtn.innerHTML = '<span class="btn-icon">‚ñ∂</span> Start Challenge';
                nextBtn.disabled = true;
                nextBtn.textContent = 'Next Weather Condition';
                nextBtn.style.display = 'inline-flex';
                showResultsBtn.style.display = 'none';
                safetyTips.classList.remove('show');
                resultsDisplay.classList.remove('show');
                
                // Reset to first weather
                weatherBtns[0].click();
            });

            // Control button handlers
            controlBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!state.timer) return;
                    
                    const action = this.dataset.action;
                    
                    // Update active button
                    controlBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Handle actions with visual feedback
                    switch(action) {
                        case 'slow-down':
                            // Simulate slowing down - update hazard stats
                            const newStopping = parseInt(stoppingDistance.textContent);
                            stoppingDistance.textContent = `+${Math.min(200, newStopping + 10)}%`;
                            break;
                        case 'lights':
                            // Simulate lights on - improve visibility
                            const currentVis = parseInt(visibilityLevel.textContent);
                            visibilityLevel.textContent = `${Math.min(100, currentVis + 15)}%`;
                            break;
                        case 'distance':
                            // Increase following distance
                            const currentDist = parseInt(stoppingDistance.textContent);
                            stoppingDistance.textContent = `+${Math.min(200, currentDist + 20)}%`;
                            break;
                        case 'wipers':
                            // Improve visibility with wipers
                            const visWithWipers = parseInt(visibilityLevel.textContent);
                            visibilityLevel.textContent = `${Math.min(100, visWithWipers + 10)}%`;
                            break;
                    }
                });
            });

            // Initialize first weather condition
            loadWeatherCondition('rain');
        });
    </script>
</body>
</html>
