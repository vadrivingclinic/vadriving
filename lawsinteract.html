<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VA Driving Clinic - Module 4: Obscure Traffic Laws</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --color-primary: #5f17eb; /* Your exact brand purple */
            --color-primary-soft: #8a5feb;
            --color-secondary: #000000; /* Black */
            --color-accent: #7c3aed;
            --color-success: #10b981;
            --color-error: #ef4444;
            --color-warning: #f59e0b;
            --color-bg: #ffffff; /* White */
            --color-text: #000000; /* Black */
            --color-muted: #6b7280;
            --color-dark: #000000; /* Black */
            --color-light: #f9fafb;
            --radius-lg: 20px;
            --radius-md: 12px;
            --radius-sm: 8px;
            --shadow-soft: 0 10px 30px rgba(95, 23, 235, 0.1);
            --shadow-hover: 0 15px 35px rgba(95, 23, 235, 0.15);
            --shadow-card: 0 8px 25px rgba(0, 0, 0, 0.08);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 24px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            color: var(--color-text);
            line-height: 1.6;
        }

        @media (max-width: 600px) {
            body { padding: 12px; }
        }

        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(95, 23, 235, 0.5); }
            50% { box-shadow: 0 0 20px rgba(95, 23, 235, 0.8); }
        }

        @keyframes warningPulse {
            0%, 100% { background: #fef3c7; }
            50% { background: #fde68a; }
        }

        /* Main Container */
        .page {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: var(--color-bg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 30px;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.8s ease-out;
            border: 1px solid rgba(95, 23, 235, 0.1);
        }

        @media (max-width: 900px) {
            .page { padding: 20px; }
        }

        @media (max-width: 480px) {
            body { padding: 0; }
            .page {
                border-radius: 0;
                box-shadow: none;
                padding: 16px 12px 20px;
            }
        }

        /* Header */
        .brand-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            width: 100%;
            animation: fadeIn 0.6s ease-out 0.2s both;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .brand-logo {
            height: 50px;
            width: auto;
            max-width: 100%;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .brand-logo:hover { 
            transform: scale(1.05); 
            animation: glow 2s infinite;
        }

        .course-meta {
            display: flex;
            flex-direction: column;
            gap: 4px;
            max-width: 100%;
        }

        .course-name {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--color-primary);
            font-weight: 700;
        }

        .week-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 999px;
            background: rgba(95, 23, 235, 0.1);
            font-size: 0.8rem;
            color: var(--color-primary);
            font-weight: 600;
            border: 1px solid rgba(95, 23, 235, 0.2);
        }

        .week-label-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--color-primary);
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }

        .badge-mode {
            padding: 6px 12px;
            border-radius: 999px;
            background: rgba(95, 23, 235, 0.08);
            border: 1px solid rgba(95, 23, 235, 0.15);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-primary);
            white-space: nowrap;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .badge-mode:hover {
            background: rgba(95, 23, 235, 0.15);
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        h1 {
            font-size: clamp(1.8rem, 3vw, 2.4rem);
            line-height: 1.1;
            color: var(--color-text);
            margin-bottom: 10px;
            animation: fadeInUp 0.6s ease-out 0.3s both;
        }

        .module-subtitle {
            font-size: 1rem;
            color: var(--color-muted);
            max-width: 800px;
            margin-bottom: 28px;
            animation: fadeInUp 0.6s ease-out 0.4s both;
            line-height: 1.7;
        }

        /* Time Estimate Banner */
        .time-estimate-banner {
            background: linear-gradient(135deg, rgba(95, 23, 235, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%);
            border: 2px solid rgba(95, 23, 235, 0.2);
            border-radius: var(--radius-md);
            padding: 15px 20px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: fadeIn 0.5s ease;
        }

        .time-estimate-icon {
            font-size: 1.5rem;
            color: var(--color-primary);
            background: rgba(95, 23, 235, 0.1);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .time-estimate-content h3 {
            color: var(--color-primary);
            font-size: 1rem;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .time-estimate-content p {
            color: var(--color-text);
            font-size: 0.9rem;
            margin: 0;
        }

        .time-highlight {
            color: var(--color-primary);
            font-weight: 800;
            font-size: 1.1em;
        }

        /* Progress Tracker */
        .progress-tracker {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            padding: 0 20px;
        }

        .progress-tracker::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 50px;
            right: 50px;
            height: 3px;
            background: rgba(95, 23, 235, 0.1);
            z-index: 1;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 2px solid rgba(95, 23, 235, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-circle {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
            transform: scale(1.1);
            animation: pulse 2s infinite;
        }

        .progress-step.completed .step-circle {
            background: var(--color-success);
            border-color: var(--color-success);
            color: white;
        }

        .step-label {
            font-size: 0.75rem;
            color: var(--color-muted);
            text-align: center;
            font-weight: 600;
        }

        .progress-step.active .step-label {
            color: var(--color-primary);
            font-weight: 700;
        }

        /* Stats Display */
        .stats-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 600px) {
            .stats-display { grid-template-columns: 1fr; }
        }

        .stat-card {
            background: rgba(95, 23, 235, 0.05);
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(95, 23, 235, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--color-primary);
            box-shadow: 0 10px 25px rgba(95, 23, 235, 0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--color-primary);
            display: block;
            line-height: 1;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--color-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
        }

        /* Activity Grid */
        .activity-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
            margin-bottom: 30px;
        }

        .activity-card {
            background: var(--color-bg);
            border-radius: var(--radius-md);
            border: 1px solid rgba(95, 23, 235, 0.15);
            padding: 24px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .activity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--color-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--color-primary);
        }

        .activity-card:hover::before { 
            opacity: 1;
            animation: glow 2s infinite;
        }

        .activity-card.completed {
            border-color: var(--color-success);
        }

        .activity-card.completed::before {
            background: var(--color-success);
            opacity: 1;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .activity-number {
            font-size: 0.85rem;
            font-weight: 800;
            color: var(--color-primary);
            background: rgba(95, 23, 235, 0.1);
            padding: 4px 12px;
            border-radius: 20px;
            border: 1px solid rgba(95, 23, 235, 0.2);
        }

        .activity-status {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 12px;
            background: rgba(95, 23, 235, 0.08);
            color: var(--color-primary);
            font-weight: 600;
            border: 1px solid rgba(95, 23, 235, 0.15);
        }

        .activity-card.completed .activity-status {
            background: rgba(16, 185, 129, 0.1);
            color: var(--color-success);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .activity-title {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--color-text);
            margin-bottom: 12px;
        }

        .activity-description {
            font-size: 0.95rem;
            color: var(--color-muted);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* Activity Time Estimate */
        .activity-time-estimate {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            padding: 8px 12px;
            background: rgba(95, 23, 235, 0.05);
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--color-primary);
        }

        .activity-time-icon {
            color: var(--color-primary);
            font-weight: bold;
        }

        .activity-time-text {
            font-size: 0.85rem;
            color: var(--color-text);
            font-weight: 600;
        }

        /* Scenario Containers */
        .scenario-container {
            background: rgba(95, 23, 235, 0.03);
            border-radius: var(--radius-md);
            padding: 25px;
            margin: 20px 0;
            border: 2px solid rgba(95, 23, 235, 0.1);
        }

        .scenario-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .scenario-icon {
            font-size: 2.5rem;
            background: rgba(95, 23, 235, 0.1);
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            border: 2px solid rgba(95, 23, 235, 0.2);
        }

        .scenario-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 5px;
        }

        .scenario-description {
            font-size: 0.95rem;
            color: var(--color-text);
            line-height: 1.6;
        }

        /* Interactive Scene */
        .interactive-scene {
            position: relative;
            height: 200px;
            background: linear-gradient(to bottom, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: var(--radius-md);
            overflow: hidden;
            margin: 20px 0;
            border: 2px solid #bae6fd;
        }

        .scene-element {
            position: absolute;
            transition: all 0.3s ease;
        }

        .car-door {
            width: 60px;
            height: 80px;
            background: var(--color-primary);
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid white;
        }

        .bicycle {
            width: 40px;
            height: 25px;
            background: #ef4444;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .horse {
            width: 50px;
            height: 40px;
            background: #8b5a2b;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .car-interior {
            width: 150px;
            height: 80px;
            background: #374151;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            padding: 15px;
            gap: 10px;
        }

        .dashboard-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .item-label {
            font-size: 0.8rem;
            color: #d1d5db;
        }

        .item-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .item-status.active {
            background: var(--color-success);
        }

        .item-status.warning {
            background: var(--color-warning);
            animation: pulse 1s infinite;
        }

        /* Law Cards */
        .law-cards-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 900px) {
            .law-cards-container { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 600px) {
            .law-cards-container { grid-template-columns: 1fr; }
        }

        .law-card {
            background: white;
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 2px solid rgba(95, 23, 235, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .law-card:hover {
            transform: translateY(-5px);
            border-color: var(--color-primary);
            box-shadow: 0 8px 20px rgba(95, 23, 235, 0.1);
        }

        .law-card.selected {
            border-color: var(--color-primary);
            background: rgba(95, 23, 235, 0.05);
        }

        .law-card.correct {
            border-color: var(--color-success);
            background: rgba(16, 185, 129, 0.05);
        }

        .law-card.incorrect {
            border-color: var(--color-error);
            background: rgba(239, 68, 68, 0.05);
            animation: shake 0.5s ease;
        }

        .law-icon {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--color-primary);
        }

        .law-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 8px;
        }

        .law-description {
            font-size: 0.8rem;
            color: var(--color-muted);
            line-height: 1.5;
        }

        /* Quiz Options */
        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 600px) {
            .quiz-options { grid-template-columns: 1fr; }
        }

        .quiz-option {
            padding: 15px 20px;
            border-radius: var(--radius-sm);
            border: 2px solid rgba(95, 23, 235, 0.2);
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .quiz-option:hover {
            border-color: var(--color-primary);
            background: rgba(95, 23, 235, 0.05);
            transform: translateX(5px);
        }

        .quiz-option.selected {
            border-color: var(--color-primary);
            background: rgba(95, 23, 235, 0.1);
            font-weight: 600;
        }

        .quiz-option.correct {
            border-color: var(--color-success);
            background: rgba(16, 185, 129, 0.1);
        }

        .quiz-option.incorrect {
            border-color: var(--color-error);
            background: rgba(239, 68, 68, 0.1);
        }

        .option-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(95, 23, 235, 0.1);
            flex-shrink: 0;
        }

        .option-content {
            flex: 1;
        }

        .option-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 5px;
        }

        .option-description {
            font-size: 0.8rem;
            color: var(--color-muted);
        }

        /* Fine Calculator */
        .fine-calculator {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(249, 115, 22, 0.05) 100%);
            border-radius: var(--radius-md);
            padding: 25px;
            margin: 20px 0;
            border: 2px solid rgba(239, 68, 68, 0.2);
            animation: warningPulse 2s infinite;
        }

        .calculator-title {
            font-size: 1rem;
            font-weight: 800;
            color: #dc2626;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .calculator-icon {
            font-size: 1.5rem;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            .calculator-grid { grid-template-columns: 1fr; }
        }

        .calculator-item {
            background: white;
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 2px solid rgba(239, 68, 68, 0.1);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .item-label {
            font-size: 0.85rem;
            font-weight: 700;
            color: #dc2626;
        }

        .item-value {
            font-size: 1.2rem;
            font-weight: 900;
            color: #dc2626;
        }

        .item-description {
            font-size: 0.8rem;
            color: var(--color-muted);
        }

        /* Feedback */
        .feedback-container {
            background: rgba(95, 23, 235, 0.03);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 1px solid rgba(95, 23, 235, 0.15);
            margin-top: 20px;
            display: none;
            border-left: 4px solid var(--color-primary);
        }

        .feedback-container.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .feedback-title {
            font-size: 0.95rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .feedback-icon {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .feedback-icon.correct { 
            color: var(--color-success); 
        }
        
        .feedback-icon.incorrect { 
            color: var(--color-error); 
        }

        .feedback-content {
            font-size: 0.9rem;
            color: var(--color-text);
            line-height: 1.7;
        }

        .feedback-content strong { 
            color: var(--color-primary); 
            font-weight: 700;
        }

        .law-details {
            background: rgba(95, 23, 235, 0.05);
            border-left: 3px solid var(--color-primary);
            padding: 14px 18px;
            margin: 14px 0;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border-radius: var(--radius-md);
            border: none;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
            border: 2px solid var(--color-primary);
        }

        .btn-primary:hover {
            background: #4c0fcf;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(95, 23, 235, 0.4);
            animation: glow 1.5s infinite;
        }

        .btn-secondary {
            background: white;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .btn-secondary:hover {
            background: rgba(95, 23, 235, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(95, 23, 235, 0.2);
        }

        .btn-icon { 
            font-size: 1.2em; 
            font-weight: bold;
        }

        /* Results Panel */
        .results-panel {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: white;
            border-radius: var(--radius-md);
            padding: 40px;
            margin-top: 40px;
            display: none;
            animation: fadeInUp 0.6s ease;
            border: 2px solid var(--color-primary);
        }

        .results-panel.show { 
            display: block; 
            animation: glow 2s infinite;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .results-title {
            font-size: 1.6rem;
            font-weight: 800;
            color: white;
        }

        .score-display {
            font-size: 3.5rem;
            font-weight: 900;
            color: var(--color-primary);
            text-align: center;
            margin: 30px 0;
            text-shadow: 0 0 20px rgba(95, 23, 235, 0.7);
            animation: pulse 2s infinite;
        }

        .safety-insights {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 25px;
            margin-top: 25px;
            border-left: 4px solid var(--color-primary);
        }

        .insights-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .insights-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .insights-list li {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            font-size: 0.95rem;
            color: #e5e7eb;
            line-height: 1.6;
        }

        .insight-dot {
            width: 8px;
            height: 8px;
            margin-top: 10px;
            border-radius: 999px;
            background: var(--color-primary);
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <main class="page" aria-labelledby="module-heading">
        <!-- Header -->
        <header class="brand-row">
            <div class="brand">
                <img
                    src="https://lwfiles.mycourse.app/vadrivingclinic-public/9f5c6b8121721c8ef241f929fd983b3e.png"
                    alt="VA Driving Clinic logo"
                    class="brand-logo"
                />
                <div class="course-meta">
                    <span class="course-name">VA Driving Clinic ‚Ä¢ Module 4</span>
                    <div class="week-label">
                        <span class="week-label-dot"></span>
                        <span>Obscure Traffic Laws</span>
                    </div>
                </div>
            </div>
            <span class="badge-mode">Interactive Simulation</span>
        </header>

        <h1 id="module-heading">Virginia's Obscure Traffic Laws</h1>
        <p class="module-subtitle">
            Discover Virginia's lesser-known traffic regulations that often surprise drivers. From honking at horses to opening car doors, 
            these obscure laws have important safety implications and carry real penalties. Master these regulations in 5 minutes to avoid 
            unexpected fines and contribute to road safety.
        </p>

        <!-- Time Estimate Banner -->
        <div class="time-estimate-banner">
            <div class="time-estimate-icon">
                ‚è±Ô∏è
            </div>
            <div class="time-estimate-content">
                <h3>Simulation Time Estimate</h3>
                <p>Complete this interactive simulation in approximately <span class="time-highlight">5 minutes</span>. Explore three surprising Virginia traffic laws through interactive scenarios and immediate feedback on legal requirements.</p>
            </div>
        </div>

        <!-- Key Stats -->
        <div class="stats-display">
            <div class="stat-card">
                <span class="stat-number" id="strange-laws">8+</span>
                <span class="stat-label">Surprising Laws</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="average-fine">$150</span>
                <span class="stat-label">Average Fine</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="common-violations">85%</span>
                <span class="stat-label">Unaware Drivers</span>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-step active" data-step="1">
                <div class="step-circle">1</div>
                <div class="step-label">Car Door Law</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-circle">2</div>
                <div class="step-label">Horse & Pedestrian</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-circle">3</div>
                <div class="step-label">Vehicle Regulations</div>
            </div>
        </div>

        <!-- Activity Grid -->
        <div class="activity-grid">
            <!-- Activity 1: Car Door Law -->
            <section class="activity-card" id="activity-1" data-activity="1">
                <div class="activity-header">
                    <span class="activity-number">Scenario 1</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">The "Dooring" Law - Virginia Code ¬ß 46.2-818</h3>
                <p class="activity-description">
                    You've just parked on a busy Richmond street. As you prepare to exit your vehicle, 
                    what are your legal responsibilities before opening your door? This obscure law prevents 
                    serious accidents with cyclists and other vehicles.
                </p>

                <div class="activity-time-estimate">
                    <span class="activity-time-icon">‚è±Ô∏è</span>
                    <span class="activity-time-text">Estimated time: <strong>1-2 minutes</strong></span>
                </div>

                <!-- Scenario Description -->
                <div class="scenario-container">
                    <div class="scenario-header">
                        <div class="scenario-icon">üöó</div>
                        <div>
                            <div class="scenario-title">Urban Street Parking Scenario</div>
                            <div class="scenario-description">
                                You've parked on a busy downtown street with bicycle lanes. There's moderate traffic flow, 
                                and you need to exit your vehicle on the traffic side. A cyclist is approaching about 50 feet away.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Interactive Scene -->
                <div class="interactive-scene" id="dooring-scene">
                    <div class="scene-element car-door" id="car-door" style="left: 100px; top: 60px;">
                        üö™
                    </div>
                    <div class="scene-element bicycle" id="bicycle" style="left: 300px; top: 80px;">
                        üö≤
                    </div>
                    <div class="scene-element" style="left: 50px; top: 20px; color: var(--color-text); font-size: 0.8rem;">
                        <strong>Your Parked Car</strong>
                    </div>
                    <div class="scene-element" style="left: 280px; top: 120px; color: var(--color-text); font-size: 0.8rem;">
                        <strong>Approaching Cyclist</strong>
                    </div>
                    <div class="scene-element" style="left: 400px; top: 60px; color: var(--color-text); font-size: 0.8rem;">
                        <strong>Traffic Flow ‚Üí</strong>
                    </div>
                </div>

                <!-- Decision Options -->
                <div class="quiz-options">
                    <div class="quiz-option" data-option="A">
                        <div class="option-icon">üëÄ</div>
                        <div class="option-content">
                            <div class="option-title">Check mirrors, look over shoulder, then open slowly</div>
                            <div class="option-description">Virginia law requires checking for traffic before opening doors</div>
                        </div>
                    </div>
                    <div class="quiz-option" data-option="B">
                        <div class="option-icon">üö™</div>
                        <div class="option-content">
                            <div class="option-title">Open door immediately and exit quickly</div>
                            <div class="option-description">Get out before the cyclist reaches you</div>
                        </div>
                    </div>
                    <div class="quiz-option" data-option="C">
                        <div class="option-icon">üö∂</div>
                        <div class="option-content">
                            <div class="option-title">Exit from passenger side instead</div>
                            <div class="option-description">Avoid traffic side completely</div>
                        </div>
                    </div>
                    <div class="quiz-option" data-option="D">
                        <div class="option-icon">üì±</div>
                        <div class="option-content">
                            <div class="option-title">Honk horn to warn cyclist, then open</div>
                            <div class="option-description">Alert others before exiting</div>
                        </div>
                    </div>
                </div>

                <!-- Fine Calculator -->
                <div class="fine-calculator">
                    <div class="calculator-title">
                        <span class="calculator-icon">‚öñÔ∏è</span>
                        Potential Penalties for Violation
                    </div>
                    <p>If you cause an accident by opening your door without checking (known as "dooring"):</p>
                    <div class="calculator-grid">
                        <div class="calculator-item">
                            <div class="item-header">
                                <span class="item-label">Traffic Fine</span>
                                <span class="item-value">$150</span>
                            </div>
                            <div class="item-description">Base fine for obstructing traffic</div>
                        </div>
                        <div class="calculator-item">
                            <div class="item-header">
                                <span class="item-label">Property Damage</span>
                                <span class="item-value">$500+</span>
                            </div>
                            <div class="item-description">Bicycle/vehicle repair costs</div>
                        </div>
                        <div class="calculator-item">
                            <div class="item-header">
                                <span class="item-label">Injury Liability</span>
                                <span class="item-value">$5,000+</span>
                            </div>
                            <div class="item-description">Medical bills and liability</div>
                        </div>
                        <div class="calculator-item">
                            <div class="item-header">
                                <span class="item-label">Insurance Increase</span>
                                <span class="item-value">25%</span>
                            </div>
                            <div class="item-description">Annual premium increase (3 years)</div>
                        </div>
                    </div>
                </div>

                <!-- Feedback -->
                <div class="feedback-container" id="feedback-1">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">‚úì</span>
                        Correct: Check Before Opening!
                    </div>
                    <div class="feedback-content">
                        <strong>‚úÖ Correct Answer: A - Check mirrors, look over shoulder, then open slowly</strong><br><br>
                        
                        <strong>Virginia Code ¬ß 46.2-818 states:</strong><br>
                        "No person shall open the door of a motor vehicle on the side available to moving traffic unless and until 
                        it is reasonably safe to do so, and can be done without interfering with the movement of other traffic."<br><br>
                        
                        <div class="law-details">
                            <strong>üìã Legal Requirements:</strong><br>
                            1. <strong>Check side mirror</strong> for approaching traffic<br>
                            2. <strong>Look over shoulder</strong> to check blind spots<br>
                            3. <strong>Open slowly</strong> to signal your intention<br>
                            4. <strong>Exit quickly but safely</strong> once clear<br><br>
                            
                            <strong>üö≤ Special Consideration for Cyclists:</strong><br>
                            ‚Ä¢ Bicycle lanes are considered "moving traffic"<br>
                            ‚Ä¢ You're liable for any "dooring" accidents<br>
                            ‚Ä¢ Use the "Dutch Reach" method: open with far hand to force shoulder check
                        </div>
                        
                        <strong>üéØ Safety Statistics:</strong><br>
                        ‚Ä¢ "Dooring" causes 8% of urban bicycle accidents<br>
                        ‚Ä¢ Average medical cost per dooring incident: $7,500<br>
                        ‚Ä¢ 60% of dooring incidents occur in business districts
                    </div>
                </div>
            </section>

            <!-- Activity 2: Horse & Pedestrian Laws -->
            <section class="activity-card" id="activity-2" data-activity="2">
                <div class="activity-header">
                    <span class="activity-number">Scenario 2</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">Horse Honking & Pedestrian Rights</h3>
                <p class="activity-description">
                    Driving through rural Virginia, you encounter a horse-drawn buggy. Meanwhile, in the city, 
                    pedestrians are crossing. Learn the obscure laws about honking at horses and pedestrian right-of-way 
                    that many drivers don't know.
                </p>

                <div class="activity-time-estimate">
                    <span class="activity-time-icon">‚è±Ô∏è</span>
                    <span class="activity-time-text">Estimated time: <strong>1-2 minutes</strong></span>
                </div>

                <!-- Scenario Description -->
                <div class="scenario-container">
                    <div class="scenario-header">
                        <div class="scenario-icon">üêé</div>
                        <div>
                            <div class="scenario-title">Rural Road Encounter</div>
                            <div class="scenario-description">
                                You're driving on a country road in Amish country. A horse-drawn buggy is ahead moving slowly. 
                                The road is narrow with limited passing opportunities. What's the legal and safe approach?
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Law Cards -->
                <div class="law-cards-container" id="horse-laws">
                    <div class="law-card" data-law="honk">
                        <div class="law-icon">üì¢</div>
                        <div class="law-title">Honk Horn to Pass</div>
                        <div class="law-description">Alert the buggy driver you're passing</div>
                    </div>
                    <div class="law-card" data-law="quiet">
                        <div class="law-icon">üîá</div>
                        <div class="law-title">Pass Quietly & Slowly</div>
                        <div class="law-description">No honking - it's illegal to startle horses</div>
                    </div>
                    <div class="law-card" data-law="flash">
                        <div class="law-icon">üí°</div>
                        <div class="law-title">Flash Lights Instead</div>
                        <div class="law-description">Use headlights to signal passing intent</div>
                    </div>
                    <div class="law-card" data-law="wait">
                        <div class="law-icon">‚è≥</div>
                        <div class="law-title">Wait for Wide Spot</div>
                        <div class="law-description">Only pass where road is wide enough</div>
                    </div>
                    <div class="law-card" data-law="speed">
                        <div class="law-icon">‚ö°</div>
                        <div class="law-title">Pass Quickly</div>
                        <div class="law-description">Accelerate past to minimize time near horse</div>
                    </div>
                    <div class="law-card" data-law="distance">
                        <div class="law-icon">üìè</div>
                        <div class="law-title">6+ Feet Distance</div>
                        <div class="law-description">Maintain safe passing distance</div>
                    </div>
                </div>

                <!-- Pedestrian Scenario -->
                <div class="scenario-container" style="margin-top: 25px;">
                    <div class="scenario-header">
                        <div class="scenario-icon">üö∂</div>
                        <div>
                            <div class="scenario-title">Urban Crosswalk Scenario</div>
                            <div class="scenario-description">
                                A pedestrian is crossing at an unmarked crosswalk (intersection without paint). 
                                They're halfway across when your light turns green. Who has the right-of-way?
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quiz Questions -->
                <div class="quiz-container" style="margin-top: 20px;">
                    <div class="quiz-question">1. According to Virginia law, when must you yield to pedestrians?</div>
                    <div class="quiz-options">
                        <div class="quiz-option" data-question="1" data-option="A">
                            <div class="option-icon">A</div>
                            <div class="option-content">
                                <div class="option-title">Only at marked crosswalks</div>
                                <div class="option-description">Paint on road required for right-of-way</div>
                            </div>
                        </div>
                        <div class="quiz-option" data-question="1" data-option="B">
                            <div class="option-icon">B</div>
                            <div class="option-content">
                                <div class="option-title">At all intersections</div>
                                <div class="option-description">Marked or unmarked crosswalks</div>
                            </div>
                        </div>
                        <div class="quiz-option" data-question="1" data-option="C">
                            <div class="option-icon">C</div>
                            <div class="option-content">
                                <div class="option-title">Only when they have walk signal</div>
                                <div class="option-description">Traffic signal controls right-of-way</div>
                            </div>
                        </div>
                    </div>

                    <div class="quiz-question">2. What's the penalty for failing to yield to pedestrians in Virginia?</div>
                    <div class="quiz-options">
                        <div class="quiz-option" data-question="2" data-option="A">
                            <div class="option-icon">A</div>
                            <div class="option-content">
                                <div class="option-title">$100 fine + 4 DMV points</div>
                                <div class="option-description">Standard traffic violation</div>
                            </div>
                        </div>
                        <div class="quiz-option" data-question="2" data-option="B">
                            <div class="option-icon">B</div>
                            <div class="option-content">
                                <div class="option-title">Warning only for first offense</div>
                                <div class="option-description">Education over enforcement</div>
                            </div>
                        </div>
                        <div class="quiz-option" data-question="2" data-option="C">
                            <div class="option-icon">C</div>
                            <div class="option-content">
                                <div class="option-title">Reckless driving charge possible</div>
                                <div class="option-description">If pedestrian is endangered</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Feedback -->
                <div class="feedback-container" id="feedback-2">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">‚úì</span>
                        Horse & Pedestrian Laws Explained
                    </div>
                    <div class="feedback-content">
                        <strong>‚úÖ Correct Answers:</strong><br>
                        1. <strong>B - At all intersections:</strong> Virginia law requires yielding to pedestrians at marked AND unmarked crosswalks<br>
                        2. <strong>A - $100 fine + 4 DMV points:</strong> Standard penalty for failure to yield<br><br>
                        
                        <strong>üêé Virginia Horse Law - Code ¬ß 46.2-916:</strong><br>
                        "The driver of a motor vehicle approaching a horse being ridden or led along a highway shall reduce speed... 
                        and shall not sound his horn."<br><br>
                        
                        <div class="law-details">
                            <strong>üöó Legal Requirements Around Horses:</strong><br>
                            1. <strong>No honking:</strong> It's illegal and can cause accidents<br>
                            2. <strong>Reduce speed:</strong> Slow down significantly when approaching<br>
                            3. <strong>Pass wide:</strong> Give at least 6 feet clearance<br>
                            4. <strong>Pass slowly:</strong> Don't accelerate quickly near horses<br>
                            5. <strong>Wait if necessary:</strong> Only pass when safe<br><br>
                            
                            <strong>üö∂ Pedestrian Right-of-Way - Code ¬ß 46.2-924:</strong><br>
                            "The driver of any vehicle on a highway shall yield the right-of-way to any pedestrian crossing such highway..."
                        </div>
                        
                        <strong>üìä Virginia Statistics:</strong><br>
                        ‚Ä¢ 15% of rural accidents involve animals or animal-drawn vehicles<br>
                        ‚Ä¢ Pedestrian fatalities: 100+ annually in Virginia<br>
                        ‚Ä¢ Failure to yield citations: 5,000+ issued yearly
                    </div>
                </div>
            </section>

            <!-- Activity 3: Obscure Vehicle Regulations -->
            <section class="activity-card" id="activity-3" data-activity="3">
                <div class="activity-header">
                    <span class="activity-number">Scenario 3</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">Obscure Vehicle & Parking Laws</h3>
                <p class="activity-description">
                    From driving barefoot to parking against traffic, Virginia has surprising regulations about 
                    how you operate and park your vehicle. Test your knowledge of these obscure but important laws.
                </p>

                <div class="activity-time-estimate">
                    <span class="activity-time-icon">‚è±Ô∏è</span>
                    <span class="activity-time-text">Estimated time: <strong>1-2 minutes</strong></span>
                </div>

                <!-- Car Interior Simulation -->
                <div class="scenario-container">
                    <div class="scenario-header">
                        <div class="scenario-icon">üöò</div>
                        <div>
                            <div class="scenario-title">Vehicle Setup Check</div>
                            <div class="scenario-description">
                                Before driving, check these vehicle configurations. Which are legal in Virginia, 
                                and which could earn you a ticket?
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Interactive Car Interior -->
                <div class="interactive-scene">
                    <div class="scene-element car-interior" style="left: 50px; top: 20px;">
                        <div class="dashboard-item">
                            <div class="item-label">Air Freshener on Mirror</div>
                            <div class="item-status" id="freshener"></div>
                        </div>
                        <div class="dashboard-item">
                            <div class="item-label">GPS on Windshield</div>
                            <div class="item-status" id="gps"></div>
                        </div>
                        <div class="dashboard-item">
                            <div class="item-label">Shoes On/Off</div>
                            <div class="item-status" id="shoes"></div>
                        </div>
                        <div class="dashboard-item">
                            <div class="item-label">Window Tint Level</div>
                            <div class="item-status" id="tint"></div>
                        </div>
                    </div>
                    <div class="scene-element" style="left: 250px; top: 50px; width: 200px;">
                        <strong>Click each circle to toggle between legal/illegal configurations</strong>
                    </div>
                </div>

                <!-- True/False Quiz -->
                <div class="quiz-container" style="margin-top: 25px;">
                    <div class="quiz-question">Which of these statements about Virginia traffic laws are TRUE?</div>
                    <div class="law-cards-container">
                        <div class="law-card" data-statement="1">
                            <div class="law-icon">üë£</div>
                            <div class="law-title">Driving barefoot is illegal</div>
                            <div class="law-description">You must wear shoes while driving</div>
                        </div>
                        <div class="law-card" data-statement="2">
                            <div class="law-icon">üîÑ</div>
                            <div class="law-title">U-turns are always illegal</div>
                            <div class="law-description">No U-turns anywhere in Virginia</div>
                        </div>
                        <div class="law-card" data-statement="3">
                            <div class="law-icon">üÖøÔ∏è</div>
                            <div class="law-title">Park against traffic flow</div>
                            <div class="law-description">Park facing opposite direction</div>
                        </div>
                        <div class="law-card" data-statement="4">
                            <div class="law-icon">üö≤</div>
                            <div class="law-title">Bikes = Same rights as cars</div>
                            <div class="law-description">Bicyclists have equal road rights</div>
                        </div>
                        <div class="law-card" data-statement="5">
                            <div class="law-icon">üö´</div>
                            <div class="law-title">No hanging objects</div>
                            <div class="law-description">Nothing can hang from mirror</div>
                        </div>
                        <div class="law-card" data-statement="6">
                            <div class="law-icon">üèçÔ∏è</div>
                            <div class="law-title">Motorcycle passenger rules</div>
                            <div class="law-description">Specific seating requirements</div>
                        </div>
                    </div>
                </div>

                <!-- Parking Simulation -->
                <div class="scenario-container" style="margin-top: 25px;">
                    <div class="scenario-header">
                        <div class="scenario-icon">üÖøÔ∏è</div>
                        <div>
                            <div class="scenario-title">Parking Direction Challenge</div>
                            <div class="scenario-description">
                                You're parking on a residential street. Traffic flows from left to right. 
                                Which parking direction is legally required in Virginia?
                            </div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <div style="display: inline-block; padding: 15px; background: #f3f4f6; border-radius: var(--radius-sm);">
                            <div>üöó ‚Üí üöó ‚Üí üöó ‚Üí (Traffic Flow)</div>
                            <div style="margin-top: 10px; font-size: 0.9rem;">
                                Should you park facing ‚Üí or facing ‚Üê ?
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Feedback -->
                <div class="feedback-container" id="feedback-3">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">‚úì</span>
                        Obscure Vehicle Laws Decoded
                    </div>
                    <div class="feedback-content">
                        <strong>‚úÖ The Truth About Virginia's Obscure Vehicle Laws:</strong><br><br>
                        
                        <div class="law-details">
                            <strong>üë£ Driving Barefoot (MYTH):</strong> It's <strong>NOT illegal</strong> in Virginia, but strongly discouraged for safety reasons<br><br>
                            
                            <strong>üîÑ U-turn Restrictions (TRUE with conditions):</strong> Legal unless signed otherwise or visibility <500 feet<br><br>
                            
                            <strong>üÖøÔ∏è Parking Direction (FALSE):</strong> You MUST park in the <strong>direction of traffic flow</strong> (Virginia Code ¬ß 46.2-1219)<br><br>
                            
                            <strong>üö≤ Bicycle Rights (TRUE):</strong> Bicyclists have same rights/duties as motor vehicles (Code ¬ß 46.2-800)<br><br>
                            
                            <strong>üö´ Hanging Objects (TRUE with limits):</strong> Cannot obstruct driver's view (Code ¬ß 46.2-1054)<br><br>
                            
                            <strong>üèçÔ∏è Motorcycle Passengers (TRUE):</strong> Must have proper seat and footrests (Code ¬ß 46.2-910)
                        </div>
                        
                        <strong>üéØ Key Takeaways:</strong><br>
                        1. <strong>Mirror Obstructions:</strong> Air fresheners/dice can be ticketed if they block view<br>
                        2. <strong>Window Tint:</strong> Front side windows must allow ‚â•50% light transmission<br>
                        3. <strong>Windshield Devices:</strong> GPS/phones must not obstruct more than 7 square inches<br>
                        4. <strong>Parking Fines:</strong> $50 for parking against traffic, $100 in some municipalities<br><br>
                        
                        <strong>üí° Pro Tip:</strong> These obscure laws are often enforced during traffic stops for other violations. 
                        Knowing them can prevent additional tickets!
                    </div>
                </div>
            </section>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-secondary" id="reset-all-btn">
                <span class="btn-icon">‚Üª</span>
                Reset Simulation
            </button>
            <button class="btn btn-secondary" id="laws-cheatsheet">
                <span class="btn-icon">üìã</span>
                Get Laws Cheatsheet
            </button>
            <button class="btn btn-primary" id="view-results-btn">
                <span class="btn-icon">üìä</span>
                View Mastery Results
            </button>
        </div>

        <!-- Results Panel -->
        <div class="results-panel" id="results-panel">
            <div class="results-header">
                <h2 class="results-title">Obscure Laws Mastery</h2>
                <div class="score-display" id="final-score">0%</div>
            </div>
            
            <div class="safety-insights">
                <h3 class="insights-title">
                    <span>‚öñÔ∏è</span> Why Obscure Laws Matter
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Safety First:</strong> Each obscure law addresses a specific safety concern. The "dooring" law prevents bicycle accidents, horse honking laws prevent animal-related crashes, and parking direction laws reduce collision risks when exiting spaces.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Financial Protection:</strong> Violating obscure laws can cost hundreds in fines and thousands in liability. Knowing these laws helps avoid unexpected expenses and insurance premium increases.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Legal Preparedness:</strong> Police officers often use obscure laws as "add-on" charges during traffic stops. Knowledge of these regulations can help you avoid multiple citations from a single incident.</span>
                    </li>
                </ul>
            </div>
            
            <div class="safety-insights" style="margin-top: 20px;">
                <h3 class="insights-title">
                    <span>üîç</span> Most Commonly Unknown VA Laws
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Code ¬ß 46.2-818:</strong> "Dooring" law - 85% of drivers are unaware they must check for traffic before opening doors. Violation carries $150 fine plus liability for any accidents caused.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Code ¬ß 46.2-916:</strong> Horse protection law - Illegal to honk at horses. This law is particularly important in rural areas with Amish communities and carries a $100 fine.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Code ¬ß 46.2-1219:</strong> Parking direction - Must park facing traffic direction. Violation results in $50 fine, yet surveys show 70% of drivers don't know this law exists.</span>
                    </li>
                </ul>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // State Management
            const state = {
                activities: {
                    1: { completed: false, correct: false, answer: null },
                    2: { completed: false, correct: 0, total: 4, answers: {}, horseLaws: [] },
                    3: { completed: false, correct: 0, total: 6, statements: {}, configs: {} }
                },
                startedAt: new Date(),
                timeSpent: 0
            };

            // Correct answers
            const correctAnswers = {
                1: 'A',
                2: { 
                    horseLaws: ['quiet', 'distance', 'wait'],
                    quiz: { 1: 'B', 2: 'A' }
                },
                3: {
                    statements: [false, false, false, true, true, true],
                    configs: { freshener: 'illegal', gps: 'legal', shoes: 'legal', tint: 'legal' }
                }
            };

            // DOM Elements
            const progressSteps = document.querySelectorAll('.progress-step');
            const activityCards = document.querySelectorAll('.activity-card');
            const resetBtn = document.getElementById('reset-all-btn');
            const cheatsheetBtn = document.getElementById('laws-cheatsheet');
            const resultsBtn = document.getElementById('view-results-btn');
            const resultsPanel = document.getElementById('results-panel');
            const finalScore = document.getElementById('final-score');

            // Timer
            function updateTimer() {
                const now = new Date();
                const diff = Math.floor((now - state.startedAt) / 1000);
                state.timeSpent = diff;
            }

            setInterval(updateTimer, 1000);

            // Update Progress
            function updateProgress() {
                let completed = 0;
                
                Object.values(state.activities).forEach(activity => {
                    if (activity.completed) completed++;
                });

                progressSteps.forEach((step, index) => {
                    if (index < completed) {
                        step.classList.add('completed');
                        step.classList.remove('active');
                    } else if (index === completed) {
                        step.classList.add('active');
                        step.classList.remove('completed');
                    } else {
                        step.classList.remove('active', 'completed');
                    }
                });
            }

            // Activity 1: Car Door Law
            function initActivity1() {
                const quizOptions = document.querySelectorAll('#activity-1 .quiz-option');
                const feedback = document.getElementById('feedback-1');
                const status = document.querySelector('#activity-1 .activity-status');
                const carDoor = document.getElementById('car-door');
                const bicycle = document.getElementById('bicycle');

                let bicyclePosition = 300;
                let doorOpen = false;

                // Animate bicycle
                function animateBicycle() {
                    if (bicyclePosition > 150) {
                        bicyclePosition -= 1;
                        bicycle.style.left = `${bicyclePosition}px`;
                        requestAnimationFrame(animateBicycle);
                    }
                }

                // Start animation
                setTimeout(animateBicycle, 1000);

                // Quiz option clicks
                quizOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const selectedOption = this.dataset.option;
                        
                        // Remove selection from all options
                        quizOptions.forEach(opt => {
                            opt.classList.remove('selected', 'correct', 'incorrect');
                        });
                        
                        // Mark selected
                        this.classList.add('selected');
                        
                        // Check answer
                        const isCorrect = selectedOption === correctAnswers[1];
                        
                        if (isCorrect) {
                            this.classList.add('correct');
                            state.activities[1].correct = true;
                            
                            // Animate safe door opening
                            setTimeout(() => {
                                carDoor.style.transform = 'rotateY(-30deg)';
                                carDoor.style.transformOrigin = 'left center';
                                doorOpen = true;
                            }, 500);
                        } else {
                            this.classList.add('incorrect');
                            state.activities[1].correct = false;
                            
                            // Highlight correct answer
                            document.querySelector(`[data-option="${correctAnswers[1]}"]`).classList.add('correct');
                            
                            // Animate accident if wrong answer
                            if (selectedOption === 'B') {
                                setTimeout(() => {
                                    carDoor.style.transform = 'rotateY(-60deg)';
                                    carDoor.style.transformOrigin = 'left center';
                                    bicycle.style.transform = 'rotate(45deg)';
                                    bicycle.style.top = '100px';
                                }, 500);
                            }
                        }
                        
                        state.activities[1].completed = true;
                        state.activities[1].answer = selectedOption;
                        status.textContent = 'Completed';
                        document.querySelector('#activity-1').classList.add('completed');
                        feedback.classList.add('show');
                        
                        updateProgress();
                    });
                });
            }

            // Activity 2: Horse & Pedestrian Laws
            function initActivity2() {
                const lawCards = document.querySelectorAll('#horse-laws .law-card');
                const quizOptions = document.querySelectorAll('#activity-2 .quiz-option');
                const feedback = document.getElementById('feedback-2');
                const status = document.querySelector('#activity-2 .activity-status');
                
                let selectedHorseLaws = [];
                let answeredQuiz = 0;

                // Horse law card clicks
                lawCards.forEach(card => {
                    card.addEventListener('click', function() {
                        const law = this.dataset.law;
                        
                        // Toggle selection
                        if (this.classList.contains('selected')) {
                            this.classList.remove('selected');
                            selectedHorseLaws = selectedHorseLaws.filter(l => l !== law);
                        } else {
                            this.classList.add('selected');
                            selectedHorseLaws.push(law);
                        }
                        
                        // Store selection
                        state.activities[2].horseLaws = selectedHorseLaws;
                        
                        // Check if completed
                        if (selectedHorseLaws.length >= 3 && answeredQuiz >= 2) {
                            checkActivity2();
                        }
                    });
                });

                // Quiz option clicks
                quizOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const question = this.dataset.question;
                        const answer = this.dataset.option;
                        
                        // Remove selection from all options for this question
                        const allOptionsForQuestion = document.querySelectorAll(`[data-question="${question}"]`);
                        allOptionsForQuestion.forEach(opt => {
                            opt.classList.remove('selected', 'correct', 'incorrect');
                        });
                        
                        // Mark selected
                        this.classList.add('selected');
                        
                        // Check answer
                        const isCorrect = answer === correctAnswers[2].quiz[question];
                        
                        if (isCorrect) {
                            this.classList.add('correct');
                            state.activities[2].correct++;
                        } else {
                            this.classList.add('incorrect');
                            document.querySelector(`[data-question="${question}"][data-option="${correctAnswers[2].quiz[question]}"]`).classList.add('correct');
                        }
                        
                        state.activities[2].answers[question] = answer;
                        answeredQuiz = Object.keys(state.activities[2].answers).length;
                        
                        // Check if completed
                        if (selectedHorseLaws.length >= 3 && answeredQuiz >= 2) {
                            checkActivity2();
                        }
                    });
                });

                function checkActivity2() {
                    // Check horse law selections
                    const correctHorseLaws = correctAnswers[2].horseLaws;
                    const correctHorseCount = selectedHorseLaws.filter(law => 
                        correctHorseLaws.includes(law)).length;
                    
                    // Update score
                    state.activities[2].correct += correctHorseCount;
                    
                    // Mark cards
                    lawCards.forEach(card => {
                        const law = card.dataset.law;
                        if (correctHorseLaws.includes(law)) {
                            card.classList.add('correct');
                        } else if (selectedHorseLaws.includes(law)) {
                            card.classList.add('incorrect');
                        }
                    });
                    
                    state.activities[2].completed = true;
                    state.activities[2].score = Math.round((state.activities[2].correct / 5) * 100);
                    
                    status.textContent = 'Completed';
                    document.querySelector('#activity-2').classList.add('completed');
                    feedback.classList.add('show');
                    
                    updateProgress();
                }
            }

            // Activity 3: Vehicle Regulations
            function initActivity3() {
                const statementCards = document.querySelectorAll('#activity-3 .law-card[data-statement]');
                const statusItems = document.querySelectorAll('#activity-3 .item-status');
                const feedback = document.getElementById('feedback-3');
                const status = document.querySelector('#activity-3 .activity-status');
                
                let selectedStatements = {};
                let configuredItems = {};

                // Statement card clicks
                statementCards.forEach(card => {
                    card.addEventListener('click', function() {
                        const statementNum = this.dataset.statement;
                        const isSelected = this.classList.contains('selected');
                        
                        // Toggle selection
                        if (isSelected) {
                            this.classList.remove('selected');
                            delete selectedStatements[statementNum];
                        } else {
                            this.classList.add('selected');
                            selectedStatements[statementNum] = true;
                        }
                        
                        state.activities[3].statements = selectedStatements;
                        
                        // Check if completed
                        if (Object.keys(selectedStatements).length >= 3 && Object.keys(configuredItems).length >= 4) {
                            checkActivity3();
                        }
                    });
                });

                // Status item clicks (car interior configuration)
                statusItems.forEach(item => {
                    item.addEventListener('click', function() {
                        const itemId = this.id;
                        const currentState = this.classList.contains('active') ? 'active' : 
                                           this.classList.contains('warning') ? 'warning' : 'inactive';
                        
                        // Cycle through states
                        if (currentState === 'inactive') {
                            this.classList.add('active');
                            this.classList.remove('warning');
                            configuredItems[itemId] = 'legal';
                        } else if (currentState === 'active') {
                            this.classList.remove('active');
                            this.classList.add('warning');
                            configuredItems[itemId] = 'illegal';
                        } else {
                            this.classList.remove('warning');
                            configuredItems[itemId] = 'inactive';
                        }
                        
                        state.activities[3].configs = configuredItems;
                        
                        // Check if completed
                        if (Object.keys(selectedStatements).length >= 3 && Object.keys(configuredItems).length >= 4) {
                            checkActivity3();
                        }
                    });
                });

                function checkActivity3() {
                    let correctCount = 0;
                    
                    // Check statements
                    statementCards.forEach(card => {
                        const statementNum = card.dataset.statement;
                        const isSelected = card.classList.contains('selected');
                        const shouldBeSelected = correctAnswers[3].statements[statementNum - 1];
                        
                        if (isSelected === shouldBeSelected) {
                            card.classList.add('correct');
                            correctCount++;
                        } else {
                            card.classList.add('incorrect');
                        }
                    });
                    
                    // Check configurations
                    statusItems.forEach(item => {
                        const itemId = item.id;
                        const currentState = configuredItems[itemId];
                        const correctState = correctAnswers[3].configs[itemId];
                        
                        if (currentState === correctState) {
                            item.classList.add('correct');
                            correctCount++;
                        } else {
                            item.classList.add('incorrect');
                        }
                    });
                    
                    state.activities[3].completed = true;
                    state.activities[3].correct = correctCount;
                    state.activities[3].score = Math.round((correctCount / 10) * 100);
                    
                    status.textContent = 'Completed';
                    document.querySelector('#activity-3').classList.add('completed');
                    feedback.classList.add('show');
                    
                    updateProgress();
                }
            }

            // Reset Simulation
            function resetSimulation() {
                // Reset state
                state.activities = {
                    1: { completed: false, correct: false, answer: null },
                    2: { completed: false, correct: 0, total: 4, answers: {}, horseLaws: [] },
                    3: { completed: false, correct: 0, total: 6, statements: {}, configs: {} }
                };
                
                // Reset UI
                activityCards.forEach(card => {
                    card.classList.remove('completed');
                    const status = card.querySelector('.activity-status');
                    status.textContent = 'Not Started';
                    status.style.color = '';
                    const feedback = card.querySelector('.feedback-container');
                    feedback.classList.remove('show');
                });
                
                // Reset Activity 1
                const quizOptions1 = document.querySelectorAll('#activity-1 .quiz-option');
                quizOptions1.forEach(opt => {
                    opt.classList.remove('selected', 'correct', 'incorrect');
                });
                
                const carDoor = document.getElementById('car-door');
                const bicycle = document.getElementById('bicycle');
                if (carDoor) {
                    carDoor.style.transform = '';
                    carDoor.style.transformOrigin = '';
                }
                if (bicycle) {
                    bicycle.style.transform = '';
                    bicycle.style.left = '300px';
                    bicycle.style.top = '80px';
                }
                
                // Reset Activity 2
                const lawCards = document.querySelectorAll('#horse-laws .law-card');
                lawCards.forEach(card => {
                    card.classList.remove('selected', 'correct', 'incorrect');
                });
                
                const quizOptions2 = document.querySelectorAll('#activity-2 .quiz-option');
                quizOptions2.forEach(opt => {
                    opt.classList.remove('selected', 'correct', 'incorrect');
                });
                
                // Reset Activity 3
                const statementCards = document.querySelectorAll('#activity-3 .law-card');
                statementCards.forEach(card => {
                    card.classList.remove('selected', 'correct', 'incorrect');
                });
                
                const statusItems = document.querySelectorAll('#activity-3 .item-status');
                statusItems.forEach(item => {
                    item.classList.remove('active', 'warning', 'correct', 'incorrect');
                });
                
                // Reset results
                resultsPanel.classList.remove('show');
                
                // Reset timer
                state.startedAt = new Date();
                state.timeSpent = 0;
                
                // Re-initialize Activity 1 animation
                initActivity1();
                
                // Update progress
                updateProgress();
            }

            // Laws Cheatsheet
            function showCheatsheet() {
                const cheatsheet = `
                    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
                    ‚ïë     VIRGINIA OBSCURE LAWS CHEATSHEET      ‚ïë
                    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
                    
                    üöó CAR DOOR LAW (¬ß46.2-818)
                    ‚Ä¢ MUST check mirrors & look over shoulder
                    ‚Ä¢ Can't open door if unsafe for traffic
                    ‚Ä¢ Fine: $150 + liability for accidents
                    
                    üêé HORSE LAW (¬ß46.2-916)
                    ‚Ä¢ NO honking at horses or buggies
                    ‚Ä¢ Reduce speed when approaching
                    ‚Ä¢ Pass wide (6+ feet) and slow
                    ‚Ä¢ Fine: $100
                    
                    üÖøÔ∏è PARKING DIRECTION (¬ß46.2-1219)
                    ‚Ä¢ MUST park facing traffic direction
                    ‚Ä¢ Fine: $50 ($100 in some cities)
                    
                    üö∂ PEDESTRIAN RIGHT-OF-WAY (¬ß46.2-924)
                    ‚Ä¢ Yield at ALL intersections
                    ‚Ä¢ Marked AND unmarked crosswalks
                    ‚Ä¢ Fine: $100 + 4 DMV points
                    
                    üë£ BAREHEAD DRIVING
                    ‚Ä¢ NOT illegal (but unsafe!)
                    ‚Ä¢ No specific law against it
                    
                    üö´ OBSTRUCTED VIEW (¬ß46.2-1054)
                    ‚Ä¢ Can't hang objects blocking view
                    ‚Ä¢ GPS must be in lower corners
                    ‚Ä¢ Fine: $50
                    
                    üîÑ U-TURNS
                    ‚Ä¢ Legal unless signed "No U-Turn"
                    ‚Ä¢ Need 500+ feet visibility
                    
                    üö≤ BICYCLE RIGHTS (¬ß46.2-800)
                    ‚Ä¢ Same rights/duties as cars
                    ‚Ä¢ Must use lights at night
                    
                    üèçÔ∏è MOTORCYCLE PASSENGERS (¬ß46.2-910)
                    ‚Ä¢ Must have proper seat
                    ‚Ä¢ Must have footrests
                    ‚Ä¢ No riding on handlebars
                    
                    ‚ö†Ô∏è REMEMBER: Ignorance of the law is no excuse!
                `;
                
                alert("Virginia Obscure Laws Cheatsheet\n\nCopy this information for future reference:\n\n" + cheatsheet);
            }

            // View Results
            function viewResults() {
                let totalScore = 0;
                let maxScore = 0;
                
                Object.values(state.activities).forEach(activity => {
                    if (activity.completed) {
                        if (activity.score !== undefined) {
                            totalScore += activity.score;
                            maxScore += 100;
                        } else if (activity.correct !== undefined) {
                            // For activities without direct score calculation
                            totalScore += activity.correct ? 100 : 0;
                            maxScore += 100;
                        }
                    }
                });
                
                const averageScore = maxScore > 0 ? Math.round(totalScore / (maxScore / 100)) : 0;
                finalScore.textContent = `${averageScore}%`;
                
                resultsPanel.classList.add('show');
                resultsPanel.scrollIntoView({ behavior: 'smooth' });
            }

            // Initialize all activities
            initActivity1();
            initActivity2();
            initActivity3();

            // Event listeners
            resetBtn.addEventListener('click', resetSimulation);
            cheatsheetBtn.addEventListener('click', showCheatsheet);
            resultsBtn.addEventListener('click', viewResults);

            // Initial update
            updateTimer();
            updateProgress();
        });
    </script>
</body>
</html>
