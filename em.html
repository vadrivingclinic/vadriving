<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E/M Coding: Specialty Rules & Service Levels</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #af4bef;
            --primary-light: #d492ff;
            --primary-dark: #8a2bc9;
            --accent: #8380f0;
            --accent-light: #a5a3f5;
            --accent-dark: #6a67d8;
            --success: #00b894;
            --success-light: #00e5c9;
            --warning: #fdcb6e;
            --error: #e17055;
            --background: #f7f5fb;
            --surface: #ffffff;
            --surface-dark: #f1ecff;
            --text-primary: #2d3436;
            --text-secondary: #636e72;
            --text-light: #b2bec3;
            --border: #dfe6e9;
            --border-light: #e0e0e0;
            --shadow-sm: 0 2px 12px rgba(175, 75, 239, 0.08);
            --shadow-md: 0 4px 20px rgba(175, 75, 239, 0.12);
            --shadow-lg: 0 8px 32px rgba(175, 75, 239, 0.16);
            --radius-sm: 10px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-xl: 32px;
            --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #ffffff 0%, #f1ecff 50%, var(--background) 100%);
            color: var(--text-primary);
            line-height: 1.7;
            min-height: 100vh;
            padding-bottom: 60px;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(175, 75, 239, 0.03) 0%, transparent 50%),
                       radial-gradient(circle at 80% 20%, rgba(131, 128, 240, 0.03) 0%, transparent 50%);
            z-index: -1;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }
        
        /* Header Styles */
        header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(223, 230, 233, 0.5);
            padding: 20px 0;
            transition: var(--transition-base);
            box-shadow: var(--shadow-sm);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 30px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 20px;
            background: linear-gradient(135deg, rgba(175, 75, 239, 0.1) 0%, rgba(131, 128, 240, 0.1) 100%);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(175, 75, 239, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .logo-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
            animation: shine 3s infinite linear;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .logo {
            height: 48px;
            width: auto;
            filter: drop-shadow(0 2px 4px rgba(175, 75, 239, 0.2));
        }
        
        .logo-text {
            font-size: 22px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }
        
        .progress-container {
            flex: 1;
            max-width: 400px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .progress-bar-bg {
            height: 10px;
            background: linear-gradient(90deg, var(--surface-dark), #e9ecef);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 10px;
            width: 10%;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(175, 75, 239, 0.3);
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.4) 50%, 
                transparent 100%);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Module Navigation */
        .module-nav-container {
            position: sticky;
            top: 90px;
            z-index: 999;
            margin: 30px 0;
            background: var(--surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            padding: 20px;
            border: 1px solid rgba(223, 230, 233, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .module-nav {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 4px;
            scrollbar-width: none;
        }
        
        .module-nav::-webkit-scrollbar {
            display: none;
        }
        
        .nav-btn {
            flex-shrink: 0;
            padding: 16px 24px;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid transparent;
            border-radius: var(--radius-xl);
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: 12px;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }
        
        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            opacity: 0;
            transition: var(--transition-base);
            z-index: -1;
        }
        
        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-sm);
            border-color: var(--primary-light);
            color: var(--primary);
        }
        
        .nav-btn:hover::before {
            opacity: 0.05;
        }
        
        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .nav-btn.active .nav-icon {
            color: white;
            transform: scale(1.1);
        }
        
        .nav-icon {
            font-size: 18px;
            color: var(--primary);
            transition: var(--transition-base);
        }
        
        /* Content Sections */
        .content-section {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            animation: slideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        
        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 48px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 40px;
            border: 1px solid rgba(223, 230, 233, 0.5);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .section-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--accent));
            border-radius: var(--radius-sm) 0 0 var(--radius-sm);
        }
        
        h1, h2, h3, h4 {
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 24px;
            position: relative;
            display: inline-block;
            letter-spacing: -0.5px;
        }
        
        h1::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 0;
            width: 80px;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 3px;
            box-shadow: 0 2px 8px rgba(175, 75, 239, 0.3);
        }
        
        h2 {
            font-size: 32px;
            color: var(--primary);
            margin-top: 48px;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(175, 75, 239, 0.1);
            position: relative;
        }
        
        h2::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 2px;
            background: var(--accent);
        }
        
        h3 {
            font-size: 24px;
            color: var(--accent);
            margin-top: 36px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        h3 i {
            color: var(--primary);
            font-size: 22px;
            background: rgba(175, 75, 239, 0.1);
            padding: 10px;
            border-radius: 12px;
        }
        
        p {
            margin-bottom: 24px;
            color: var(--text-secondary);
            font-size: 17px;
            line-height: 1.8;
        }
        
        /* Highlight Box */
        .highlight-box {
            background: linear-gradient(135deg, rgba(175, 75, 239, 0.05) 0%, rgba(131, 128, 240, 0.05) 100%);
            border-left: 5px solid var(--primary);
            padding: 32px;
            margin: 40px 0;
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            position: relative;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(175, 75, 239, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .highlight-box i {
            position: absolute;
            top: 28px;
            left: 28px;
            color: var(--primary);
            font-size: 28px;
            background: rgba(175, 75, 239, 0.1);
            padding: 12px;
            border-radius: 14px;
        }
        
        .highlight-content {
            margin-left: 48px;
        }
        
        .highlight-title {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 16px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Cards Container */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
            margin: 40px 0;
        }
        
        .feature-card {
            background: var(--surface);
            padding: 32px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            transition: all var(--transition-base);
            position: relative;
            overflow: hidden;
        }
        
        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }
        
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }
        
        .feature-icon {
            font-size: 32px;
            color: var(--primary);
            margin-bottom: 20px;
            background: rgba(175, 75, 239, 0.1);
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .feature-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 16px;
        }
        
        /* Case Study Styles */
        .case-study {
            background: linear-gradient(135deg, #f9f7ff 0%, #f1ecff 100%);
            border-radius: var(--radius-md);
            padding: 32px;
            margin: 40px 0;
            border-left: 5px solid var(--accent);
            position: relative;
            overflow: hidden;
        }
        
        .case-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-light);
        }
        
        .case-icon {
            color: var(--accent);
            font-size: 28px;
            background: rgba(131, 128, 240, 0.1);
            padding: 12px;
            border-radius: 14px;
        }
        
        .case-title {
            font-weight: 700;
            color: var(--primary);
            font-size: 20px;
        }
        
        .case-scenario {
            background: white;
            padding: 24px;
            border-radius: var(--radius-sm);
            margin: 20px 0;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }
        
        .case-question {
            font-weight: 600;
            color: var(--primary);
            margin: 20px 0 16px 0;
            font-size: 18px;
        }
        
        /* Simulation Activity */
        .simulation-activity {
            background: linear-gradient(135deg, #f0e6ff 0%, #e8e0ff 100%);
            border-radius: var(--radius-lg);
            padding: 40px;
            margin: 48px 0;
            border: 3px solid var(--accent);
            position: relative;
            overflow: hidden;
        }
        
        .simulation-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 2px solid rgba(131, 128, 240, 0.2);
        }
        
        .simulation-icon {
            font-size: 32px;
            color: var(--primary);
            background: rgba(175, 75, 239, 0.1);
            width: 64px;
            height: 64px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .simulation-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            flex: 1;
        }
        
        .patient-profile {
            background: white;
            padding: 32px;
            border-radius: var(--radius-md);
            margin-bottom: 32px;
            box-shadow: var(--shadow-md);
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }
        
        .patient-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: bold;
        }
        
        .patient-info {
            flex: 1;
        }
        
        .patient-name {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }
        
        .patient-details {
            color: var(--text-secondary);
            font-size: 16px;
        }
        
        .simulation-options {
            display: grid;
            gap: 16px;
            margin: 32px 0;
        }
        
        .simulation-option {
            background: white;
            padding: 24px 28px;
            border-radius: var(--radius-md);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .simulation-option:hover {
            background: linear-gradient(135deg, rgba(175, 75, 239, 0.05), rgba(131, 128, 240, 0.05));
            border-color: var(--primary-light);
            transform: translateX(8px);
        }
        
        .simulation-option.selected {
            background: linear-gradient(135deg, rgba(175, 75, 239, 0.1), rgba(131, 128, 240, 0.1));
            border-color: var(--primary);
        }
        
        .simulation-option.correct {
            background: linear-gradient(135deg, rgba(0, 184, 148, 0.1), rgba(175, 75, 239, 0.1));
            border-color: var(--success);
        }
        
        .simulation-option.incorrect {
            background: linear-gradient(135deg, rgba(225, 112, 85, 0.1), rgba(131, 128, 240, 0.1));
            border-color: var(--error);
        }
        
        .option-marker {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            flex-shrink: 0;
            transition: var(--transition-base);
            background: white;
        }
        
        .simulation-option:hover .option-marker {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }
        
        .simulation-option.correct .option-marker {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }
        
        .simulation-option.incorrect .option-marker {
            background: var(--error);
            color: white;
            border-color: var(--error);
        }
        
        .feedback-box {
            background: white;
            padding: 24px;
            border-radius: var(--radius-md);
            margin-top: 24px;
            border-left: 5px solid var(--accent);
            display: none;
        }
        
        .feedback-box.show {
            display: block;
            animation: slideIn 0.5s ease;
        }
        
        .feedback-title {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Quiz Section */
        .quiz-card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 40px;
            margin: 48px 0;
            box-shadow: var(--shadow-lg);
            border: 2px solid rgba(175, 75, 239, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .quiz-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(131, 128, 240, 0.05) 0%, transparent 70%);
            transform: translate(50%, -50%);
        }
        
        .quiz-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 2px solid rgba(175, 75, 239, 0.1);
        }
        
        .quiz-icon {
            font-size: 32px;
            color: var(--primary);
            background: linear-gradient(135deg, rgba(175, 75, 239, 0.1), rgba(131, 128, 240, 0.1));
            width: 64px;
            height: 64px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .quiz-question {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
            line-height: 1.5;
        }
        
        .quiz-options {
            display: grid;
            gap: 16px;
        }
        
        .quiz-option {
            background: linear-gradient(135deg, rgba(248, 249, 250, 0.8), rgba(241, 236, 255, 0.8));
            padding: 24px 28px;
            border-radius: var(--radius-md);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .quiz-option:hover {
            background: linear-gradient(135deg, rgba(175, 75, 239, 0.05), rgba(131, 128, 240, 0.05));
            border-color: var(--primary-light);
            transform: translateX(8px);
        }
        
        .quiz-option.selected {
            background: linear-gradient(135deg, rgba(175, 75, 239, 0.1), rgba(131, 128, 240, 0.1));
            border-color: var(--primary);
        }
        
        .quiz-option.correct {
            background: linear-gradient(135deg, rgba(0, 184, 148, 0.1), rgba(175, 75, 239, 0.1));
            border-color: var(--success);
        }
        
        .quiz-option.incorrect {
            background: linear-gradient(135deg, rgba(225, 112, 85, 0.1), rgba(131, 128, 240, 0.1));
            border-color: var(--error);
        }
        
        /* Footer Navigation */
        .module-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 60px;
            padding-top: 40px;
            border-top: 2px solid rgba(223, 230, 233, 0.3);
            position: relative;
        }
        
        .module-footer::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 0;
            width: 100px;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }
        
        .nav-btn-group {
            display: flex;
            gap: 16px;
        }
        
        .btn {
            padding: 20px 36px;
            border-radius: var(--radius-xl);
            font-weight: 700;
            cursor: pointer;
            border: none;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.3px;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
            opacity: 0;
            transition: var(--transition-base);
        }
        
        .btn:hover::before {
            opacity: 1;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            box-shadow: 0 8px 24px rgba(175, 75, 239, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(175, 75, 239, 0.4);
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary-light);
            box-shadow: 0 4px 16px rgba(175, 75, 239, 0.1);
        }
        
        .btn-secondary:hover {
            background: rgba(175, 75, 239, 0.05);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(175, 75, 239, 0.2);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .cards-container {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }
        
        @media (max-width: 992px) {
            .section-card {
                padding: 36px;
            }
            
            h1 {
                font-size: 36px;
            }
            
            h2 {
                font-size: 28px;
            }
            
            .cards-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .progress-container {
                max-width: 100%;
                width: 100%;
            }
            
            .module-nav-container {
                margin: 20px 0;
                padding: 16px;
            }
            
            .nav-btn {
                padding: 14px 20px;
                font-size: 14px;
            }
            
            .section-card {
                padding: 28px 24px;
            }
            
            .quiz-card, .simulation-activity {
                padding: 28px;
            }
            
            .btn {
                padding: 18px 28px;
            }
            
            .module-footer {
                flex-direction: column;
                gap: 20px;
            }
            
            .nav-btn-group {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        @media (max-width: 576px) {
            .container {
                padding: 0 16px;
            }
            
            .section-card {
                padding: 24px 20px;
            }
            
            h1 {
                font-size: 32px;
            }
            
            h2 {
                font-size: 24px;
            }
            
            .nav-btn {
                padding: 12px 16px;
                font-size: 13px;
            }
            
            .nav-btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
        }
        
        /* Completion Celebration */
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(175, 75, 239, 0.95), rgba(131, 128, 240, 0.95));
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease;
        }
        
        .celebration-content {
            background: var(--surface);
            padding: 60px;
            border-radius: var(--radius-lg);
            text-align: center;
            max-width: 500px;
            box-shadow: var(--shadow-lg);
            animation: scaleIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.8) rotate(-5deg); opacity: 0; }
            to { transform: scale(1) rotate(0); opacity: 1; }
        }
        
        .celebration-icon {
            font-size: 80px;
            color: var(--primary);
            margin-bottom: 24px;
            animation: bounce 1s infinite alternate;
        }
        
        @keyframes bounce {
            from { transform: translateY(0) scale(1); }
            to { transform: translateY(-20px) scale(1.1); }
        }
    </style>
</head>
<body>
    <!-- Celebration Modal -->
    <div class="celebration" id="celebrationModal">
        <div class="celebration-content">
            <div class="celebration-icon">
                <i class="fas fa-award"></i>
            </div>
            <h1 style="background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 16px;">
                Module Complete!
            </h1>
            <p style="color: var(--text-primary); font-size: 18px; margin-bottom: 32px; line-height: 1.6;">
                Congratulations! You've successfully mastered E/M Coding Specialty Rules and Service Levels. You're now equipped with essential knowledge for determining new vs established patients and coding E/M service levels accurately.
            </p>
            <div style="display: flex; gap: 16px; justify-content: center;">
                <button class="btn btn-primary" onclick="closeCelebration()">
                    <i class="fas fa-check-circle"></i> Continue Learning
                </button>
                <button class="btn btn-secondary" onclick="restartModule()">
                    <i class="fas fa-redo"></i> Review Again
                </button>
            </div>
        </div>
    </div>
    
    <header id="mainHeader">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-container">
                        <img src="https://cdn.prod.website-files.com/64d0ccc1558d601cbfb09021/64e9d2f719b1e5258e5d57f5_IMG_1512-p-500.png" alt="Medical Coding Logo" class="logo">
                        <div class="logo-text">E/M Coding: Specialty Rules</div>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-info">
                        <span id="currentProgress">Introduction</span>
                        <span id="progressPercent">10% Complete</span>
                    </div>
                    <div class="progress-bar-bg">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="module-nav-container">
            <nav class="module-nav" id="moduleNav">
                <button class="nav-btn active" data-section="intro">
                    <i class="fas fa-home nav-icon"></i> Introduction
                </button>
                <button class="nav-btn" data-section="new-patient">
                    <i class="fas fa-user-plus nav-icon"></i> New Patient Rules
                </button>
                <button class="nav-btn" data-section="established-patient">
                    <i class="fas fa-user-check nav-icon"></i> Established Patient
                </button>
                <button class="nav-btn" data-section="em-components">
                    <i class="fas fa-puzzle-piece nav-icon"></i> E/M Components
                </button>
                <button class="nav-btn" data-section="presenting-problem">
                    <i class="fas fa-stethoscope nav-icon"></i> Presenting Problem
                </button>
                <button class="nav-btn" data-section="simulation">
                    <i class="fas fa-gamepad nav-icon"></i> Simulation Activity
                </button>
            </nav>
        </div>
        
        <!-- Introduction Section -->
        <section class="content-section active" id="intro">
            <div class="section-card">
                <h1>E/M Coding: Specialty Rules & Service Levels</h1>
                <p class="subtitle" style="font-size: 20px; color: var(--accent); margin-bottom: 32px; font-weight: 500;">
                    Master the Rules for New vs Established Patients and E/M Service Components
                </p>
                
                <div class="highlight-box">
                    <i class="fas fa-graduation-cap"></i>
                    <div class="highlight-content">
                        <div class="highlight-title">
                            <i class="fas fa-flag-checkered"></i> Welcome to E/M Coding Rules
                        </div>
                        <p>This comprehensive module will guide you through the essential principles of determining new vs established patients based on specialty and subspecialty rules, and understanding the components that determine E/M service levels. Accurate application of these rules is critical for proper coding and reimbursement.</p>
                    </div>
                </div>
                
                <h2><i class="fas fa-bullseye"></i> Learning Objectives</h2>
                <p>Upon completing this module, you will be able to:</p>
                
                <div class="cards-container">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <h3 class="feature-title">Differentiate New vs Established Patients</h3>
                        <p>Apply specialty and subspecialty rules to determine patient status based on practice structure and previous services.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <h3 class="feature-title">Identify E/M Service Components</h3>
                        <p>Recognize the seven components of E/M services and distinguish between key components and contributory factors.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <h3 class="feature-title">Determine Service Levels</h3>
                        <p>Understand how the nature of presenting problems influences medical necessity and E/M code selection.</p>
                    </div>
                </div>
                
                <h2><i class="fas fa-compass"></i> Module Navigation</h2>
                <div class="highlight-box">
                    <i class="fas fa-lightbulb"></i>
                    <div class="highlight-content">
                        <div class="highlight-title">
                            <i class="fas fa-map-signs"></i> Learning Path Guide
                        </div>
                        <p>Navigate through 6 comprehensive sections covering specialty rules, E/M components, and practical application. Each section includes real-world examples, case studies, and an interactive simulation activity to reinforce your learning. Track your progress using the bar above and complete activities to mark your mastery.</p>
                    </div>
                </div>
                
                <div class="module-footer">
                    <div class="nav-btn-group">
                        <button class="btn btn-secondary" id="prevBtnIntro" disabled>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn btn-primary" id="nextBtnIntro">
                            Next: New Patient Rules <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- New Patient Rules Section -->
        <section class="content-section" id="new-patient">
            <div class="section-card">
                <h1>New Patient Determination Rules</h1>
                
                <div class="highlight-box">
                    <i class="fas fa-user-plus"></i>
                    <div class="highlight-content">
                        <div class="highlight-title">
                            <i class="fas fa-info-circle"></i> Professional Services Rule
                        </div>
                        <p>A <strong>new patient</strong> is one who has not received any professional (face-to-face) services from the physician or another physician of the exact same specialty and subspecialty in the same group practice within the past three years.</p>
                    </div>
                </div>
                
                <h2><i class="fas fa-check-circle"></i> Key Considerations</h2>
                
                <div class="cards-container">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-handshake"></i>
                        </div>
                        <h3 class="feature-title">Face-to-Face Requirement</h3>
                        <p>Only face-to-face services count. Interpretations, consultations without patient contact, or reviewing records do NOT establish a patient as "established."</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3 class="feature-title">Same Group Practice</h3>
                        <p>The three-year rule applies only within the same group practice. Different practices, even with same specialty, don't affect new patient status.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h3 class="feature-title">Three-Year Timeframe</h3>
                        <p>The clock resets after three years without face-to-face services from same specialty within the same group practice.</p>
                    </div>
                </div>
                
                <div class="case-study">
                    <div class="case-header">
                        <i class="fas fa-file-medical case-icon"></i>
                        <div class="case-title">Case Study: Professional Services Rule</div>
                    </div>
                    
                    <div class="case-scenario">
                        <p><strong>Scenario:</strong> A 65-year-old male sees a cardiologist for an E/M service. Another cardiologist in the practice provided an interpretation of an EKG for the same patient the previous year when he was in the emergency department, but there was no face-to-face service.</p>
                        
                        <div class="case-question">Is this patient NEW or ESTABLISHED to the cardiologist?</div>
                        
                        <div class="quiz-options" style="margin-top: 16px;">
                            <div class="quiz-option" data-correct="true">
                                <div class="option-marker">A</div>
                                <div><strong>NEW Patient</strong> - The EKG interpretation was not a face-to-face service</div>
                            </div>
                            <div class="quiz-option" data-correct="false">
                                <div class="option-marker">B</div>
                                <div><strong>ESTABLISHED Patient</strong> - Any professional service within 3 years counts</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h2><i class="fas fa-exchange-alt"></i> Same Specialty Rule</h2>
                <p>Specialty matters! A patient can be new to one specialty while established with another within the same practice:</p>
                
                <div class="case-study">
                    <div class="case-header">
                        <i class="fas fa-clinic-medical case-icon"></i>
                        <div class="case-title">Case Study: Same Specialty Rule</div>
                    </div>
                    
                    <div class="case-scenario">
                        <p><strong>Scenario:</strong> A patient has been seeing an internist in a multispecialty group for the past three years for primary care, particularly hypertension. The internist identified some suspicious lesions and sent the patient to a general surgeon in the same practice to evaluate lesion removal.</p>
                        
                        <div class="case-question">Is this patient NEW or ESTABLISHED to the general surgeon?</div>
                        
                        <div class="quiz-options" style="margin-top: 16px;">
                            <div class="quiz-option" data-correct="true">
                                <div class="option-marker">A</div>
                                <div><strong>NEW Patient</strong> - The surgeon has a different specialty than the internist</div>
                            </div>
                            <div class="quiz-option" data-correct="false">
                                <div class="option-marker">B</div>
                                <div><strong>ESTABLISHED Patient</strong> - Any physician in the same practice counts</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="quiz-card">
                    <div class="quiz-header">
                        <div class="quiz-icon">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <div class="quiz-question">Which of the following would make a patient "established" to a physician?</div>
                    </div>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="true">
                            <div class="option-marker">A</div>
                            <div>Face-to-face service within past 3 years from same specialty in same group</div>
                        </div>
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">B</div>
                            <div>Telephone consultation 2 years ago</div>
                        </div>
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">C</div>
                            <div>Review of lab results 1 year ago</div>
                        </div>
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">D</div>
                            <div>Service from different specialty in same practice 6 months ago</div>
                        </div>
                    </div>
                </div>
                
                <div class="module-footer">
                    <div class="nav-btn-group">
                        <button class="btn btn-secondary" id="prevBtnNewPatient">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn btn-primary" id="nextBtnNewPatient">
                            Next: Established Patient <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Established Patient Section -->
        <section class="content-section" id="established-patient">
            <div class="section-card">
                <h1>Established Patient Determination</h1>
                
                <div class="highlight-box">
                    <i class="fas fa-user-check"></i>
                    <div class="highlight-content">
                        <div class="highlight-title">
                            <i class="fas fa-users"></i> Definition of Established Patient
                        </div>
                        <p>An <strong>established patient</strong> is one who has received professional (face-to-face) services within the past three years from the physician or qualified healthcare professional providing the E/M, or from another physician or qualified healthcare professional of the same specialty <strong>and subspecialty</strong> in the same group practice.</p>
                    </div>
                </div>
                
                <h2><i class="fas fa-stethoscope"></i> Same Subspecialty Rule</h2>
                <p>The subspecialty distinction is critical. Patients remain established within the same subspecialty, even if they haven't seen that specific physician:</p>
                
                <div class="case-study">
                    <div class="case-header">
                        <i class="fas fa-child case-icon"></i>
                        <div class="case-title">Case Study: Same Subspecialty Rule</div>
                    </div>
                    
                    <div class="case-scenario">
                        <p><strong>Scenario:</strong> A pediatric patient comes to your office complaining of stomach pains. Although this is the pediatric gastroenterologist's first time meeting the patient, another doctor of the same subspecialty in the same group practice saw the patient two years ago for a similar complaint.</p>
                        
                        <div class="case-question">Is this patient NEW or ESTABLISHED to the pediatric gastroenterologist?</div>
                        
                        <div class="quiz-options" style="margin-top: 16px;">
                            <div class="quiz-option" data-correct="true">
                                <div class="option-marker">A</div>
                                <div><strong>ESTABLISHED Patient</strong> - Same subspecialty within same practice within 3 years</div>
                            </div>
                            <div class="quiz-option" data-correct="false">
                                <div class="option-marker">B</div>
                                <div><strong>NEW Patient</strong> - Different physician, so patient is new</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h2><i class="fas fa-exclamation-triangle"></i> Common Pitfalls</h2>
                
                <div class="cards-container">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-user-times"></i>
                        </div>
                        <h3 class="feature-title">Overlooking Subspecialty</h3>
                        <p>Assuming all pediatricians are the same specialty. Pediatric cardiologist vs pediatric gastroenterologist are different subspecialties.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-calendar-times"></i>
                        </div>
                        <h3 class="feature-title">Ignoring Timeframe</h3>
                        <p>Forgetting the 3-year rule. A patient seen 3 years and 1 day ago is NEW if no other same-specialty contact.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-hospital"></i>
                        </div>
                        <h3 class="feature-title">Confusing Practice Boundaries</h3>
                        <p>Services from same specialty but different practice groups don't affect new/established status.</p>
                    </div>
                </div>
                
                <h2><i class="fas fa-balance-scale"></i> Decision Tree for Patient Status</h2>
                
                <div class="highlight-box">
                    <i class="fas fa-sitemap"></i>
                    <div class="highlight-content">
                        <div class="highlight-title">
                            <i class="fas fa-project-diagram"></i> Patient Status Determination Flow
                        </div>
                        <p>
                            <strong>Step 1:</strong> Has the patient received face-to-face services from ANY physician in your group?<br>
                            <strong>If NO:</strong>  NEW PATIENT<br>
                            <strong>If YES:</strong>  Proceed to Step 2<br><br>
                            
                            <strong>Step 2:</strong> Was the service within past 3 years?<br>
                            <strong>If NO:</strong>  NEW PATIENT<br>
                            <strong>If YES:</strong>  Proceed to Step 3<br><br>
                            
                            <strong>Step 3:</strong> Was the physician of same specialty AND subspecialty?<br>
                            <strong>If NO:</strong>  NEW PATIENT<br>
                            <strong>If YES:</strong>  ESTABLISHED PATIENT
                        </p>
                    </div>
                </div>
                
                <div class="quiz-card">
                    <div class="quiz-header">
                        <div class="quiz-icon">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <div class="quiz-question">A patient sees a cardiologist in your group for the first time. Another cardiologist in your group saw the patient 2 years ago. What is the patient's status?</div>
                    </div>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="true">
                            <div class="option-marker">A</div>
                            <div>Established - Same specialty within 3 years</div>
                        </div>
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">B</div>
                            <div>New - Different physician</div>
                        </div>
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">C</div>
                            <div>New - Needs to see same exact physician</div>
                        </div>
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">D</div>
                            <div>Depends on the subspecialty</div>
                        </div>
                    </div>
                </div>
                
                <div class="module-footer">
                    <div class="nav-btn-group">
                        <button class="btn btn-secondary" id="prevBtnEstablished">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn btn-primary" id="nextBtnEstablished">
                            Next: E/M Components <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- E/M Components Section -->
        <section class="content-section" id="em-components">
            <div class="section-card">
                <h1>Components of E/M Service Levels</h1>
                
                <div class="highlight-box">
                    <i class="fas fa-puzzle-piece"></i>
                    <div class="highlight-content">
                        <div class="highlight-title">
                            <i class="fas fa-layer-group"></i> E/M Service Structure
                        </div>
                        <p>Evaluation and Management (E/M) services have 3-5 levels within each category. Each level represents variations in skills, knowledge, and work required. There are <strong>seven components</strong> used to determine the appropriate E/M code level.</p>
                    </div>
                </div>
                
                <h2><i class="fas fa-key"></i> The Three Key Components</h2>
                <p>These three components are <strong>required</strong> for E/M level selection:</p>
                
                <div class="cards-container">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <h3 class="feature-title">1. History</h3>
                        <p>Includes chief complaint, history of present illness, review of systems, and past/family/social history. Documented through patient interview.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h3 class="feature-title">2. Examination</h3>
                        <p>Physical examination performed by the provider. Can be problem-focused, expanded problem-focused, detailed, or comprehensive.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <h3 class="feature-title">3. Medical Decision Making (MDM)</h3>
                        <p>The complexity of establishing diagnosis, assessing risk, and managing the patient's problem. Most important component for code selection.</p>
                    </div>
                </div>
                
                <h2><i class="fas fa-plus-circle"></i> Contributory Factors</h2>
                <p>These components support but aren't always required:</p>
                
                <div class="cards-container">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <h3 class="feature-title">4. Counseling</h3>
                        <p>Discussion with patient/family about diagnosis, treatment options, risks, prognosis, etc. Important when it dominates the encounter.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-network-wired"></i>
                        </div>
                        <h3 class="feature-title">5. Coordination of Care</h3>
                        <p>Arranging for other services or consultations. More common in inpatient or complex outpatient settings.</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-clipboard-check"></i>
                        </div>
                        <h3 class="feature-title">6. Nature of Presenting Problem</h3>
                        <p>The reason for the encounter. Helps determine medical necessity. We'll explore this in detail next section.</p>
                    </div>
                </div>
                
                <h2><i class="fas fa-clock"></i> The Time Component</h2>
                
                <div class="highlight-box">
                    <i class="fas fa-hourglass-half"></i>
                    <div class="highlight-content">
                        <div class="highlight-title">
                            <i class="fas fa-stopwatch"></i> 7. Time
                        </div>
                        <p>Time can be used to determine code level <strong>when counseling and/or coordination of care dominates the encounter</strong> (more than 50% of face-to-face time). The time must be documented and include only face-to-face time with the physician/qualified healthcare professional.</p>
                    </div>
                </div>
                
                <div class="case-study">
                    <div class="case-header">
                        <i class="fas fa-clipboard-list case-icon"></i>
                        <div class="case-title">Clinical Scenario: Component Application</div>
                    </div>
                    
                    <div class="case-scenario">
                        <p><strong>Scenario:</strong> A 45-year-old female presents with persistent headaches. The physician takes a detailed history, performs a comprehensive neurological exam, reviews recent MRI results, discusses multiple treatment options including risks/benefits, and arranges for neurology consultation.</p>
                        
                        <div class="case-question">Which E/M components are demonstrated in this scenario?</div>
                        
                        <div class="quiz-options" style="margin-top: 16px;">
                            <div class="quiz-option" data-correct="false">
                                <div class="option-marker">A</div>
                                <div>Only the three key components</div>
                            </div>
                            <div class="quiz-option" data-correct="true">
                                <div class="option-marker">B</div>
                                <div>All three key components plus counseling and coordination of care</div>
                            </div>
                            <div class="quiz-option" data-correct="false">
                                <div class="option-marker">C</div>
                                <div>Only counseling and coordination of care</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="quiz-card">
                    <div class="quiz-header">
                        <div class="quiz-icon">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <div class="quiz-question">Which statement about E/M components is CORRECT?</div>
                    </div>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="true">
                            <div class="option-marker">A</div>
                            <div>The three key components are history, examination, and medical decision making</div>
                        </div>
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">B</div>
                            <div>Time is always the most important factor in code selection</div>
                        </div>
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">C</div>
                            <div>Counseling is required for all E/M services</div>
                        </div>
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">D</div>
                            <div>The same level in different E/M categories has identical requirements</div>
                        </div>
                    </div>
                </div>
                
                <div class="module-footer">
                    <div class="nav-btn-group">
                        <button class="btn btn-secondary" id="prevBtnComponents">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn btn-primary" id="nextBtnComponents">
                            Next: Presenting Problem <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Presenting Problem Section -->
        <section class="content-section" id="presenting-problem">
            <div class="section-card">
                <h1>Nature of Presenting Problem</h1>
                
                <div class="highlight-box">
                    <i class="fas fa-stethoscope"></i>
                    <div class="highlight-content">
                        <div class="highlight-title">
                            <i class="fas fa-user-injured"></i> Understanding Presenting Problems
                        </div>
                        <p>The <strong>nature of the presenting problem</strong> is a contributory factor that carries weight when determining the medical necessity of an E/M service. It refers to the reason for the encounter as described by the patient (illness, injury, symptom, finding, or complaint).</p>
                    </div>
                </div>
                
                <h2><i class="fas fa-layer-group"></i> Five Levels of Severity</h2>
                
                <div class="cards-container">
                    <div class="feature-card">
                        <div class="feature-icon" style="background: rgba(178, 190, 195, 0.1); color: var(--text-light);">
                            <i class="fas fa-minus"></i>
                        </div>
                        <h3 class="feature-title">1. Minimal</h3>
                        <p><strong>Problem:</strong> Provider may not need to be present<br>
                        <strong>Example:</strong> Nurse performing suture removal for simple wound repair<br>
                        <strong>Risk:</strong> Very low</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon" style="background: rgba(99, 110, 114, 0.1); color: var(--text-secondary);">
                            <i class="fas fa-bug"></i>
                        </div>
                        <h3 class="feature-title">2. Self-Limited/Minor</h3>
                        <p><strong>Problem:</strong> Temporary with definite course<br>
                        <strong>Example:</strong> Insect bite, minor rash<br>
                        <strong>Risk:</strong> Low, good prognosis with treatment</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon" style="background: rgba(45, 52, 54, 0.1); color: var(--text-primary);">
                            <i class="fas fa-head-side-cough"></i>
                        </div>
                        <h3 class="feature-title">3. Low Severity</h3>
                        <p><strong>Problem:</strong> Low morbidity risk, no death risk<br>
                        <strong>Example:</strong> Sinusitis, mild asthma<br>
                        <strong>Risk:</strong> Low, recover without impairment</p>
                    </div>
                </div>
                
                <div class="cards-container">
                    <div class="feature-card">
                        <div class="feature-icon" style="background: rgba(175, 75, 239, 0.1);">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <h3 class="feature-title">4. Moderate Severity</h3>
                        <p><strong>Problem:</strong> Moderate morbidity/death risk without treatment<br>
                        <strong>Example:</strong> Stable angina, pneumonia<br>
                        <strong>Risk:</strong> Uncertain prognosis, possible functional impairment</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon" style="background: rgba(131, 128, 240, 0.1);">
                            <i class="fas fa-procedures"></i>
                        </div>
                        <h3 class="feature-title">5. High Severity</h3>
                        <p><strong>Problem:</strong> High/extreme morbidity risk, moderate/high death risk<br>
                        <strong>Example:</strong> Sepsis, acute MI, severe trauma<br>
                        <strong>Risk:</strong> Severe functional impairment likely</p>
                    </div>
                </div>
                
                <h2><i class="fas fa-balance-scale"></i> Medical Necessity Connection</h2>
                
                <div class="case-study">
                    <div class="case-header">
                        <i class="fas fa-scale-balanced case-icon"></i>
                        <div class="case-title">Case Study: Severity Level Application</div>
                    </div>
                    
                    <div class="case-scenario">
                        <p><strong>Scenario 1:</strong> 28-year-old presents with itchy red bump on arm from suspected mosquito bite 2 days ago. No fever, no swelling. Works outdoors.</p>
                        
                        <div class="case-question">What is the severity level of this presenting problem?</div>
                        
                        <div class="simulation-options" style="margin-top: 16px;">
                            <div class="simulation-option" data-correct="true">
                                <div class="option-marker">A</div>
                                <div><strong>Self-Limited/Minor</strong> - Temporary, definite course, good prognosis</div>
                            </div>
                            <div class="simulation-option" data-correct="false">
                                <div class="option-marker">B</div>
                                <div><strong>Low Severity</strong> - Requires more assessment than insect bite</div>
                            </div>
                            <div class="simulation-option" data-correct="false">
                                <div class="option-marker">C</div>
                                <div><strong>Moderate Severity</strong> - Potential for complications</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 24px;">
                            <p><strong>Scenario 2:</strong> 65-year-old with history of CAD presents with crushing chest pain radiating to left arm, diaphoresis, nausea. BP 90/60, HR 120.</p>
                            
                            <div class="case-question">What is the severity level of this presenting problem?</div>
                            
                            <div class="simulation-options" style="margin-top: 16px;">
                                <div class="simulation-option" data-correct="false">
                                    <div class="option-marker">A</div>
                                    <div><strong>Low Severity</strong> - Common cardiac symptoms</div>
                                </div>
                                <div class="simulation-option" data-correct="false">
                                    <div class="option-marker">B</div>
                                    <div><strong>Moderate Severity</strong> - Cardiac history concerning</div>
                                </div>
                                <div class="simulation-option" data-correct="true">
                                    <div class="option-marker">C</div>
                                    <div><strong>High Severity</strong> - High mortality risk without immediate treatment</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h2><i class="fas fa-chart-line"></i> Impact on Code Selection</h2>
                
                <div class="highlight-box">
                    <i class="fas fa-code"></i>
                    <div class="highlight-content">
                        <div class="highlight-title">
                            <i class="fas fa-file-medical"></i> Severity Level and E/M Codes
                        </div>
                        <p>The nature of presenting problem influences medical necessity, which in turn affects appropriate E/M code level selection. Higher severity problems generally justify higher level E/M services because they require more complex:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>History taking (more detailed review of systems)</li>
                            <li>Examination (more body areas/organ systems)</li>
                            <li>Medical decision making (higher complexity, more data review, higher risk)</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>Example:</strong> A high severity problem like possible myocardial infarction would typically justify a higher level E/M service (like 99285 in ED) compared to a self-limited problem like insect bite (99281-99282).</p>
                    </div>
                </div>
                
                <div class="quiz-card">
                    <div class="quiz-header">
                        <div class="quiz-icon">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <div class="quiz-question">Which presenting problem would be considered "High Severity"?</div>
                    </div>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">A</div>
                            <div>Seasonal allergies with sneezing and itchy eyes</div>
                        </div>
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">B</div>
                            <div>Minor laceration requiring 3 stitches</div>
                        </div>
                        <div class="quiz-option" data-correct="true">
                            <div class="option-marker">C</div>
                            <div>Sepsis with fever, hypotension, and confusion</div>
                        </div>
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">D</div>
                            <div>Chronic stable hypertension follow-up</div>
                        </div>
                    </div>
                </div>
                
                <div class="module-footer">
                    <div class="nav-btn-group">
                        <button class="btn btn-secondary" id="prevBtnPresenting">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn btn-primary" id="nextBtnPresenting">
                            Next: Simulation Activity <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Simulation Activity Section -->
        <section class="content-section" id="simulation">
            <div class="section-card">
                <h1>Clinical Simulation Activity</h1>
                
                <div class="simulation-activity">
                    <div class="simulation-header">
                        <div class="simulation-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <div class="simulation-title">Multi-Specialty Practice Scenario</div>
                    </div>
                    
                    <p style="font-size: 18px; margin-bottom: 32px; color: var(--text-primary);">
                        Apply your knowledge of specialty rules and E/M components in this interactive simulation. You'll determine patient status and appropriate E/M levels for patients in a multi-specialty group practice.
                    </p>
                    
                    <div class="patient-profile">
                        <div class="profile-header">
                            <div class="patient-avatar">JS</div>
                            <div class="patient-info">
                                <div class="patient-name">John Smith</div>
                                <div class="patient-details">58-year-old male  Patient at "HealthFirst MultiSpecialty Group"</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h3 style="margin-top: 0; color: var(--primary);">Medical History in This Practice:</h3>
                            <ul style="margin-left: 20px; margin-top: 10px; color: var(--text-secondary);">
                                <li><strong>2 years ago:</strong> Seen by Dr. Adams (Cardiologist) for hypertension management</li>
                                <li><strong>1 year ago:</strong> EKG interpretation by Dr. Baker (Cardiologist) - no face-to-face</li>
                                <li><strong>6 months ago:</strong> Seen by Dr. Carter (Internal Medicine) for annual physical</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="simulation-question" style="margin: 32px 0 24px 0;">
                        <h3 style="margin: 0; color: var(--accent);">
                            <i class="fas fa-question-circle"></i> Question 1: Patient Status Determination
                        </h3>
                        <p style="margin-top: 12px; color: var(--text-primary);">
                            John Smith presents today to see <strong>Dr. Davis (Cardiologist)</strong> for evaluation of new onset chest pain. Based on the specialty rules, what is John's patient status to Dr. Davis?
                        </p>
                    </div>
                    
                    <div class="simulation-options">
                        <div class="simulation-option" data-correct="true">
                            <div class="option-marker">A</div>
                            <div><strong>ESTABLISHED Patient</strong> - Face-to-face with same specialty (Cardiology) within 3 years</div>
                        </div>
                        <div class="simulation-option" data-correct="false">
                            <div class="option-marker">B</div>
                            <div><strong>NEW Patient</strong> - Different cardiologist, so patient is new</div>
                        </div>
                        <div class="simulation-option" data-correct="false">
                            <div class="option-marker">C</div>
                            <div><strong>NEW Patient</strong> - EKG interpretation doesn't count, so no face-to-face in 3 years</div>
                        </div>
                        <div class="simulation-option" data-correct="false">
                            <div class="option-marker">D</div>
                            <div><strong>ESTABLISHED Patient</strong> - Any service within practice within 3 years counts</div>
                        </div>
                    </div>
                    
                    <div id="feedback1" class="feedback-box">
                        <div class="feedback-title">
                            <i class="fas fa-lightbulb"></i> Explanation
                        </div>
                        <p>Correct! John is an <strong>ESTABLISHED</strong> patient to Dr. Davis because:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>He received face-to-face services from Dr. Adams (same specialty - Cardiology) within the past 3 years</li>
                            <li>The EKG interpretation by Dr. Baker doesn't count (not face-to-face)</li>
                            <li>Services from Internal Medicine (different specialty) don't affect Cardiology status</li>
                        </ul>
                    </div>
                    
                    <div class="simulation-question" style="margin: 48px 0 24px 0;">
                        <h3 style="margin: 0; color: var(--accent);">
                            <i class="fas fa-question-circle"></i> Question 2: Presenting Problem Severity
                        </h3>
                        <p style="margin-top: 12px; color: var(--text-primary);">
                            John describes <strong>crushing substernal chest pain</strong> radiating to left arm, associated with diaphoresis and shortness of breath. Vital signs: BP 150/95, HR 110, RR 24. Dr. Davis performs a comprehensive cardiovascular exam, detailed history, reviews previous EKGs, and determines need for urgent cardiology workup.
                        </p>
                    </div>
                    
                    <div class="simulation-options">
                        <div class="simulation-option" data-correct="false">
                            <div class="option-marker">A</div>
                            <div><strong>Low Severity</strong> - Common cardiac symptoms in older patient</div>
                        </div>
                        <div class="simulation-option" data-correct="false">
                            <div class="option-marker">B</div>
                            <div><strong>Moderate Severity</strong> - Concerning but stable vital signs</div>
                        </div>
                        <div class="simulation-option" data-correct="true">
                            <div class="option-marker">C</div>
                            <div><strong>High Severity</strong> - Symptoms suggest possible acute MI, high mortality risk</div>
                        </div>
                        <div class="simulation-option" data-correct="false">
                            <div class="option-marker">D</div>
                            <div><strong>Self-Limited/Minor</strong> - Temporary episode likely related to stress</div>
                        </div>
                    </div>
                    
                    <div id="feedback2" class="feedback-box">
                        <div class="feedback-title">
                            <i class="fas fa-lightbulb"></i> Explanation
                        </div>
                        <p>Correct! This is a <strong>HIGH SEVERITY</strong> presenting problem because:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Symptoms are classic for possible acute myocardial infarction</li>
                            <li>High risk of morbidity and mortality without prompt treatment</li>
                            <li>Requires urgent evaluation and potentially emergency intervention</li>
                            <li>Justifies comprehensive history/exam and complex medical decision making</li>
                        </ul>
                    </div>
                    
                    <div class="simulation-question" style="margin: 48px 0 24px 0;">
                        <h3 style="margin: 0; color: var(--accent);">
                            <i class="fas fa-question-circle"></i> Question 3: E/M Components Present
                        </h3>
                        <p style="margin-top: 12px; color: var(--text-primary);">
                            Which E/M components are demonstrated in Dr. Davis's encounter with John? (Select all that apply)
                        </p>
                    </div>
                    
                    <div class="simulation-options">
                        <div class="simulation-option" data-correct="true" data-multi="true">
                            <div class="option-marker">A</div>
                            <div><strong>History</strong> - Detailed history of present illness obtained</div>
                        </div>
                        <div class="simulation-option" data-correct="true" data-multi="true">
                            <div class="option-marker">B</div>
                            <div><strong>Examination</strong> - Comprehensive cardiovascular exam performed</div>
                        </div>
                        <div class="simulation-option" data-correct="true" data-multi="true">
                            <div class="option-marker">C</div>
                            <div><strong>Medical Decision Making</strong> - Complex decision about urgent workup needed</div>
                        </div>
                        <div class="simulation-option" data-correct="false" data-multi="true">
                            <div class="option-marker">D</div>
                            <div><strong>Counseling Dominates</strong> - Not indicated as primary activity</div>
                        </div>
                    </div>
                    
                    <div id="feedback3" class="feedback-box">
                        <div class="feedback-title">
                            <i class="fas fa-lightbulb"></i> Explanation
                        </div>
                        <p>Correct selections: <strong>A, B, and C</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>History:</strong> Detailed HPI for chest pain symptoms</li>
                            <li><strong>Examination:</strong> Comprehensive cardiovascular physical exam</li>
                            <li><strong>Medical Decision Making:</strong> High complexity due to potential acute MI diagnosis and urgent management decisions</li>
                            <li><strong>Counseling:</strong> Not the dominant service (evaluation and management dominates)</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 40px; text-align: center;">
                        <button class="btn btn-primary" id="checkSimulation" style="font-size: 18px; padding: 20px 40px;">
                            <i class="fas fa-check-double"></i> Check My Answers
                        </button>
                        <button class="btn btn-secondary" id="resetSimulation" style="margin-left: 16px;">
                            <i class="fas fa-redo"></i> Reset Simulation
                        </button>
                    </div>
                </div>
                
                <div class="quiz-card">
                    <div class="quiz-header">
                        <div class="quiz-icon">
                            <i class="fas fa-award"></i>
                        </div>
                        <div class="quiz-question">Final Knowledge Check: Which rule takes precedence when determining new vs established patient status?</div>
                    </div>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">A</div>
                            <div>Any service within the same practice within 3 years</div>
                        </div>
                        <div class="quiz-option" data-correct="true">
                            <div class="option-marker">B</div>
                            <div>Face-to-face service from same specialty/subspecialty within 3 years</div>
                        </div>
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">C</div>
                            <div>Services from the exact same physician only</div>
                        </div>
                        <div class="quiz-option" data-correct="false">
                            <div class="option-marker">D</div>
                            <div>Most recent service regardless of specialty or timeframe</div>
                        </div>
                    </div>
                </div>
                
                <div class="module-footer">
                    <div class="nav-btn-group">
                        <button class="btn btn-secondary" id="prevBtnSimulation">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn btn-primary" id="nextBtnSimulation">
                            Complete Module <i class="fas fa-trophy"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Module data
        const moduleSections = [
            'intro', 'new-patient', 'established-patient', 'em-components', 'presenting-problem', 'simulation'
        ];
        
        const sectionTitles = {
            'intro': 'Introduction',
            'new-patient': 'New Patient Rules',
            'established-patient': 'Established Patient',
            'em-components': 'E/M Components',
            'presenting-problem': 'Presenting Problem',
            'simulation': 'Simulation Activity'
        };
        
        // Initialize module
        let currentSection = 0;
        let completedObjectives = new Set();
        let activeTermPopup = null;
        let simulationAnswers = {
            q1: null,
            q2: null,
            q3: []
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            // Setup navigation
            setupNavigation();
            
            // Setup quizzes
            setupQuizzes();
            
            // Setup simulation
            setupSimulation();
            
            // Update progress
            updateProgress();
            
            // Add scroll effect to header
            setupScrollEffects();
        });
        
        function setupNavigation() {
            // Set up section navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const sectionId = this.dataset.section;
                    goToSection(sectionId);
                });
            });
            
            // Set up next/previous buttons for each section
            setupSectionNavigation('intro', 'new-patient');
            setupSectionNavigation('new-patient', 'established-patient');
            setupSectionNavigation('established-patient', 'em-components');
            setupSectionNavigation('em-components', 'presenting-problem');
            setupSectionNavigation('presenting-problem', 'simulation');
            
            // Last next button completes module
            const nextBtnSimulation = document.getElementById('nextBtnSimulation');
            if (nextBtnSimulation) {
                nextBtnSimulation.addEventListener('click', completeModule);
            }
        }
        
        function setupSectionNavigation(currentSectionId, nextSectionId) {
            const prevBtn = document.getElementById(`prevBtn${capitalizeFirstLetter(currentSectionId)}`);
            const nextBtn = document.getElementById(`nextBtn${capitalizeFirstLetter(currentSectionId)}`);
            
            if (prevBtn) {
                prevBtn.addEventListener('click', goToPreviousSection);
            }
            
            if (nextBtn) {
                nextBtn.addEventListener('click', function() {
                    goToSection(nextSectionId);
                });
            }
        }
        
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
        
        function setupQuizzes() {
            // Setup single-answer quizzes
            document.querySelectorAll('.quiz-option:not([data-multi])').forEach(option => {
                option.addEventListener('click', function() {
                    // Remove any previous selections in this quiz
                    const quizContainer = this.closest('.quiz-options');
                    quizContainer.querySelectorAll('.quiz-option').forEach(opt => {
                        opt.classList.remove('selected', 'correct', 'incorrect');
                    });
                    
                    // Mark this option as selected
                    this.classList.add('selected');
                    
                    // Check if correct
                    const isCorrect = this.dataset.correct === 'true';
                    
                    // Show result with animation
                    if (isCorrect) {
                        this.classList.add('correct');
                        
                        // Add celebration effect
                        this.style.animation = 'pulse 0.5s ease';
                        setTimeout(() => {
                            this.style.animation = '';
                        }, 500);
                        
                        // Mark section as completed
                        const sectionIndex = moduleSections.indexOf(getCurrentSectionId());
                        if (sectionIndex >= 0) {
                            completedObjectives.add(sectionIndex);
                            updateProgress();
                        }
                    } else {
                        this.classList.add('incorrect');
                    }
                });
            });
            
            // Setup case study quizzes
            document.querySelectorAll('.case-study .quiz-option').forEach(option => {
                option.addEventListener('click', function() {
                    // Remove any previous selections in this case study
                    const caseStudy = this.closest('.case-study');
                    caseStudy.querySelectorAll('.quiz-option').forEach(opt => {
                        opt.classList.remove('selected', 'correct', 'incorrect');
                    });
                    
                    // Mark this option as selected
                    this.classList.add('selected');
                    
                    // Check if correct
                    const isCorrect = this.dataset.correct === 'true';
                    
                    // Show result with animation
                    if (isCorrect) {
                        this.classList.add('correct');
                        this.style.animation = 'pulse 0.5s ease';
                        setTimeout(() => {
                            this.style.animation = '';
                        }, 500);
                    } else {
                        this.classList.add('incorrect');
                    }
                });
            });
        }
        
        function setupSimulation() {
            // Setup simulation question 1 (single answer)
            document.querySelectorAll('#simulation .simulation-option:not([data-multi])').forEach(option => {
                option.addEventListener('click', function() {
                    const questionNum = this.closest('.simulation-options').previousElementSibling.textContent.includes('Question 1') ? 1 : 2;
                    
                    // Remove any previous selections in this question
                    const optionsContainer = this.closest('.simulation-options');
                    optionsContainer.querySelectorAll('.simulation-option').forEach(opt => {
                        opt.classList.remove('selected', 'correct', 'incorrect');
                    });
                    
                    // Mark this option as selected
                    this.classList.add('selected');
                    simulationAnswers[`q${questionNum}`] = this;
                    
                    // Show feedback if available
                    const feedbackBox = document.getElementById(`feedback${questionNum}`);
                    if (feedbackBox) {
                        feedbackBox.classList.add('show');
                    }
                });
            });
            
            // Setup simulation question 3 (multiple answers)
            document.querySelectorAll('#simulation .simulation-option[data-multi="true"]').forEach(option => {
                option.addEventListener('click', function() {
                    // Toggle selection
                    this.classList.toggle('selected');
                    
                    // Update answers array
                    const index = Array.from(this.closest('.simulation-options').children).indexOf(this);
                    if (this.classList.contains('selected')) {
                        if (!simulationAnswers.q3.includes(index)) {
                            simulationAnswers.q3.push(index);
                        }
                    } else {
                        simulationAnswers.q3 = simulationAnswers.q3.filter(i => i !== index);
                    }
                    
                    // Show feedback if all correct answers selected
                    checkMultiSelectAnswer();
                });
            });
            
            // Setup check answers button
            const checkBtn = document.getElementById('checkSimulation');
            if (checkBtn) {
                checkBtn.addEventListener('click', checkSimulationAnswers);
            }
            
            // Setup reset button
            const resetBtn = document.getElementById('resetSimulation');
            if (resetBtn) {
                resetBtn.addEventListener('click', resetSimulation);
            }
        }
        
        function checkMultiSelectAnswer() {
            // For question 3, check if correct answers are selected
            const q3Options = document.querySelectorAll('#simulation .simulation-option[data-multi="true"]');
            const correctIndices = [];
            
            q3Options.forEach((option, index) => {
                if (option.dataset.correct === 'true') {
                    correctIndices.push(index);
                }
            });
            
            // Check if all correct answers are selected and no incorrect ones
            const allCorrectSelected = correctIndices.every(index => simulationAnswers.q3.includes(index));
            const noIncorrectSelected = simulationAnswers.q3.every(index => correctIndices.includes(index));
            
            if (allCorrectSelected && noIncorrectSelected && simulationAnswers.q3.length === correctIndices.length) {
                // Show feedback
                const feedbackBox = document.getElementById('feedback3');
                if (feedbackBox) {
                    feedbackBox.classList.add('show');
                }
                
                // Mark options as correct
                q3Options.forEach((option, index) => {
                    if (correctIndices.includes(index)) {
                        option.classList.add('correct');
                        option.classList.remove('incorrect');
                    }
                });
            } else if (simulationAnswers.q3.length > 0) {
                // Mark incorrect selections
                q3Options.forEach((option, index) => {
                    if (simulationAnswers.q3.includes(index) && !correctIndices.includes(index)) {
                        option.classList.add('incorrect');
                        option.classList.remove('correct');
                    } else if (simulationAnswers.q3.includes(index) && correctIndices.includes(index)) {
                        option.classList.add('correct');
                        option.classList.remove('incorrect');
                    }
                });
            }
        }
        
        function checkSimulationAnswers() {
            // Check question 1
            if (simulationAnswers.q1) {
                const isCorrect = simulationAnswers.q1.dataset.correct === 'true';
                if (isCorrect) {
                    simulationAnswers.q1.classList.add('correct');
                } else {
                    simulationAnswers.q1.classList.add('incorrect');
                }
            }
            
            // Check question 2
            if (simulationAnswers.q2) {
                const isCorrect = simulationAnswers.q2.dataset.correct === 'true';
                if (isCorrect) {
                    simulationAnswers.q2.classList.add('correct');
                } else {
                    simulationAnswers.q2.classList.add('incorrect');
                }
            }
            
            // Check question 3
            checkMultiSelectAnswer();
            
            // Mark simulation as completed
            completedObjectives.add(moduleSections.indexOf('simulation'));
            updateProgress();
            
            // Show completion message if all correct
            const allCorrect = 
                simulationAnswers.q1 && simulationAnswers.q1.dataset.correct === 'true' &&
                simulationAnswers.q2 && simulationAnswers.q2.dataset.correct === 'true' &&
                simulationAnswers.q3.length === 3; // A, B, C are correct for Q3
            
            if (allCorrect) {
                setTimeout(() => {
                    alert('Excellent! You successfully completed the simulation with all correct answers!');
                }, 500);
            }
        }
        
        function resetSimulation() {
            // Reset all simulation options
            document.querySelectorAll('#simulation .simulation-option').forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
            });
            
            // Hide feedback boxes
            document.querySelectorAll('#simulation .feedback-box').forEach(box => {
                box.classList.remove('show');
            });
            
            // Reset answers
            simulationAnswers = {
                q1: null,
                q2: null,
                q3: []
            };
        }
        
        function setupScrollEffects() {
            const header = document.getElementById('mainHeader');
            
            window.addEventListener('scroll', function() {
                if (window.scrollY > 50) {
                    header.style.padding = '15px 0';
                    header.style.boxShadow = 'var(--shadow-md)';
                } else {
                    header.style.padding = '20px 0';
                    header.style.boxShadow = 'var(--shadow-sm)';
                }
            });
        }
        
        function goToSection(sectionId) {
            // Update active nav button
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.section === sectionId) {
                    btn.classList.add('active');
                }
            });
            
            // Update active content section
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
                if (section.id === sectionId) {
                    section.classList.add('active');
                }
            });
            
            // Update current section index
            currentSection = moduleSections.indexOf(sectionId);
            
            // Update progress
            updateProgress();
            
            // Update button states
            updateNavigationButtons();
            
            // Scroll to top of section
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function goToNextSection() {
            if (currentSection < moduleSections.length - 1) {
                goToSection(moduleSections[currentSection + 1]);
            }
        }
        
        function goToPreviousSection() {
            if (currentSection > 0) {
                goToSection(moduleSections[currentSection - 1]);
            }
        }
        
        function getCurrentSectionId() {
            return moduleSections[currentSection];
        }
        
        function updateProgress() {
            // Calculate progress based on sections and completed objectives
            const sectionProgress = ((currentSection + 1) / moduleSections.length) * 60;
            const objectiveProgress = (completedObjectives.size / moduleSections.length) * 40;
            const totalProgress = sectionProgress + objectiveProgress;
            
            // Update progress bar
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = `${totalProgress}%`;
            
            // Update progress info
            document.getElementById('currentProgress').textContent = 
                `${sectionTitles[getCurrentSectionId()]}`;
            
            document.getElementById('progressPercent').textContent = 
                `${Math.round(totalProgress)}% Complete`;
            
            // Change progress bar color based on completion
            if (totalProgress >= 100) {
                progressBar.style.background = 'linear-gradient(90deg, var(--success), var(--success-light))';
            }
        }
        
        function updateNavigationButtons() {
            // Previous button disabled on first section
            document.querySelectorAll('.btn-secondary').forEach(btn => {
                if (btn.id.startsWith('prevBtn')) {
                    btn.disabled = currentSection === 0;
                }
            });
            
            // Update next button text on last section
            if (currentSection === moduleSections.length - 1) {
                const nextBtnSimulation = document.getElementById('nextBtnSimulation');
                if (nextBtnSimulation) {
                    nextBtnSimulation.innerHTML = 'Complete Module <i class="fas fa-trophy"></i>';
                }
            }
        }
        
        function completeModule() {
            const celebrationModal = document.getElementById('celebrationModal');
            celebrationModal.style.display = 'flex';
            
            // Mark all sections as completed
            moduleSections.forEach((_, index) => {
                completedObjectives.add(index);
            });
            
            // Update progress to 100%
            updateProgress();
        }
        
        function closeCelebration() {
            document.getElementById('celebrationModal').style.display = 'none';
        }
        
        function restartModule() {
            closeCelebration();
            
            // Reset progress
            completedObjectives.clear();
            currentSection = 0;
            simulationAnswers = {
                q1: null,
                q2: null,
                q3: []
            };
            
            // Reset all quizzes and simulations
            document.querySelectorAll('.quiz-option, .simulation-option').forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
            });
            
            document.querySelectorAll('.feedback-box').forEach(box => {
                box.classList.remove('show');
            });
            
            // Go to introduction
            goToSection('intro');
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft' && currentSection > 0) {
                goToPreviousSection();
            } else if (e.key === 'ArrowRight' && currentSection < moduleSections.length - 1) {
                goToNextSection();
            } else if (e.key === 'Escape' && document.getElementById('celebrationModal').style.display === 'flex') {
                closeCelebration();
            }
        });
    </script>
</body>
</html>
