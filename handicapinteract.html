<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VA Driving Clinic - Module 3: Handicapped Parking in Virginia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --color-primary: #5f17eb; /* Your exact brand purple */
            --color-primary-soft: #8a5feb;
            --color-secondary: #000000; /* Black */
            --color-accent: #7c3aed;
            --color-success: #10b981;
            --color-error: #ef4444;
            --color-warning: #f59e0b;
            --color-bg: #ffffff; /* White */
            --color-text: #000000; /* Black */
            --color-muted: #6b7280;
            --color-dark: #000000; /* Black */
            --color-light: #f9fafb;
            --radius-lg: 20px;
            --radius-md: 12px;
            --radius-sm: 8px;
            --shadow-soft: 0 10px 30px rgba(95, 23, 235, 0.1);
            --shadow-hover: 0 15px 35px rgba(95, 23, 235, 0.15);
            --shadow-card: 0 8px 25px rgba(0, 0, 0, 0.08);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 24px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            color: var(--color-text);
            line-height: 1.6;
        }

        @media (max-width: 600px) {
            body { padding: 12px; }
        }

        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(95, 23, 235, 0.5); }
            50% { box-shadow: 0 0 20px rgba(95, 23, 235, 0.8); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Main Container */
        .page {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: var(--color-bg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 30px;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.8s ease-out;
            border: 1px solid rgba(95, 23, 235, 0.1);
        }

        @media (max-width: 900px) {
            .page { padding: 20px; }
        }

        @media (max-width: 480px) {
            body { padding: 0; }
            .page {
                border-radius: 0;
                box-shadow: none;
                padding: 16px 12px 20px;
            }
        }

        /* Header */
        .brand-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            width: 100%;
            animation: fadeIn 0.6s ease-out 0.2s both;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .brand-logo {
            height: 50px;
            width: auto;
            max-width: 100%;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .brand-logo:hover { 
            transform: scale(1.05); 
            animation: glow 2s infinite;
        }

        .course-meta {
            display: flex;
            flex-direction: column;
            gap: 4px;
            max-width: 100%;
        }

        .course-name {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--color-primary);
            font-weight: 700;
        }

        .week-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 999px;
            background: rgba(95, 23, 235, 0.1);
            font-size: 0.8rem;
            color: var(--color-primary);
            font-weight: 600;
            border: 1px solid rgba(95, 23, 235, 0.2);
        }

        .week-label-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--color-primary);
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }

        .badge-mode {
            padding: 6px 12px;
            border-radius: 999px;
            background: rgba(95, 23, 235, 0.08);
            border: 1px solid rgba(95, 23, 235, 0.15);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-primary);
            white-space: nowrap;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .badge-mode:hover {
            background: rgba(95, 23, 235, 0.15);
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        h1 {
            font-size: clamp(1.8rem, 3vw, 2.4rem);
            line-height: 1.1;
            color: var(--color-text);
            margin-bottom: 10px;
            animation: fadeInUp 0.6s ease-out 0.3s both;
        }

        .module-subtitle {
            font-size: 1rem;
            color: var(--color-muted);
            max-width: 800px;
            margin-bottom: 28px;
            animation: fadeInUp 0.6s ease-out 0.4s both;
            line-height: 1.7;
        }

        /* Time Estimate Banner */
        .time-estimate-banner {
            background: linear-gradient(135deg, rgba(95, 23, 235, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%);
            border: 2px solid rgba(95, 23, 235, 0.2);
            border-radius: var(--radius-md);
            padding: 15px 20px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: fadeIn 0.5s ease;
        }

        .time-estimate-icon {
            font-size: 1.5rem;
            color: var(--color-primary);
            background: rgba(95, 23, 235, 0.1);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .time-estimate-content h3 {
            color: var(--color-primary);
            font-size: 1rem;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .time-estimate-content p {
            color: var(--color-text);
            font-size: 0.9rem;
            margin: 0;
        }

        .time-highlight {
            color: var(--color-primary);
            font-weight: 800;
            font-size: 1.1em;
        }

        /* Stats Display */
        .stats-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 600px) {
            .stats-display { grid-template-columns: 1fr; }
        }

        .stat-card {
            background: rgba(95, 23, 235, 0.05);
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(95, 23, 235, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--color-primary);
            box-shadow: 0 10px 25px rgba(95, 23, 235, 0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--color-primary);
            display: block;
            line-height: 1;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--color-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
        }

        /* Progress Tracker */
        .progress-tracker {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            padding: 0 20px;
        }

        .progress-tracker::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 50px;
            right: 50px;
            height: 3px;
            background: rgba(95, 23, 235, 0.1);
            z-index: 1;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 2px solid rgba(95, 23, 235, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-circle {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
            transform: scale(1.1);
            animation: pulse 2s infinite;
        }

        .progress-step.completed .step-circle {
            background: var(--color-success);
            border-color: var(--color-success);
            color: white;
        }

        .step-label {
            font-size: 0.75rem;
            color: var(--color-muted);
            text-align: center;
            font-weight: 600;
        }

        .progress-step.active .step-label {
            color: var(--color-primary);
            font-weight: 700;
        }

        /* Activity Card */
        .activity-card {
            background: var(--color-bg);
            border-radius: var(--radius-md);
            border: 1px solid rgba(95, 23, 235, 0.15);
            padding: 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .activity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--color-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--color-primary);
        }

        .activity-card:hover::before { 
            opacity: 1;
            animation: glow 2s infinite;
        }

        .activity-card.completed {
            border-color: var(--color-success);
        }

        .activity-card.completed::before {
            background: var(--color-success);
            opacity: 1;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .activity-number {
            font-size: 0.85rem;
            font-weight: 800;
            color: var(--color-primary);
            background: rgba(95, 23, 235, 0.1);
            padding: 4px 12px;
            border-radius: 20px;
            border: 1px solid rgba(95, 23, 235, 0.2);
        }

        .activity-status {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 12px;
            background: rgba(95, 23, 235, 0.08);
            color: var(--color-primary);
            font-weight: 600;
            border: 1px solid rgba(95, 23, 235, 0.15);
        }

        .activity-card.completed .activity-status {
            background: rgba(16, 185, 129, 0.1);
            color: var(--color-success);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .activity-title {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--color-text);
            margin-bottom: 15px;
        }

        .activity-description {
            font-size: 0.95rem;
            color: var(--color-muted);
            margin-bottom: 25px;
            line-height: 1.6;
        }

        /* Eligibility Assessment */
        .eligibility-assessment {
            background: rgba(95, 23, 235, 0.05);
            border-radius: var(--radius-md);
            padding: 25px;
            margin: 25px 0;
            border: 2px solid rgba(95, 23, 235, 0.1);
        }

        .assessment-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .assessment-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .assessment-options { grid-template-columns: 1fr; }
        }

        .assessment-option {
            padding: 18px;
            border-radius: var(--radius-sm);
            border: 2px solid rgba(95, 23, 235, 0.2);
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .assessment-option:hover {
            border-color: var(--color-primary);
            background: rgba(95, 23, 235, 0.05);
            transform: translateY(-2px);
        }

        .assessment-option.selected {
            border-color: var(--color-primary);
            background: rgba(95, 23, 235, 0.1);
            font-weight: 600;
        }

        .assessment-option.eligible {
            border-color: var(--color-success);
            background: rgba(16, 185, 129, 0.1);
        }

        .assessment-option.ineligible {
            border-color: var(--color-muted);
            background: rgba(107, 114, 128, 0.1);
        }

        .option-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(95, 23, 235, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1rem;
            flex-shrink: 0;
            color: var(--color-primary);
            border: 1px solid rgba(95, 23, 235, 0.2);
        }

        .assessment-option.selected .option-icon {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        /* Parking Lot Simulation */
        .parking-simulation {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: var(--radius-md);
            padding: 25px;
            margin: 25px 0;
            border: 2px solid rgba(95, 23, 235, 0.1);
            position: relative;
        }

        .simulation-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .parking-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 20px;
            position: relative;
        }

        @media (max-width: 768px) {
            .parking-grid { grid-template-columns: repeat(3, 1fr); }
        }

        .parking-space {
            height: 120px;
            border-radius: var(--radius-sm);
            background: #e5e7eb;
            border: 3px solid #d1d5db;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .parking-space:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .parking-space.handicapped {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-color: var(--color-primary);
        }

        .parking-space.selected {
            background: rgba(95, 23, 235, 0.1);
            border-color: var(--color-primary);
            border-width: 4px;
            animation: glow 2s infinite;
        }

        .parking-space.occupied {
            background: #fee2e2;
            border-color: var(--color-error);
            cursor: not-allowed;
        }

        .parking-space.occupied::after {
            content: '‚ùå';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: var(--color-error);
        }

        .parking-space.handicapped.occupied {
            background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%);
        }

        .space-symbol {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .space-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--color-text);
            text-align: center;
        }

        .handicapped-icon {
            color: var(--color-primary);
            animation: bounce 2s infinite;
        }

        .access-aisle {
            background: repeating-linear-gradient(
                45deg,
                rgba(95, 23, 235, 0.1),
                rgba(95, 23, 235, 0.1) 10px,
                transparent 10px,
                transparent 20px
            );
            border: 2px dashed rgba(95, 23, 235, 0.3);
            cursor: not-allowed;
        }

        /* Permit Display */
        .permit-display {
            background: white;
            border-radius: var(--radius-md);
            padding: 25px;
            margin: 25px 0;
            border: 2px solid rgba(95, 23, 235, 0.1);
            box-shadow: var(--shadow-card);
        }

        .permit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(95, 23, 235, 0.1);
        }

        .permit-title {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--color-primary);
        }

        .permit-type {
            padding: 6px 12px;
            border-radius: 20px;
            background: rgba(95, 23, 235, 0.1);
            color: var(--color-primary);
            font-size: 0.8rem;
            font-weight: 700;
            border: 1px solid rgba(95, 23, 235, 0.2);
        }

        .permit-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        @media (max-width: 600px) {
            .permit-details { grid-template-columns: 1fr; }
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .detail-label {
            font-size: 0.8rem;
            color: var(--color-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .detail-value {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-text);
        }

        .permit-visual {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, rgba(95, 23, 235, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%);
            border-radius: var(--radius-sm);
            border: 2px solid rgba(95, 23, 235, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .permit-card {
            width: 250px;
            height: 120px;
            background: white;
            border-radius: 10px;
            border: 3px solid var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .permit-text {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--color-primary);
            letter-spacing: 2px;
        }

        /* Quiz Options */
        .quiz-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .quiz-options { grid-template-columns: 1fr; }
        }

        .quiz-option {
            padding: 18px;
            border-radius: var(--radius-sm);
            border: 2px solid rgba(95, 23, 235, 0.2);
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .quiz-option:hover {
            border-color: var(--color-primary);
            background: rgba(95, 23, 235, 0.05);
            transform: translateY(-2px);
        }

        .quiz-option.selected {
            border-color: var(--color-primary);
            background: rgba(95, 23, 235, 0.1);
            font-weight: 600;
        }

        .quiz-option.correct {
            border-color: var(--color-success);
            background: rgba(16, 185, 129, 0.1);
        }

        .quiz-option.incorrect {
            border-color: var(--color-error);
            background: rgba(239, 68, 68, 0.1);
        }

        .option-letter {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(95, 23, 235, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
            color: var(--color-primary);
            border: 1px solid rgba(95, 23, 235, 0.2);
        }

        .quiz-option.selected .option-letter {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        /* Feedback */
        .feedback-container {
            background: rgba(95, 23, 235, 0.03);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 1px solid rgba(95, 23, 235, 0.15);
            margin-top: 20px;
            display: none;
            border-left: 4px solid var(--color-primary);
        }

        .feedback-container.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .feedback-title {
            font-size: 0.95rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .feedback-icon {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .feedback-icon.correct { 
            color: var(--color-success); 
        }
        
        .feedback-icon.incorrect { 
            color: var(--color-error); 
        }

        .feedback-content {
            font-size: 0.9rem;
            color: var(--color-text);
            line-height: 1.7;
        }

        .feedback-content strong { 
            color: var(--color-primary); 
            font-weight: 700;
        }

        .penalty-details {
            background: rgba(239, 68, 68, 0.05);
            border-left: 3px solid var(--color-error);
            padding: 14px 18px;
            margin: 14px 0;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border-radius: var(--radius-md);
            border: none;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
            border: 2px solid var(--color-primary);
        }

        .btn-primary:hover {
            background: #4c0fcf;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(95, 23, 235, 0.4);
            animation: glow 1.5s infinite;
        }

        .btn-secondary {
            background: white;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .btn-secondary:hover {
            background: rgba(95, 23, 235, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(95, 23, 235, 0.2);
        }

        .btn-icon { 
            font-size: 1.2em; 
            font-weight: bold;
        }

        /* Results Panel */
        .results-panel {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: white;
            border-radius: var(--radius-md);
            padding: 40px;
            margin-top: 40px;
            display: none;
            animation: fadeInUp 0.6s ease;
            border: 2px solid var(--color-primary);
        }

        .results-panel.show { 
            display: block; 
            animation: glow 2s infinite;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .results-title {
            font-size: 1.6rem;
            font-weight: 800;
            color: white;
        }

        .score-display {
            font-size: 3.5rem;
            font-weight: 900;
            color: var(--color-primary);
            text-align: center;
            margin: 30px 0;
            text-shadow: 0 0 20px rgba(95, 23, 235, 0.7);
            animation: pulse 2s infinite;
        }

        .safety-insights {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 25px;
            margin-top: 25px;
            border-left: 4px solid var(--color-primary);
        }

        .insights-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .insights-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .insights-list li {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            font-size: 0.95rem;
            color: #e5e7eb;
            line-height: 1.6;
        }

        .insight-dot {
            width: 8px;
            height: 8px;
            margin-top: 10px;
            border-radius: 999px;
            background: var(--color-primary);
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }

        /* Violation Scanner */
        .violation-scanner {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(220, 38, 38, 0.05) 100%);
            border-radius: var(--radius-md);
            padding: 25px;
            margin: 25px 0;
            border: 2px solid rgba(239, 68, 68, 0.2);
        }

        .scanner-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--color-error);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scanner-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .scanner-grid { grid-template-columns: 1fr; }
        }

        .violation-check {
            padding: 15px;
            border-radius: var(--radius-sm);
            border: 2px solid rgba(239, 68, 68, 0.2);
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .violation-check:hover {
            border-color: var(--color-error);
            transform: translateY(-2px);
        }

        .violation-check.selected {
            border-color: var(--color-error);
            background: rgba(239, 68, 68, 0.1);
        }

        .violation-label {
            font-weight: 700;
            color: var(--color-text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .violation-penalty {
            font-size: 0.85rem;
            color: var(--color-error);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <main class="page" aria-labelledby="module-heading">
        <!-- Header -->
        <header class="brand-row">
            <div class="brand">
                <img
                    src="https://lwfiles.mycourse.app/vadrivingclinic-public/9f5c6b8121721c8ef241f929fd983b3e.png"
                    alt="VA Driving Clinic logo"
                    class="brand-logo"
                />
                <div class="course-meta">
                    <span class="course-name">VA Driving Clinic ‚Ä¢ Module 3</span>
                    <div class="week-label">
                        <span class="week-label-dot"></span>
                        <span>Handicapped Parking in Virginia</span>
                    </div>
                </div>
            </div>
            <span class="badge-mode">Interactive Simulation</span>
        </header>

        <h1 id="module-heading">Virginia Handicapped Parking Laws & Accessibility</h1>
        <p class="module-subtitle">
            Learn Virginia's handicapped parking regulations, eligibility requirements, and proper usage through interactive scenarios. 
            Understanding these laws ensures accessibility for individuals with disabilities and prevents violations that carry significant penalties.
        </p>

        <!-- Time Estimate Banner -->
        <div class="time-estimate-banner">
            <div class="time-estimate-icon">
                ‚è±Ô∏è
            </div>
            <div class="time-estimate-content">
                <h3>Module Time Estimate</h3>
                <p>Complete this interactive simulation in approximately <span class="time-highlight">5 minutes</span>. Engage with real-world scenarios that test your understanding of Virginia's handicapped parking laws.</p>
            </div>
        </div>

        <!-- Stats Display -->
        <div class="stats-display">
            <div class="stat-card">
                <span class="stat-number" id="knowledge-score">0%</span>
                <span class="stat-label">Knowledge Score</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="scenarios-completed">0/3</span>
                <span class="stat-label">Scenarios Completed</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="time-spent">0:00</span>
                <span class="stat-label">Time Learning</span>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-step active" data-step="1">
                <div class="step-circle">1</div>
                <div class="step-label">Eligibility</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-circle">2</div>
                <div class="step-label">Proper Use</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-circle">3</div>
                <div class="step-label">Penalties</div>
            </div>
        </div>

        <!-- Main Activity Card -->
        <div class="activity-card" id="main-activity">
            <div class="activity-header">
                <span class="activity-number">Handicapped Parking Simulation</span>
                <span class="activity-status">In Progress</span>
            </div>
            <h3 class="activity-title">Virginia Handicapped Parking Regulations Mastery</h3>
            <p class="activity-description">
                Navigate through Virginia's handicapped parking regulations. Understand eligibility requirements, proper permit usage, and the consequences of violations through interactive decision-making exercises.
            </p>

            <!-- Part 1: Eligibility Assessment -->
            <div class="eligibility-assessment" id="eligibility-part">
                <h4 class="assessment-title">Part 1: Eligibility Assessment</h4>
                <p style="margin-bottom: 20px; color: var(--color-text);">Select which conditions qualify for a handicapped parking permit in Virginia:</p>
                
                <div class="assessment-options">
                    <div class="assessment-option" data-condition="walking" data-eligible="true">
                        <div class="option-icon">üö∂</div>
                        <div>
                            <strong>Cannot walk 200 feet without resting</strong>
                            <div style="font-size: 0.85rem; color: var(--color-muted); margin-top: 5px;">Due to physical disability or condition</div>
                        </div>
                    </div>
                    <div class="assessment-option" data-condition="wheelchair" data-eligible="true">
                        <div class="option-icon">‚ôø</div>
                        <div>
                            <strong>Uses wheelchair, walker, or crutches</strong>
                            <div style="font-size: 0.85rem; color: var(--color-muted); margin-top: 5px;">For mobility assistance</div>
                        </div>
                    </div>
                    <div class="assessment-option" data-condition="cardiac" data-eligible="true">
                        <div class="option-icon">‚ù§Ô∏è</div>
                        <div>
                            <strong>Cardiac condition Class III or IV</strong>
                            <div style="font-size: 0.85rem; color: var(--color-muted); margin-top: 5px;">American Heart Association classification</div>
                        </div>
                    </div>
                    <div class="assessment-option" data-condition="blind" data-eligible="true">
                        <div class="option-icon">üëÅÔ∏è</div>
                        <div>
                            <strong>Legally blind</strong>
                            <div style="font-size: 0.85rem; color: var(--color-muted); margin-top: 5px;">Visual impairment that qualifies</div>
                        </div>
                    </div>
                    <div class="assessment-option" data-condition="temporary" data-eligible="true">
                        <div class="option-icon">ü©π</div>
                        <div>
                            <strong>Temporary disability (6 months)</strong>
                            <div style="font-size: 0.85rem; color: var(--color-muted); margin-top: 5px;">Post-surgery, injury recovery</div>
                        </div>
                    </div>
                    <div class="assessment-option" data-condition="age" data-eligible="false">
                        <div class="option-icon">üëµ</div>
                        <div>
                            <strong>Over 65 years old</strong>
                            <div style="font-size: 0.85rem; color: var(--color-muted); margin-top: 5px;">Age alone doesn't qualify</div>
                        </div>
                    </div>
                    <div class="assessment-option" data-condition="pregnancy" data-eligible="false">
                        <div class="option-icon">ü§∞</div>
                        <div>
                            <strong>Pregnancy without complications</strong>
                            <div style="font-size: 0.85rem; color: var(--color-muted); margin-top: 5px;">Not a qualifying condition</div>
                        </div>
                    </div>
                    <div class="assessment-option" data-condition="convenience" data-eligible="false">
                        <div class="option-icon">‚è±Ô∏è</div>
                        <div>
                            <strong>For shopping convenience</strong>
                            <div style="font-size: 0.85rem; color: var(--color-muted); margin-top: 5px;">Not a valid reason</div>
                        </div>
                    </div>
                </div>
                
                <div class="feedback-container" id="eligibility-feedback" style="display: none;">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">‚úì</span>
                        Eligibility Requirements
                    </div>
                    <div class="feedback-content">
                        <strong>Qualifying Conditions in Virginia:</strong><br><br>
                        ‚Ä¢ <strong>Mobility Impairments:</strong> Cannot walk 200 feet without resting, uses assistive devices<br>
                        ‚Ä¢ <strong>Cardiac/Lung Conditions:</strong> Class III/IV cardiac, severe lung disease requiring oxygen<br>
                        ‚Ä¢ <strong>Visual Impairment:</strong> Legally blind<br>
                        ‚Ä¢ <strong>Temporary Disabilities:</strong> Up to 6 months (extendable)<br><br>
                        
                        <strong>Medical Certification Required:</strong> Must be completed by licensed physician, physician assistant, nurse practitioner, podiatrist, or chiropractor using Form MED 10.<br><br>
                        
                        <strong>Non-Qualifying:</strong> Age alone, pregnancy without complications, convenience. Permanent placards are FREE in Virginia.
                    </div>
                </div>
            </div>

            <!-- Part 2: Parking Lot Simulation -->
            <div class="parking-simulation" id="parking-part" style="display: none;">
                <h4 class="simulation-title">Part 2: Parking Lot Scenario</h4>
                <p style="margin-bottom: 20px; color: var(--color-text);">You have a valid handicapped placard. Select where you can legally park:</p>
                
                <div class="parking-grid">
                    <!-- Row 1 -->
                    <div class="parking-space regular" data-space="A1">
                        <div class="space-symbol">üÖøÔ∏è</div>
                        <div class="space-label">A1</div>
                    </div>
                    <div class="parking-space regular" data-space="A2">
                        <div class="space-symbol">üÖøÔ∏è</div>
                        <div class="space-label">A2</div>
                    </div>
                    <div class="parking-space handicapped" data-space="A3">
                        <div class="space-symbol handicapped-icon">‚ôø</div>
                        <div class="space-label">A3 (Handicapped)</div>
                    </div>
                    <div class="access-aisle" data-space="Aisle1">
                        <div class="space-symbol">üö´</div>
                        <div class="space-label">Access Aisle</div>
                    </div>
                    <div class="parking-space handicapped occupied" data-space="A4">
                        <div class="space-symbol handicapped-icon">‚ôø</div>
                        <div class="space-label">A4 (Occupied)</div>
                    </div>
                    
                    <!-- Row 2 -->
                    <div class="parking-space regular occupied" data-space="B1">
                        <div class="space-symbol">üÖøÔ∏è</div>
                        <div class="space-label">B1 (Occupied)</div>
                    </div>
                    <div class="parking-space regular" data-space="B2">
                        <div class="space-symbol">üÖøÔ∏è</div>
                        <div class="space-label">B2</div>
                    </div>
                    <div class="parking-space handicapped" data-space="B3">
                        <div class="space-symbol handicapped-icon">‚ôø</div>
                        <div class="space-label">B3 (Handicapped)</div>
                    </div>
                    <div class="access-aisle" data-space="Aisle2">
                        <div class="space-symbol">üö´</div>
                        <div class="space-label">Access Aisle</div>
                    </div>
                    <div class="parking-space regular" data-space="B4">
                        <div class="space-symbol">üÖøÔ∏è</div>
                        <div class="space-label">B4</div>
                    </div>
                </div>
                
                <div class="permit-display">
                    <div class="permit-header">
                        <h5 class="permit-title">Your Virginia Handicapped Placard</h5>
                        <span class="permit-type">PERMANENT</span>
                    </div>
                    <div class="permit-details">
                        <div class="detail-item">
                            <span class="detail-label">Permit Number</span>
                            <span class="detail-value">VA-HC-7890-2024</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Expiration Date</span>
                            <span class="detail-value">06/30/2029</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Holder Name</span>
                            <span class="detail-value">John M. Wilson</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Type</span>
                            <span class="detail-value">Placard (Hanging)</span>
                        </div>
                    </div>
                    <div class="permit-visual">
                        <div class="permit-card">
                            <div class="permit-text">VIRGINIA<br>DISABLED PARKING</div>
                        </div>
                    </div>
                </div>
                
                <div class="feedback-container" id="parking-feedback" style="display: none;">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">‚úì</span>
                        Parking Rules Analysis
                    </div>
                    <div class="feedback-content">
                        <strong>Correct Parking Choices:</strong><br><br>
                        ‚Ä¢ <strong>Handicapped Spaces (A3, B3):</strong> ‚úÖ Legal with valid placard<br>
                        ‚Ä¢ <strong>Regular Spaces (A1, A2, B2, B4):</strong> ‚úÖ Legal - placard holders can use any space<br>
                        ‚Ä¢ <strong>Occupied Handicapped (A4):</strong> ‚ùå Illegal - space already taken<br>
                        ‚Ä¢ <strong>Access Aisles:</strong> üö´ NEVER legal - required for wheelchair access<br><br>
                        
                        <strong>Virginia Regulations:</strong><br>
                        1. Placard must be displayed from rearview mirror when parked<br>
                        2. Permit holder must be present in vehicle<br>
                        3. Remove placard when driving to avoid obstruction<br>
                        4. Access aisles (8+ feet wide) must remain clear for wheelchair ramps<br><br>
                        
                        <strong>Note:</strong> Handicapped placard allows parking at meters for FREE with no time limits in Virginia.
                    </div>
                </div>
            </div>

            <!-- Part 3: Violation Scanner -->
            <div class="violation-scanner" id="violation-part" style="display: none;">
                <h4 class="scanner-title">Part 3: Violation Identification</h4>
                <p style="margin-bottom: 20px; color: var(--color-text);">Identify which situations constitute handicapped parking violations in Virginia:</p>
                
                <div class="scanner-grid">
                    <div class="violation-check" data-violation="no-permit" data-violates="true">
                        <div class="violation-label">
                            <span>üö´</span>
                            <span>Parking in handicapped space without permit</span>
                        </div>
                        <div class="violation-penalty">Fine: $100-500 + Towing</div>
                    </div>
                    <div class="violation-check" data-violation="expired" data-violates="true">
                        <div class="violation-label">
                            <span>üìÖ</span>
                            <span>Using expired placard</span>
                        </div>
                        <div class="violation-penalty">Fine: $100-250</div>
                    </div>
                    <div class="violation-check" data-violation="access-aisle" data-violates="true">
                        <div class="violation-label">
                            <span>üö∑</span>
                            <span>Parking in access aisle</span>
                        </div>
                        <div class="violation-penalty">Fine: $100-500 + Towing</div>
                    </div>
                    <div class="violation-check" data-violation="borrowed" data-violates="true">
                        <div class="violation-label">
                            <span>üë§</span>
                            <span>Using someone else's permit</span>
                        </div>
                        <div class="violation-penalty">Fine: $250-500 + Revocation</div>
                    </div>
                    <div class="violation-check" data-violation="meter-parking" data-violates="false">
                        <div class="violation-label">
                            <span>‚è±Ô∏è</span>
                            <span>Parking at meter with valid placard</span>
                        </div>
                        <div class="violation-penalty">Legal - Free & Unlimited</div>
                    </div>
                    <div class="violation-check" data-violation="dropping-off" data-violates="false">
                        <div class="violation-label">
                            <span>üëã</span>
                            <span>Quick drop-off/pick-up in access aisle</span>
                        </div>
                        <div class="violation-penalty">Legal - Less than 5 minutes</div>
                    </div>
                </div>
                
                <!-- Quiz Questions -->
                <div style="margin-top: 30px;">
                    <div style="font-size: 1rem; font-weight: 700; color: var(--color-text); margin-bottom: 15px;">Quick Knowledge Check:</div>
                    
                    <div class="quiz-options">
                        <div class="quiz-option" data-question="display" data-option="A">
                            <span class="option-letter">A</span>
                            <span>Display placard from rearview mirror when parked</span>
                        </div>
                        <div class="quiz-option" data-question="display" data-option="B">
                            <span class="option-letter">B</span>
                            <span>Leave placard on dashboard when parked</span>
                        </div>
                    </div>
                    
                    <div class="quiz-options" style="margin-top: 15px;">
                        <div class="quiz-option" data-question="holder" data-option="A">
                            <span class="option-letter">A</span>
                            <span>Permit holder must be in or entering/exiting vehicle</span>
                        </div>
                        <div class="quiz-option" data-question="holder" data-option="B">
                            <span class="option-letter">B</span>
                            <span>Any family member can use the permit</span>
                        </div>
                    </div>
                </div>
                
                <div class="feedback-container" id="violation-feedback" style="display: none;">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">‚úì</span>
                        Violation Analysis
                    </div>
                    <div class="feedback-content">
                        <strong>Virginia Handicapped Parking Violations:</strong><br><br>
                        ‚Ä¢ <strong>No Permit in Handicapped Space:</strong> $100-500 fine + towing at owner's expense<br>
                        ‚Ä¢ <strong>Using Expired/Counterfeit Permit:</strong> $100-250 fine + possible criminal charges<br>
                        ‚Ä¢ <strong>Parking in Access Aisle:</strong> $100-500 fine + immediate towing<br>
                        ‚Ä¢ <strong>Using Someone Else's Permit:</strong> $250-500 fine + permit revocation<br><br>
                        
                        <div class="penalty-details">
                            <strong>Enhanced Penalties:</strong><br>
                            ‚Ä¢ Second offense within 12 months: Double fines<br>
                            ‚Ä¢ Misrepresentation to obtain permit: Class 2 misdemeanor<br>
                            ‚Ä¢ Law enforcement can confiscate fraudulent permits<br><br>
                            
                            <strong>Reporting Violations:</strong> Call local police non-emergency number or use Virginia State Police online reporting.
                        </div>
                        
                        <strong>Correct Answers:</strong><br>
                        1. <strong>A - Display from rearview mirror</strong> (Remove when driving)<br>
                        2. <strong>A - Permit holder must be present</strong> (Not transferable to others)
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-secondary" id="reset-btn">
                <span class="btn-icon">‚Üª</span>
                Reset Simulation
            </button>
            <button class="btn btn-secondary" id="next-part-btn">
                <span class="btn-icon">‚Üí</span>
                Next Section
            </button>
            <button class="btn btn-primary" id="complete-btn" disabled>
                <span class="btn-icon">üìä</span>
                Complete Simulation
            </button>
        </div>

        <!-- Results Panel -->
        <div class="results-panel" id="results-panel">
            <div class="results-header">
                <h2 class="results-title">Handicapped Parking Proficiency</h2>
                <div class="score-display" id="final-score">0%</div>
            </div>
            
            <div class="safety-insights">
                <h3 class="insights-title">
                    <span>‚ôø</span> Why Handicapped Parking Matters
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Accessibility is a Right:</strong> The Americans with Disabilities Act (ADA) requires accessible parking. Each space saves 100+ feet of walking for someone with mobility challenges.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Safety First:</strong> Access aisles (8-foot minimum) allow wheelchair ramp deployment. Blocking these aisles can trap disabled individuals in their vehicles or force dangerous maneuvering in traffic lanes.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Economic Impact:</strong> Misuse costs businesses - when disabled customers can't access stores, they shop elsewhere. Virginia's enforcement ensures spaces remain available for those who need them.</span>
                    </li>
                </ul>
            </div>
            
            <div class="safety-insights" style="margin-top: 20px;">
                <h3 class="insights-title">
                    <span>üìã</span> Best Practices & Community Responsibility
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Verify Before Parking:</strong> Look for the International Symbol of Access (wheelchair symbol) and check pavement markings. Remember: Blue curbs = handicapped parking in Virginia.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Report Violations:</strong> Note license plate, location, and violation details. Virginia police take these reports seriously - your report helps maintain accessibility.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Educate Others:</strong> Share that temporary permits exist for short-term disabilities. Many people don't realize broken legs, surgeries, or other temporary conditions qualify.</span>
                    </li>
                </ul>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // State Management
            const state = {
                currentPart: 1,
                partsCompleted: 0,
                correctAnswers: 0,
                totalQuestions: 0,
                startedAt: new Date(),
                selectedConditions: new Set(),
                selectedParking: null,
                selectedViolations: new Set(),
                quizAnswers: {}
            };

            // Correct data
            const correctData = {
                eligibility: {
                    walking: true,
                    wheelchair: true,
                    cardiac: true,
                    blind: true,
                    temporary: true,
                    age: false,
                    pregnancy: false,
                    convenience: false
                },
                parking: ['A3', 'B3', 'A1', 'A2', 'B2', 'B4'], // Legal spaces
                violations: {
                    'no-permit': true,
                    'expired': true,
                    'access-aisle': true,
                    'borrowed': true,
                    'meter-parking': false,
                    'dropping-off': false
                },
                quiz: {
                    'display': 'A',
                    'holder': 'A'
                }
            };

            // DOM Elements
            const activityParts = document.querySelectorAll('.eligibility-assessment, .parking-simulation, .violation-scanner');
            const assessmentOptions = document.querySelectorAll('.assessment-option');
            const parkingSpaces = document.querySelectorAll('.parking-space');
            const violationChecks = document.querySelectorAll('.violation-check');
            const quizOptions = document.querySelectorAll('.quiz-option');
            const nextBtn = document.getElementById('next-part-btn');
            const resetBtn = document.getElementById('reset-btn');
            const completeBtn = document.getElementById('complete-btn');
            const resultsPanel = document.getElementById('results-panel');
            const finalScore = document.getElementById('final-score');
            const knowledgeScoreEl = document.getElementById('knowledge-score');
            const scenariosCompletedEl = document.getElementById('scenarios-completed');
            const timeSpentEl = document.getElementById('time-spent');

            // Timer for time spent
            function updateTimer() {
                const now = new Date();
                const diff = Math.floor((now - state.startedAt) / 1000);
                const minutes = Math.floor(diff / 60);
                const seconds = diff % 60;
                timeSpentEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // Update stats
                const score = state.totalQuestions > 0 
                    ? Math.round((state.correctAnswers / state.totalQuestions) * 100) 
                    : 0;
                knowledgeScoreEl.textContent = `${score}%`;
                scenariosCompletedEl.textContent = `${state.partsCompleted}/3`;
            }

            setInterval(updateTimer, 1000);

            // Update progress steps
            function updateProgress() {
                const progressSteps = document.querySelectorAll('.progress-step');
                progressSteps.forEach((step, index) => {
                    if (state.currentPart === 1 && index === 0) {
                        step.classList.add('active');
                        step.classList.remove('completed');
                    } else if (state.currentPart === 2 && index === 1) {
                        step.classList.add('active');
                        progressSteps[0].classList.add('completed');
                        progressSteps[0].classList.remove('active');
                    } else if (state.currentPart === 3 && index === 2) {
                        step.classList.add('active');
                        progressSteps[0].classList.add('completed');
                        progressSteps[1].classList.add('completed');
                        progressSteps[1].classList.remove('active');
                    } else if (state.currentPart > 3 && index === 2) {
                        step.classList.add('completed');
                        step.classList.remove('active');
                    }
                });
            }

            // Part 1: Eligibility Assessment
            function initEligibility() {
                assessmentOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const condition = this.dataset.condition;
                        const eligible = this.dataset.eligible === 'true';
                        
                        // Toggle selection
                        if (this.classList.contains('selected')) {
                            this.classList.remove('selected');
                            state.selectedConditions.delete(condition);
                        } else {
                            this.classList.add('selected');
                            state.selectedConditions.add(condition);
                        }
                        
                        // Check if at least 3 conditions selected
                        if (state.selectedConditions.size >= 3) {
                            showEligibilityFeedback();
                        }
                    });
                });
            }

            function showEligibilityFeedback() {
                // Calculate score for this part
                let correct = 0;
                let total = Object.keys(correctData.eligibility).length;
                
                assessmentOptions.forEach(option => {
                    const condition = option.dataset.condition;
                    const eligible = option.dataset.eligible === 'true';
                    const isSelected = option.classList.contains('selected');
                    
                    // Check if selection matches correct answer
                    const shouldBeSelected = correctData.eligibility[condition];
                    
                    if (shouldBeSelected && isSelected) {
                        correct++;
                        option.classList.add('eligible');
                    } else if (!shouldBeSelected && !isSelected) {
                        correct++;
                    } else if (!shouldBeSelected && isSelected) {
                        option.classList.add('ineligible');
                    }
                });
                
                // Update state
                state.correctAnswers += correct;
                state.totalQuestions += total;
                state.partsCompleted = 1;
                
                // Show feedback
                document.getElementById('eligibility-feedback').classList.add('show');
                
                // Enable next button
                nextBtn.disabled = false;
            }

            // Part 2: Parking Lot Simulation
            function initParking() {
                parkingSpaces.forEach(space => {
                    space.addEventListener('click', function() {
                        // Skip occupied spaces and access aisles
                        if (this.classList.contains('occupied') || this.classList.contains('access-aisle')) {
                            this.classList.add('incorrect');
                            setTimeout(() => {
                                this.classList.remove('incorrect');
                            }, 500);
                            return;
                        }
                        
                        const spaceId = this.dataset.space;
                        
                        // Clear previous selection
                        parkingSpaces.forEach(s => s.classList.remove('selected'));
                        
                        // Select this space
                        this.classList.add('selected');
                        state.selectedParking = spaceId;
                        
                        // Show feedback after short delay
                        setTimeout(showParkingFeedback, 500);
                    });
                });
            }

            function showParkingFeedback() {
                // Check if selected space is legal
                const isLegal = correctData.parking.includes(state.selectedParking);
                
                // Update state
                state.correctAnswers += isLegal ? 1 : 0;
                state.totalQuestions += 1;
                state.partsCompleted = 2;
                
                // Show feedback
                document.getElementById('parking-feedback').classList.add('show');
                
                // Enable next button
                nextBtn.disabled = false;
            }

            // Part 3: Violation Scanner
            function initViolations() {
                violationChecks.forEach(check => {
                    check.addEventListener('click', function() {
                        const violation = this.dataset.violation;
                        
                        // Toggle selection
                        this.classList.toggle('selected');
                        
                        if (this.classList.contains('selected')) {
                            state.selectedViolations.add(violation);
                        } else {
                            state.selectedViolations.delete(violation);
                        }
                        
                        // Check if all violations selected
                        if (state.selectedViolations.size >= 4) {
                            checkViolationAnswers();
                        }
                    });
                });
                
                quizOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const question = this.dataset.question;
                        const answer = this.dataset.option;
                        
                        // Remove selection from other options for same question
                        const allOptions = document.querySelectorAll(`[data-question="${question}"]`);
                        allOptions.forEach(opt => opt.classList.remove('selected'));
                        
                        // Select this option
                        this.classList.add('selected');
                        state.quizAnswers[question] = answer;
                        
                        // Check if both quiz questions answered
                        if (Object.keys(state.quizAnswers).length === 2) {
                            checkQuizAnswers();
                        }
                    });
                });
            }

            function checkViolationAnswers() {
                let correct = 0;
                let total = Object.keys(correctData.violations).length;
                
                violationChecks.forEach(check => {
                    const violation = check.dataset.violation;
                    const shouldViolate = correctData.violations[violation];
                    const isSelected = check.classList.contains('selected');
                    
                    if (shouldViolate && isSelected) {
                        correct++;
                        check.classList.add('correct');
                    } else if (!shouldViolate && !isSelected) {
                        correct++;
                    } else if (shouldViolate && !isSelected) {
                        check.classList.add('incorrect');
                    } else if (!shouldViolate && isSelected) {
                        check.classList.add('incorrect');
                    }
                });
                
                // Update state
                state.correctAnswers += correct;
                state.totalQuestions += total;
            }

            function checkQuizAnswers() {
                let correct = 0;
                let total = Object.keys(correctData.quiz).length;
                
                quizOptions.forEach(option => {
                    const question = option.dataset.question;
                    const answer = option.dataset.option;
                    const correctAnswer = correctData.quiz[question];
                    
                    if (answer === correctAnswer && option.classList.contains('selected')) {
                        correct++;
                        option.classList.add('correct');
                    } else if (answer === correctAnswer) {
                        option.classList.add('correct');
                    } else if (option.classList.contains('selected')) {
                        option.classList.add('incorrect');
                    }
                });
                
                // Update state
                state.correctAnswers += correct;
                state.totalQuestions += total;
                state.partsCompleted = 3;
                
                // Show feedback and enable complete button
                document.getElementById('violation-feedback').classList.add('show');
                completeBtn.disabled = false;
            }

            // Next part button
            nextBtn.addEventListener('click', function() {
                if (state.currentPart < 3) {
                    // Hide current part
                    activityParts.forEach((part, index) => {
                        part.style.display = index === state.currentPart ? 'block' : 'none';
                    });
                    
                    // Show next part
                    state.currentPart++;
                    
                    // Update progress
                    updateProgress();
                    
                    // Initialize next part
                    if (state.currentPart === 2) {
                        initParking();
                    } else if (state.currentPart === 3) {
                        initViolations();
                    }
                    
                    // Reset button text for last part
                    if (state.currentPart === 3) {
                        this.textContent = 'Complete Assessment';
                    }
                    
                    // Disable until interaction
                    this.disabled = true;
                }
            });

            // Complete simulation
            completeBtn.addEventListener('click', function() {
                // Calculate final score
                const score = state.totalQuestions > 0 
                    ? Math.round((state.correctAnswers / state.totalQuestions) * 100) 
                    : 0;
                finalScore.textContent = `${score}%`;
                
                // Show results
                resultsPanel.classList.add('show');
                resultsPanel.scrollIntoView({ behavior: 'smooth' });
                
                // Update activity status
                document.querySelector('.activity-status').textContent = 'Completed';
                document.querySelector('.activity-status').style.color = '#10b981';
                document.getElementById('main-activity').classList.add('completed');
            });

            // Reset simulation
            resetBtn.addEventListener('click', function() {
                // Reset state
                state.currentPart = 1;
                state.partsCompleted = 0;
                state.correctAnswers = 0;
                state.totalQuestions = 0;
                state.selectedConditions.clear();
                state.selectedParking = null;
                state.selectedViolations.clear();
                state.quizAnswers = {};
                state.startedAt = new Date();
                
                // Reset UI
                activityParts.forEach((part, index) => {
                    part.style.display = index === 0 ? 'block' : 'none';
                });
                
                assessmentOptions.forEach(option => {
                    option.classList.remove('selected', 'eligible', 'ineligible');
                });
                
                parkingSpaces.forEach(space => {
                    space.classList.remove('selected', 'incorrect');
                });
                
                violationChecks.forEach(check => {
                    check.classList.remove('selected', 'correct', 'incorrect');
                });
                
                quizOptions.forEach(option => {
                    option.classList.remove('selected', 'correct', 'incorrect');
                });
                
                // Hide feedback
                document.querySelectorAll('.feedback-container').forEach(feedback => {
                    feedback.classList.remove('show');
                });
                
                // Reset buttons
                nextBtn.disabled = true;
                completeBtn.disabled = true;
                nextBtn.textContent = 'Next Section';
                resultsPanel.classList.remove('show');
                
                // Reset activity status
                document.querySelector('.activity-status').textContent = 'In Progress';
                document.querySelector('.activity-status').style.color = '';
                document.getElementById('main-activity').classList.remove('completed');
                
                // Update progress
                updateProgress();
                updateTimer();
            });

            // Initialize
            initEligibility();
            updateTimer();
            updateProgress();
        });
    </script>
</body>
</html>
