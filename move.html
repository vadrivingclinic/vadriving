<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VA Driving Clinic - Module 4: Move Over Law in Virginia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --color-primary: #5f17eb;
            --color-primary-soft: #8a5feb;
            --color-secondary: #000000;
            --color-accent: #7c3aed;
            --color-success: #10b981;
            --color-error: #ef4444;
            --color-warning: #f59e0b;
            --color-bg: #ffffff;
            --color-text: #000000;
            --color-muted: #6b7280;
            --color-dark: #000000;
            --color-light: #f9fafb;
            --radius-lg: 20px;
            --radius-md: 12px;
            --radius-sm: 8px;
            --shadow-soft: 0 10px 30px rgba(95, 23, 235, 0.1);
            --shadow-hover: 0 15px 35px rgba(95, 23, 235, 0.15);
            --shadow-card: 0 8px 25px rgba(0, 0, 0, 0.08);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 24px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            color: var(--color-text);
            line-height: 1.6;
        }

        @media (max-width: 600px) {
            body { padding: 12px; }
        }

        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(95, 23, 235, 0.5); }
            50% { box-shadow: 0 0 20px rgba(95, 23, 235, 0.8); }
        }

        @keyframes warningPulse {
            0%, 100% { background-color: rgba(239, 68, 68, 0.1); }
            50% { background-color: rgba(239, 68, 68, 0.3); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Main Container */
        .page {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: var(--color-bg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 30px;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.8s ease-out;
            border: 1px solid rgba(95, 23, 235, 0.1);
        }

        @media (max-width: 900px) {
            .page { padding: 20px; }
        }

        @media (max-width: 480px) {
            body { padding: 0; }
            .page {
                border-radius: 0;
                box-shadow: none;
                padding: 16px 12px 20px;
            }
        }

        /* Header */
        .brand-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            width: 100%;
            animation: fadeIn 0.6s ease-out 0.2s both;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .brand-logo {
            height: 50px;
            width: auto;
            max-width: 100%;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .brand-logo:hover { 
            transform: scale(1.05); 
            animation: glow 2s infinite;
        }

        .course-meta {
            display: flex;
            flex-direction: column;
            gap: 4px;
            max-width: 100%;
        }

        .course-name {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--color-primary);
            font-weight: 700;
        }

        .week-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 999px;
            background: rgba(95, 23, 235, 0.1);
            font-size: 0.8rem;
            color: var(--color-primary);
            font-weight: 600;
            border: 1px solid rgba(95, 23, 235, 0.2);
        }

        .week-label-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--color-primary);
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }

        .badge-mode {
            padding: 6px 12px;
            border-radius: 999px;
            background: rgba(95, 23, 235, 0.08);
            border: 1px solid rgba(95, 23, 235, 0.15);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-primary);
            white-space: nowrap;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .badge-mode:hover {
            background: rgba(95, 23, 235, 0.15);
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        h1 {
            font-size: clamp(1.8rem, 3vw, 2.4rem);
            line-height: 1.1;
            color: var(--color-text);
            margin-bottom: 10px;
            animation: fadeInUp 0.6s ease-out 0.3s both;
        }

        .module-subtitle {
            font-size: 1rem;
            color: var(--color-muted);
            max-width: 800px;
            margin-bottom: 28px;
            animation: fadeInUp 0.6s ease-out 0.4s both;
            line-height: 1.7;
        }

        /* Stats Display */
        .stats-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 600px) {
            .stats-display { grid-template-columns: 1fr; }
        }

        .stat-card {
            background: rgba(95, 23, 235, 0.05);
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(95, 23, 235, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--color-primary);
            box-shadow: 0 10px 25px rgba(95, 23, 235, 0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--color-primary);
            display: block;
            line-height: 1;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--color-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
        }

        /* Progress Tracker */
        .progress-tracker {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            padding: 0 20px;
        }

        .progress-tracker::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 50px;
            right: 50px;
            height: 3px;
            background: rgba(95, 23, 235, 0.1);
            z-index: 1;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 2px solid rgba(95, 23, 235, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-circle {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
            transform: scale(1.1);
            animation: pulse 2s infinite;
        }

        .progress-step.completed .step-circle {
            background: var(--color-success);
            border-color: var(--color-success);
            color: white;
        }

        .step-label {
            font-size: 0.75rem;
            color: var(--color-muted);
            text-align: center;
            font-weight: 600;
        }

        .progress-step.active .step-label {
            color: var(--color-primary);
            font-weight: 700;
        }

        /* Activity Card */
        .activity-card {
            background: var(--color-bg);
            border-radius: var(--radius-md);
            border: 1px solid rgba(95, 23, 235, 0.15);
            padding: 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .activity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--color-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--color-primary);
        }

        .activity-card:hover::before { 
            opacity: 1;
            animation: glow 2s infinite;
        }

        .activity-card.completed {
            border-color: var(--color-success);
        }

        .activity-card.completed::before {
            background: var(--color-success);
            opacity: 1;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .activity-number {
            font-size: 0.85rem;
            font-weight: 800;
            color: var(--color-primary);
            background: rgba(95, 23, 235, 0.1);
            padding: 4px 12px;
            border-radius: 20px;
            border: 1px solid rgba(95, 23, 235, 0.2);
        }

        .activity-status {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 12px;
            background: rgba(95, 23, 235, 0.08);
            color: var(--color-primary);
            font-weight: 600;
            border: 1px solid rgba(95, 23, 235, 0.15);
        }

        .activity-card.completed .activity-status {
            background: rgba(16, 185, 129, 0.1);
            color: var(--color-success);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .activity-title {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--color-text);
            margin-bottom: 15px;
        }

        .activity-description {
            font-size: 0.95rem;
            color: var(--color-muted);
            margin-bottom: 25px;
            line-height: 1.6;
        }

        /* Highway Simulation */
        .highway-simulation {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: var(--radius-md);
            padding: 25px;
            margin: 25px 0;
            border: 2px solid rgba(95, 23, 235, 0.3);
            position: relative;
            overflow: hidden;
            min-height: 500px;
        }

        .simulation-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: white;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .highway-container {
            width: 100%;
            height: 300px;
            background: #1a1a1a;
            border-radius: var(--radius-sm);
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        /* Road Markings */
        .road {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 200px;
            transform: translateY(-50%);
            background: #333;
        }

        .lane {
            position: absolute;
            width: 100%;
            height: 4px;
            background: repeating-linear-gradient(
                90deg,
                #fff,
                #fff 30px,
                transparent 30px,
                transparent 60px
            );
        }

        .lane-1 { top: 30%; }
        .lane-2 { top: 50%; }
        .lane-3 { top: 70%; }

        /* Vehicles */
        .vehicle {
            position: absolute;
            width: 80px;
            height: 40px;
            border-radius: 5px;
            transition: all 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .your-car {
            background: linear-gradient(135deg, var(--color-primary) 0%, #4c0fcf 100%);
            left: 100px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            border: 2px solid white;
            box-shadow: 0 0 15px rgba(95, 23, 235, 0.5);
        }

        .emergency-vehicle {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            left: 400px;
            top: 30%;
            animation: flash 1s infinite;
            border: 2px solid #ff9999;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.7);
        }

        .other-car {
            background: #4b5563;
            left: 250px;
            top: 70%;
            border: 1px solid #6b7280;
        }

        /* Lights */
        .emergency-lights {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(239, 68, 68, 0.3) 0%, transparent 70%);
            animation: flash 0.8s infinite;
            pointer-events: none;
        }

        /* Control Panel */
        .control-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .control-title {
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .control-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 12px 20px;
            border-radius: var(--radius-sm);
            border: 2px solid rgba(95, 23, 235, 0.3);
            background: rgba(95, 23, 235, 0.2);
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 150px;
            justify-content: center;
        }

        .control-btn:hover {
            background: rgba(95, 23, 235, 0.4);
            transform: translateY(-2px);
            border-color: var(--color-primary);
        }

        .control-btn.selected {
            background: rgba(95, 23, 235, 0.6);
            border-color: var(--color-primary);
            animation: glow 2s infinite;
        }

        .control-btn.correct {
            background: rgba(16, 185, 129, 0.4);
            border-color: var(--color-success);
        }

        .control-btn.incorrect {
            background: rgba(239, 68, 68, 0.4);
            border-color: var(--color-error);
        }

        /* Scenario Cards */
        .scenario-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 25px 0;
        }

        @media (max-width: 900px) {
            .scenario-cards { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 600px) {
            .scenario-cards { grid-template-columns: 1fr; }
        }

        .scenario-card {
            background: rgba(95, 23, 235, 0.05);
            border-radius: var(--radius-md);
            padding: 20px;
            border: 2px solid rgba(95, 23, 235, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .scenario-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--color-primary);
        }

        .scenario-card.active {
            border-color: var(--color-primary);
            background: rgba(95, 23, 235, 0.1);
            animation: glow 2s infinite;
        }

        .scenario-card.completed {
            border-color: var(--color-success);
            background: rgba(16, 185, 129, 0.1);
        }

        .scenario-icon {
            font-size: 2rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .scenario-title {
            font-size: 1rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 10px;
            text-align: center;
        }

        .scenario-card.completed .scenario-title {
            color: var(--color-success);
        }

        .scenario-description {
            font-size: 0.85rem;
            color: var(--color-muted);
            text-align: center;
            line-height: 1.5;
        }

        /* Quiz Questions */
        .quiz-section {
            background: rgba(95, 23, 235, 0.05);
            border-radius: var(--radius-md);
            padding: 25px;
            margin: 25px 0;
            border: 2px solid rgba(95, 23, 235, 0.1);
        }

        .quiz-question {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        @media (max-width: 768px) {
            .quiz-options { grid-template-columns: 1fr; }
        }

        .quiz-option {
            padding: 18px;
            border-radius: var(--radius-sm);
            border: 2px solid rgba(95, 23, 235, 0.2);
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .quiz-option:hover {
            border-color: var(--color-primary);
            background: rgba(95, 23, 235, 0.05);
            transform: translateY(-2px);
        }

        .quiz-option.selected {
            border-color: var(--color-primary);
            background: rgba(95, 23, 235, 0.1);
            font-weight: 600;
        }

        .quiz-option.correct {
            border-color: var(--color-success);
            background: rgba(16, 185, 129, 0.1);
        }

        .quiz-option.incorrect {
            border-color: var(--color-error);
            background: rgba(239, 68, 68, 0.1);
        }

        .option-letter {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(95, 23, 235, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
            color: var(--color-primary);
            border: 1px solid rgba(95, 23, 235, 0.2);
        }

        .quiz-option.selected .option-letter {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        /* Feedback */
        .feedback-container {
            background: rgba(95, 23, 235, 0.03);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 1px solid rgba(95, 23, 235, 0.15);
            margin-top: 20px;
            display: none;
            border-left: 4px solid var(--color-primary);
        }

        .feedback-container.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .feedback-title {
            font-size: 0.95rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .feedback-icon {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .feedback-icon.correct { 
            color: var(--color-success); 
        }
        
        .feedback-icon.incorrect { 
            color: var(--color-error); 
        }

        .feedback-content {
            font-size: 0.9rem;
            color: var(--color-text);
            line-height: 1.7;
        }

        .feedback-content strong { 
            color: var(--color-primary); 
            font-weight: 700;
        }

        .statistics-box {
            background: rgba(95, 23, 235, 0.05);
            border-left: 3px solid var(--color-primary);
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border-radius: var(--radius-md);
            border: none;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
            border: 2px solid var(--color-primary);
        }

        .btn-primary:hover:not(:disabled) {
            background: #4c0fcf;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(95, 23, 235, 0.4);
            animation: glow 1.5s infinite;
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: white;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .btn-secondary:hover {
            background: rgba(95, 23, 235, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(95, 23, 235, 0.2);
        }

        .btn-icon { 
            font-size: 1.2em; 
            font-weight: bold;
        }

        /* Results Panel */
        .results-panel {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: white;
            border-radius: var(--radius-md);
            padding: 40px;
            margin-top: 40px;
            display: none;
            animation: fadeInUp 0.6s ease;
            border: 2px solid var(--color-primary);
        }

        .results-panel.show { 
            display: block; 
            animation: glow 2s infinite;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .results-title {
            font-size: 1.6rem;
            font-weight: 800;
            color: white;
        }

        .score-display {
            font-size: 3.5rem;
            font-weight: 900;
            color: var(--color-primary);
            text-align: center;
            margin: 30px 0;
            text-shadow: 0 0 20px rgba(95, 23, 235, 0.7);
            animation: pulse 2s infinite;
        }

        .safety-insights {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 25px;
            margin-top: 25px;
            border-left: 4px solid var(--color-primary);
        }

        .insights-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .insights-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .insights-list li {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            font-size: 0.95rem;
            color: #e5e7eb;
            line-height: 1.6;
        }

        .insight-dot {
            width: 8px;
            height: 8px;
            margin-top: 10px;
            border-radius: 999px;
            background: var(--color-primary);
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }

        /* Completion Message */
        .completion-message {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            border: 2px solid var(--color-success);
            border-radius: var(--radius-md);
            padding: 30px;
            margin: 25px 0;
            display: none;
            animation: fadeIn 0.6s ease;
        }

        .completion-message.show {
            display: block;
        }

        .completion-title {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--color-success);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .completion-description {
            font-size: 1rem;
            color: var(--color-text);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        /* Scenario Progress */
        .scenario-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
        }
        
        .scenario-status {
            font-size: 0.85rem;
            color: #e5e7eb;
        }
        
        .scenario-status span {
            color: var(--color-primary);
            font-weight: 700;
        }

        /* Action Validation */
        .action-validation {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .validation-message {
            color: #e5e7eb;
            font-size: 0.85rem;
            display: none;
        }
        
        .validation-message.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .validation-message.correct {
            color: var(--color-success);
        }
        
        .validation-message.incorrect {
            color: var(--color-error);
        }

        .scenario-instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--color-primary);
        }
        
        .scenario-instructions p {
            color: #e5e7eb;
            font-size: 0.9rem;
            margin: 0;
            line-height: 1.5;
        }
        
        .scenario-instructions strong {
            color: var(--color-primary);
        }
    </style>
</head>
<body>
    <main class="page" aria-labelledby="module-heading">
        <!-- Header -->
        <header class="brand-row">
            <div class="brand">
                <img
                    src="https://lwfiles.mycourse.app/vadrivingclinic-public/9f5c6b8121721c8ef241f929fd983b3e.png"
                    alt="VA Driving Clinic logo"
                    class="brand-logo"
                />
                <div class="course-meta">
                    <span class="course-name">VA Driving Clinic ‚Ä¢ Module 4</span>
                    <div class="week-label">
                        <span class="week-label-dot"></span>
                        <span>Move Over Law in Virginia</span>
                    </div>
                </div>
            </div>
            <span class="badge-mode">Interactive Learning</span>
        </header>

        <h1 id="module-heading">Virginia Move Over Law: Protecting Roadside Workers</h1>
        <p class="module-subtitle">
            Learn Virginia's Move Over Law requirements through interactive highway simulations. This life-saving law protects police, firefighters, EMS, tow operators, and highway workers from roadside dangers. Failure to comply can result in severe penalties.
        </p>

        <!-- Stats Display -->
        <div class="stats-display">
            <div class="stat-card">
                <span class="stat-number" id="knowledge-score">0%</span>
                <span class="stat-label">Knowledge Score</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="scenarios-completed">0/4</span>
                <span class="stat-label">Tasks Completed</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="time-spent">0:00</span>
                <span class="stat-label">Time Learning</span>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-step active" data-step="1">
                <div class="step-circle">1</div>
                <div class="step-label">Law Basics</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-circle">2</div>
                <div class="step-label">Simulation</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-circle">3</div>
                <div class="step-label">Quiz</div>
            </div>
        </div>

        <!-- Main Activity Card -->
        <div class="activity-card" id="main-activity">
            <div class="activity-header">
                <span class="activity-number">Move Over Law Lesson</span>
                <span class="activity-status" id="activity-status">In Progress</span>
            </div>
            <h3 class="activity-title">Virginia's Life-Saving Move Over Law: ¬ß 46.2-921.1</h3>
            <p class="activity-description">
                This interactive lesson covers Virginia's Move Over Law requirements through highway simulations, vehicle identification, and real-world scenarios. Complete all three sections to master this life-saving law.
            </p>

            <!-- Completion Message -->
            <div class="completion-message" id="completion-message">
                <div class="completion-title">
                    <span>üéâ</span>
                    Lesson Completed Successfully!
                </div>
                <div class="completion-description">
                    You've successfully completed all sections of the Move Over Law lesson. Your knowledge score is <strong id="final-score-preview">0%</strong>. Review the comprehensive safety insights below to understand how this law saves lives on Virginia's roads.
                </div>
            </div>

            <!-- Part 1: Law Basics -->
            <div class="quiz-section" id="law-basics">
                <h4 style="color: var(--color-primary); margin-bottom: 25px;">Part 1: Understanding the Law</h4>
                
                <div class="quiz-question">
                    1. Which vehicles are covered by Virginia's Move Over Law? (Select all that apply)
                </div>
                <div class="quiz-options">
                    <div class="quiz-option" data-question="1" data-option="A">
                        <span class="option-letter">A</span>
                        <span>Police vehicles with flashing lights</span>
                    </div>
                    <div class="quiz-option" data-question="1" data-option="B">
                        <span class="option-letter">B</span>
                        <span>Fire trucks and ambulances</span>
                    </div>
                    <div class="quiz-option" data-question="1" data-option="C">
                        <span class="option-letter">C</span>
                        <span>Tow trucks with amber lights</span>
                    </div>
                    <div class="quiz-option" data-question="1" data-option="D">
                        <span class="option-letter">D</span>
                        <span>VDOT maintenance vehicles</span>
                    </div>
                </div>
                
                <div class="quiz-question" style="margin-top: 30px;">
                    2. When does the Move Over Law require you to take action?
                </div>
                <div class="quiz-options">
                    <div class="quiz-option" data-question="2" data-option="A">
                        <span class="option-letter">A</span>
                        <span>Only on your side of the highway</span>
                    </div>
                    <div class="quiz-option" data-question="2" data-option="B">
                        <span class="option-letter">B</span>
                        <span>Both directions on divided highways</span>
                    </div>
                    <div class="quiz-option" data-question="2" data-option="C">
                        <span class="option-letter">C</span>
                        <span>Only during nighttime</span>
                    </div>
                    <div class="quiz-option" data-question="2" data-option="D">
                        <span class="option-letter">D</span>
                        <span>Only for law enforcement vehicles</span>
                    </div>
                </div>
                
                <div class="feedback-container" id="part1-feedback" style="display: none; margin-top: 20px;">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">‚úì</span>
                        Law Basics Complete
                    </div>
                    <div class="feedback-content">
                        <strong>Correct Answers:</strong><br><br>
                        1. <strong>A, B, C, D</strong> - All these vehicles are covered when displaying flashing lights.<br><br>
                        2. <strong>B - Both directions on divided highways</strong> - The law applies whenever you can see emergency lights, regardless of which side of the road they're on.<br><br>
                        
                        <div class="statistics-box">
                            <strong>Virginia Code ¬ß 46.2-921.1:</strong><br>
                            ‚Ä¢ Applies to stationary vehicles with flashing lights<br>
                            ‚Ä¢ Requires moving over OR slowing down<br>
                            ‚Ä¢ Protects emergency responders and roadside workers<br>
                            ‚Ä¢ Violations carry fines up to $250 for first offense
                        </div>
                    </div>
                </div>
            </div>

            <!-- Part 2: Highway Simulation -->
            <div class="highway-simulation" id="highway-sim" style="display: none;">
                <h4 class="simulation-title">Part 2: Highway Decision Simulation</h4>
                <p style="color: #e5e7eb; margin-bottom: 20px;">Test your knowledge by selecting the correct action for each scenario. Complete all three scenarios to proceed.</p>
                
                <div class="scenario-instructions">
                    <p><strong>How it works:</strong> Select a scenario below, then choose the correct action. The scenario will change color when completed correctly.</p>
                </div>
                
                <div class="highway-container">
                    <!-- Road -->
                    <div class="road">
                        <div class="lane lane-1"></div>
                        <div class="lane lane-2"></div>
                        <div class="lane lane-3"></div>
                    </div>
                    
                    <!-- Vehicles -->
                    <div class="vehicle your-car" id="your-car">YOU</div>
                    <div class="vehicle emergency-vehicle" id="emergency-vehicle">
                        <div style="font-size: 0.7rem; text-align: center;">POLICE<br>üö®</div>
                        <div class="emergency-lights"></div>
                    </div>
                </div>
                
                <div class="control-panel">
                    <div class="control-title">Select the correct action for the <span id="active-scenario-name">selected scenario</span>:</div>
                    
                    <div class="action-validation">
                        <div class="validation-message" id="action-feedback"></div>
                    </div>
                    
                    <div class="control-buttons">
                        <div class="control-btn" data-action="move-over">
                            <span>üîÑ</span>
                            <span>Move Over to Left Lane</span>
                        </div>
                        <div class="control-btn" data-action="slow-down">
                            <span>üê¢</span>
                            <span>Slow Down in Current Lane</span>
                        </div>
                        <div class="control-btn" data-action="continue">
                            <span>‚ö°</span>
                            <span>Continue Same Speed</span>
                        </div>
                        <div class="control-btn" data-action="stop">
                            <span>üõë</span>
                            <span>Stop Completely</span>
                        </div>
                    </div>
                </div>
                
                <div class="scenario-progress">
                    <div class="scenario-status">
                        Completed: <span id="completed-scenarios">0</span>/3 scenarios
                    </div>
                    <div class="scenario-status">
                        Current: <span id="current-scenario-display">Select a scenario</span>
                    </div>
                </div>
                
                <div class="scenario-cards" style="margin-top: 15px;">
                    <div class="scenario-card" data-scenario="clear" data-correct="move-over">
                        <div class="scenario-icon">‚òÄÔ∏è</div>
                        <div class="scenario-title">Clear Road</div>
                        <div class="scenario-description">Left lane is completely clear - no traffic</div>
                        <div class="scenario-status-indicator" style="font-size: 0.7rem; margin-top: 5px; color: #999; display: none;">
                            ‚úì Completed
                        </div>
                    </div>
                    <div class="scenario-card" data-scenario="busy" data-correct="slow-down">
                        <div class="scenario-icon">üöó</div>
                        <div class="scenario-title">Busy Traffic</div>
                        <div class="scenario-description">Left lane has heavy traffic flow</div>
                        <div class="scenario-status-indicator" style="font-size: 0.7rem; margin-top: 5px; color: #999; display: none;">
                            ‚úì Completed
                        </div>
                    </div>
                    <div class="scenario-card" data-scenario="construction" data-correct="slow-down">
                        <div class="scenario-icon">üöß</div>
                        <div class="scenario-title">Construction Zone</div>
                        <div class="scenario-description">Left lane closed ahead</div>
                        <div class="scenario-status-indicator" style="font-size: 0.7rem; margin-top: 5px; color: #999; display: none;">
                            ‚úì Completed
                        </div>
                    </div>
                </div>
                
                <div class="feedback-container" id="simulation-feedback" style="display: none; margin-top: 20px;">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">‚úì</span>
                        Simulation Complete
                    </div>
                    <div class="feedback-content">
                        <strong>All Scenarios Completed!</strong><br><br>
                        
                        ‚Ä¢ <strong>Clear Road:</strong> <span style="color: var(--color-success);">MOVE OVER REQUIRED</span> - When safe, you must change lanes<br>
                        ‚Ä¢ <strong>Busy Traffic:</strong> <span style="color: var(--color-success);">SLOW DOWN REQUIRED</span> - Reduce speed significantly when can't move over<br>
                        ‚Ä¢ <strong>Construction Zone:</strong> <span style="color: var(--color-success);">SLOW DOWN REQUIRED</span> - Cannot move over safely<br><br>
                        
                        <div class="statistics-box">
                            <strong>Key Takeaways:</strong><br>
                            ‚Ä¢ Always move over if it's safe to do so<br>
                            ‚Ä¢ If you can't move over, slow down to at least 20 mph below posted limit<br>
                            ‚Ä¢ Be prepared to stop if necessary<br>
                            ‚Ä¢ Signal your intention before changing lanes
                        </div>
                    </div>
                </div>
            </div>

            <!-- Part 3: Quiz Assessment -->
            <div class="quiz-section" id="quiz-part" style="display: none;">
                <h4 style="color: var(--color-primary); margin-bottom: 25px;">Part 3: Final Assessment</h4>
                
                <div class="quiz-question">
                    1. You're on a 4-lane highway (2 lanes each direction). A police car is stopped on the opposite shoulder with lights flashing. What should you do?
                </div>
                <div class="quiz-options">
                    <div class="quiz-option" data-question="3" data-option="A">
                        <span class="option-letter">A</span>
                        <span>Nothing - law only applies to your side of highway</span>
                    </div>
                    <div class="quiz-option" data-question="3" data-option="B">
                        <span class="option-letter">B</span>
                        <span>Move over if safe, otherwise slow down</span>
                    </div>
                    <div class="quiz-option" data-question="3" data-option="C">
                        <span class="option-letter">C</span>
                        <span>Flash your lights to warn others</span>
                    </div>
                    <div class="quiz-option" data-question="3" data-option="D">
                        <span class="option-letter">D</span>
                        <span>Speed up to clear the area quickly</span>
                    </div>
                </div>
                
                <div class="quiz-question" style="margin-top: 30px;">
                    2. A VDOT truck is mowing grass on the shoulder with flashing amber lights. You're in heavy traffic and cannot change lanes. You should:
                </div>
                <div class="quiz-options">
                    <div class="quiz-option" data-question="4" data-option="A">
                        <span class="option-letter">A</span>
                        <span>Continue at posted speed since it's just maintenance</span>
                    </div>
                    <div class="quiz-option" data-question="4" data-option="B">
                        <span class="option-letter">B</span>
                        <span>Slow down significantly and be prepared to stop</span>
                    </div>
                    <div class="quiz-option" data-question="4" data-option="C">
                        <span class="option-letter">C</span>
                        <span>Honk to alert the worker</span>
                    </div>
                    <div class="quiz-option" data-question="4" data-option="D">
                        <span class="option-letter">D</span>
                        <span>Drive on the shoulder to pass quickly</span>
                    </div>
                </div>
                
                <div class="quiz-question" style="margin-top: 30px;">
                    3. What is the penalty for a first-time Move Over Law violation in Virginia?
                </div>
                <div class="quiz-options">
                    <div class="quiz-option" data-question="5" data-option="A">
                        <span class="option-letter">A</span>
                        <span>Warning only</span>
                    </div>
                    <div class="quiz-option" data-question="5" data-option="B">
                        <span class="option-letter">B</span>
                        <span>Up to $250 fine</span>
                    </div>
                    <div class="quiz-option" data-question="5" data-option="C">
                        <span class="option-letter">C</span>
                        <span>30-day license suspension</span>
                    </div>
                    <div class="quiz-option" data-question="5" data-option="D">
                        <span class="option-letter">D</span>
                        <span>Community service</span>
                    </div>
                </div>
                
                <div class="feedback-container" id="quiz-feedback" style="display: none; margin-top: 20px;">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">‚úì</span>
                        Assessment Complete
                    </div>
                    <div class="feedback-content">
                        <strong>Correct Answers:</strong><br><br>
                        1. <strong>B - Move over if safe, otherwise slow down</strong> - Virginia law applies to both directions on divided highways when emergency lights are visible.<br><br>
                        2. <strong>B - Slow down significantly</strong> - VDOT vehicles with flashing amber lights are covered. When you cannot move over, reduce speed to safe level.<br><br>
                        3. <strong>B - Up to $250 fine</strong> - First offense carries a fine up to $250 and mandatory court appearance.<br><br>
                        
                        <div class="statistics-box">
                            <strong>Complete the Lesson:</strong><br>
                            You've successfully answered all questions. Click "Complete Assessment" to see your final score and comprehensive safety insights.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-secondary" id="reset-btn">
                <span class="btn-icon">‚Üª</span>
                Reset Lesson
            </button>
            <button class="btn btn-secondary" id="check-part-btn">
                <span class="btn-icon">‚úì</span>
                Check Current Section
            </button>
            <button class="btn btn-secondary" id="next-part-btn">
                <span class="btn-icon">‚Üí</span>
                Next Section
            </button>
            <button class="btn btn-primary" id="complete-btn" disabled>
                <span class="btn-icon">üìä</span>
                Complete Assessment
            </button>
        </div>

        <!-- Results Panel -->
        <div class="results-panel" id="results-panel">
            <div class="results-header">
                <h2 class="results-title">Move Over Law Proficiency</h2>
                <div class="score-display" id="final-score">0%</div>
            </div>
            
            <div class="safety-insights">
                <h3 class="insights-title">
                    <span>üö®</span> Why This Law Saves Lives
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>The "Kill Zone":</strong> Emergency responders work in a 10-foot "kill zone" next to traffic. At 60 mph, a car covers 88 feet per second. Moving over gives them crucial reaction time if a vehicle drifts onto the shoulder.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Secondary Crashes:</strong> 20% of highway fatalities are "secondary crashes" - accidents that occur because drivers don't move over for initial incidents. Your compliance prevents chain-reaction tragedies.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Worker Perspective:</strong> Tow operators describe feeling their trucks shake as vehicles whiz by inches away. Highway workers have 3 seconds to react to an errant vehicle. Your lane change gives them 10+ seconds.</span>
                    </li>
                </ul>
            </div>
            
            <div class="safety-insights" style="margin-top: 20px;">
                <h3 class="insights-title">
                    <span>üõ°Ô∏è</span> Advanced Safety Practices
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Early Detection:</strong> Scan 12-15 seconds ahead. Flashing lights are often visible before you see the vehicle. Begin planning your lane change or speed reduction immediately.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Communicate Intentions:</strong> Signal early (100+ feet before changing lanes). Check mirrors and blind spots. Make smooth lane changes - sudden moves can surprise other drivers.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Multi-Vehicle Incidents:</strong> When multiple emergency vehicles are present, move over for the farthest one. Maintain reduced speed until completely past all emergency personnel.</span>
                    </li>
                </ul>
            </div>
            
            <div class="action-buttons" style="margin-top: 30px; justify-content: center;">
                <button class="btn btn-primary" id="restart-lesson-btn">
                    <span class="btn-icon">üîÑ</span>
                    Restart Lesson
                </button>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // State Management
            const state = {
                currentPart: 1,
                totalParts: 3,
                partsCompleted: 0,
                sectionsCompleted: 0,
                totalSections: 4, // 3 parts + final assessment
                correctAnswers: 0,
                totalQuestions: 0,
                startedAt: new Date(),
                quizAnswers: {
                    1: [], // Multi-select for part 1
                    2: '', // Single answer for part 1
                    3: '', // Part 3 Q1
                    4: '', // Part 3 Q2
                    5: ''  // Part 3 Q3
                },
                simulationAnswers: {
                    clear: null,
                    busy: null,
                    construction: null
                }
            };

            // Correct answers
            const correctData = {
                quiz: {
                    1: ['A', 'B', 'C', 'D'], // All options are correct
                    2: 'B', // Both directions
                    3: 'B', // Move over if safe
                    4: 'B', // Slow down significantly
                    5: 'B'  // Up to $250 fine
                },
                simulation: {
                    clear: 'move-over',
                    busy: 'slow-down',
                    construction: 'slow-down'
                }
            };

            // DOM Elements
            const activityParts = document.querySelectorAll('#law-basics, #highway-sim, #quiz-part');
            const nextBtn = document.getElementById('next-part-btn');
            const resetBtn = document.getElementById('reset-btn');
            const checkBtn = document.getElementById('check-part-btn');
            const completeBtn = document.getElementById('complete-btn');
            const resultsPanel = document.getElementById('results-panel');
            const completionMessage = document.getElementById('completion-message');
            const finalScoreEl = document.getElementById('final-score');
            const finalScorePreview = document.getElementById('final-score-preview');
            const knowledgeScoreEl = document.getElementById('knowledge-score');
            const scenariosCompletedEl = document.getElementById('scenarios-completed');
            const timeSpentEl = document.getElementById('time-spent');
            const activityStatus = document.getElementById('activity-status');
            const progressSteps = document.querySelectorAll('.progress-step');
            const restartLessonBtn = document.getElementById('restart-lesson-btn');

            // Timer for time spent
            function updateTimer() {
                const now = new Date();
                const diff = Math.floor((now - state.startedAt) / 1000);
                const minutes = Math.floor(diff / 60);
                const seconds = diff % 60;
                timeSpentEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // Update progress stats
                scenariosCompletedEl.textContent = `${state.sectionsCompleted}/${state.totalSections}`;
            }

            setInterval(updateTimer, 1000);

            // Update progress steps
            function updateProgress() {
                progressSteps.forEach((step, index) => {
                    const stepNum = index + 1;
                    
                    if (stepNum === state.currentPart) {
                        step.classList.add('active');
                        step.classList.remove('completed');
                    } else if (stepNum < state.currentPart) {
                        step.classList.add('completed');
                        step.classList.remove('active');
                    } else {
                        step.classList.remove('active', 'completed');
                    }
                });
            }

            // Calculate score
            function calculateScore() {
                if (state.totalQuestions === 0) return 0;
                return Math.round((state.correctAnswers / state.totalQuestions) * 100);
            }

            // Update stats display
            function updateStats() {
                const score = calculateScore();
                knowledgeScoreEl.textContent = `${score}%`;
                scenariosCompletedEl.textContent = `${state.sectionsCompleted}/${state.totalSections}`;
                
                // Update completion message preview
                finalScorePreview.textContent = `${score}%`;
            }

            // Show feedback for current part
            function showPartFeedback(partNumber, isCorrect) {
                const feedbackId = partNumber === 1 ? 'part1-feedback' : 
                                 partNumber === 2 ? 'simulation-feedback' : 'quiz-feedback';
                const feedback = document.getElementById(feedbackId);
                
                if (feedback) {
                    const icon = feedback.querySelector('.feedback-icon');
                    const title = feedback.querySelector('.feedback-title');
                    
                    if (isCorrect) {
                        icon.textContent = '‚úì';
                        icon.className = 'feedback-icon correct';
                    } else {
                        icon.textContent = '‚úó';
                        icon.className = 'feedback-icon incorrect';
                        title.style.color = 'var(--color-error)';
                    }
                    
                    feedback.classList.add('show');
                    
                    // Mark part as completed
                    state.sectionsCompleted++;
                    updateStats();
                    
                    // Enable next button if this part is complete
                    if (partNumber < state.totalParts) {
                        nextBtn.disabled = false;
                    } else {
                        // If last part, enable complete button
                        completeBtn.disabled = false;
                        completionMessage.classList.add('show');
                        activityStatus.textContent = 'Ready to Complete';
                        activityStatus.style.color = 'var(--color-warning)';
                    }
                }
            }

            // Check part 1 answers
            function checkPart1() {
                let correctCount = 0;
                let totalQuestions = 0;
                
                // Check question 1 (multiple select)
                const q1Options = document.querySelectorAll('[data-question="1"]');
                const selectedQ1 = Array.from(q1Options).filter(opt => opt.classList.contains('selected'));
                
                // Question 1: All options should be selected
                const allSelected = selectedQ1.length === 4;
                if (allSelected) {
                    correctCount++;
                    q1Options.forEach(opt => opt.classList.add('correct'));
                } else {
                    // Mark correct ones
                    q1Options.forEach(opt => {
                        if (correctData.quiz[1].includes(opt.dataset.option)) {
                            opt.classList.add('correct');
                        }
                        if (opt.classList.contains('selected') && !correctData.quiz[1].includes(opt.dataset.option)) {
                            opt.classList.add('incorrect');
                        }
                    });
                }
                totalQuestions++;
                
                // Check question 2 (single select)
                const q2Selected = document.querySelector('[data-question="2"].selected');
                const isQ2Correct = q2Selected && q2Selected.dataset.option === correctData.quiz[2];
                
                if (isQ2Correct) {
                    correctCount++;
                    q2Selected.classList.add('correct');
                } else {
                    // Mark correct answer
                    const correctQ2 = document.querySelector(`[data-question="2"][data-option="${correctData.quiz[2]}"]`);
                    if (correctQ2) correctQ2.classList.add('correct');
                    if (q2Selected) q2Selected.classList.add('incorrect');
                }
                totalQuestions++;
                
                // Update state
                state.correctAnswers += correctCount;
                state.totalQuestions += totalQuestions;
                
                // Show feedback
                showPartFeedback(1, correctCount === totalQuestions);
                
                return correctCount === totalQuestions;
            }

            // Initialize part 2
            function initPart2() {
                const scenarioCards = document.querySelectorAll('.scenario-card');
                const controlBtns = document.querySelectorAll('.control-btn');
                const activeScenarioName = document.getElementById('active-scenario-name');
                const actionFeedback = document.getElementById('action-feedback');
                const completedScenariosEl = document.getElementById('completed-scenarios');
                const currentScenarioDisplay = document.getElementById('current-scenario-display');
                
                let activeScenario = null;
                let completedScenarios = 0;
                const scenarioAnswers = {
                    clear: null,
                    busy: null,
                    construction: null
                };
                
                // Scenario selection
                scenarioCards.forEach(card => {
                    card.addEventListener('click', function() {
                        // Don't allow selection of completed scenarios
                        if (this.classList.contains('completed')) {
                            return;
                        }
                        
                        // Remove active class from all cards
                        scenarioCards.forEach(c => c.classList.remove('active'));
                        
                        // Add active class to selected card
                        this.classList.add('active');
                        activeScenario = this.dataset.scenario;
                        
                        // Update display
                        const scenarioTitle = this.querySelector('.scenario-title').textContent;
                        activeScenarioName.textContent = scenarioTitle.toLowerCase();
                        currentScenarioDisplay.textContent = scenarioTitle;
                        
                        // Reset action buttons
                        controlBtns.forEach(btn => {
                            btn.classList.remove('selected', 'correct', 'incorrect');
                        });
                        
                        // Clear feedback
                        actionFeedback.classList.remove('show', 'correct', 'incorrect');
                        actionFeedback.textContent = '';
                        
                        // Show instructions
                        const description = this.querySelector('.scenario-description').textContent;
                        actionFeedback.textContent = `Scenario: ${description}`;
                        actionFeedback.classList.add('show');
                        
                        // Animate car to starting position
                        resetCarPosition();
                    });
                });
                
                // Action selection
                controlBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        if (!activeScenario) {
                            actionFeedback.textContent = 'Please select a scenario first';
                            actionFeedback.classList.add('show', 'incorrect');
                            return;
                        }
                        
                        const action = this.dataset.action;
                        const currentCard = document.querySelector(`.scenario-card[data-scenario="${activeScenario}"]`);
                        const correctAction = currentCard.dataset.correct;
                        
                        // Remove selection from all buttons
                        controlBtns.forEach(b => b.classList.remove('selected'));
                        
                        // Select this button
                        this.classList.add('selected');
                        
                        // Check if correct
                        const isCorrect = action === correctAction;
                        
                        // Update visual feedback
                        if (isCorrect) {
                            this.classList.add('correct');
                            actionFeedback.textContent = `‚úì Correct! ${getActionExplanation(activeScenario, action)}`;
                            actionFeedback.classList.add('show', 'correct');
                            
                            // Mark scenario as completed
                            currentCard.classList.add('completed');
                            currentCard.style.borderColor = 'var(--color-success)';
                            currentCard.style.background = 'rgba(16, 185, 129, 0.1)';
                            
                            // Show completion indicator
                            const statusIndicator = currentCard.querySelector('.scenario-status-indicator');
                            statusIndicator.style.display = 'block';
                            statusIndicator.style.color = 'var(--color-success)';
                            
                            // Update completed count
                            completedScenarios++;
                            completedScenariosEl.textContent = completedScenarios;
                            
                            // Store answer
                            scenarioAnswers[activeScenario] = action;
                            
                            // Animate car based on action
                            animateCarAction(action);
                            
                            // Check if all scenarios completed
                            if (completedScenarios === 3) {
                                setTimeout(() => {
                                    completePart2();
                                }, 1000);
                            } else {
                                // Auto-select next incomplete scenario
                                const nextScenario = getNextIncompleteScenario();
                                if (nextScenario) {
                                    const nextCard = document.querySelector(`.scenario-card[data-scenario="${nextScenario}"]`);
                                    nextCard.click();
                                }
                            }
                        } else {
                            this.classList.add('incorrect');
                            actionFeedback.textContent = `‚úó Incorrect. The correct action is: ${getCorrectActionDescription(activeScenario)}`;
                            actionFeedback.classList.add('show', 'incorrect');
                            
                            // Shake animation for wrong answer
                            this.style.animation = 'shake 0.5s ease';
                            setTimeout(() => {
                                this.style.animation = '';
                            }, 500);
                        }
                    });
                });
                
                function getNextIncompleteScenario() {
                    for (const scenario in scenarioAnswers) {
                        if (scenarioAnswers[scenario] === null) {
                            return scenario;
                        }
                    }
                    return null;
                }
                
                function getActionExplanation(scenario, action) {
                    const explanations = {
                        'clear': {
                            'move-over': 'When the left lane is clear, you MUST move over to give emergency vehicles space.',
                            'slow-down': 'Slowing down is required when you cannot move over safely.',
                            'continue': 'Continuing at the same speed violates the Move Over Law.',
                            'stop': 'Stopping completely is not required unless traffic conditions demand it.'
                        },
                        'busy': {
                            'move-over': 'Moving over is ideal but not possible with heavy traffic.',
                            'slow-down': 'Correct! When you cannot move over, you MUST slow down significantly.',
                            'continue': 'Continuing at the same speed violates the Move Over Law.',
                            'stop': 'Stopping completely could cause a traffic hazard.'
                        },
                        'construction': {
                            'move-over': 'Cannot move over when the left lane is closed.',
                            'slow-down': 'Correct! When lanes are closed, slow down and proceed with caution.',
                            'continue': 'Continuing at speed through a construction zone is dangerous.',
                            'stop': 'Only stop if directed by workers or signs.'
                        }
                    };
                    return explanations[scenario][action] || '';
                }
                
                function getCorrectActionDescription(scenario) {
                    const descriptions = {
                        'clear': 'MOVE OVER (when left lane is clear)',
                        'busy': 'SLOW DOWN (when traffic prevents lane change)',
                        'construction': 'SLOW DOWN (when lanes are closed)'
                    };
                    return descriptions[scenario] || '';
                }
                
                function resetCarPosition() {
                    const yourCar = document.getElementById('your-car');
                    yourCar.style.left = '100px';
                    yourCar.style.top = '50%';
                    yourCar.style.transform = 'translateY(-50%)';
                    yourCar.style.transition = 'all 0.5s ease';
                }
                
                function animateCarAction(action) {
                    const yourCar = document.getElementById('your-car');
                    
                    setTimeout(() => {
                        switch(action) {
                            case 'move-over':
                                yourCar.style.left = '50px';
                                yourCar.style.top = '30%';
                                yourCar.style.transform = 'translateY(-50%)';
                                break;
                            case 'slow-down':
                                // Simulate slowing by moving slower
                                yourCar.style.transition = 'left 2s ease';
                                yourCar.style.left = '300px';
                                break;
                            case 'continue':
                                yourCar.style.transition = 'left 0.5s ease';
                                yourCar.style.left = '300px';
                                break;
                            case 'stop':
                                yourCar.style.left = '150px';
                                break;
                        }
                    }, 100);
                }
                
                function completePart2() {
                    // Update state
                    state.correctAnswers += 3; // All 3 scenarios correct if completed
                    state.totalQuestions += 3;
                    state.sectionsCompleted++;
                    
                    // Show feedback
                    const feedback = document.getElementById('simulation-feedback');
                    feedback.classList.add('show');
                    
                    // Enable next button
                    nextBtn.disabled = false;
                    checkBtn.disabled = true;
                    
                    // Update stats
                    updateStats();
                }
                
                // Initialize first scenario
                setTimeout(() => {
                    scenarioCards[0].click();
                }, 500);
            }

            // Check part 3 (quiz)
            function checkPart3() {
                let correctCount = 0;
                const questions = [3, 4, 5];
                
                questions.forEach(questionNum => {
                    const selected = document.querySelector(`[data-question="${questionNum}"].selected`);
                    
                    if (selected) {
                        const isCorrect = selected.dataset.option === correctData.quiz[questionNum];
                        
                        if (isCorrect) {
                            correctCount++;
                            selected.classList.add('correct');
                        } else {
                            selected.classList.add('incorrect');
                            const correctOption = document.querySelector(`[data-question="${questionNum}"][data-option="${correctData.quiz[questionNum]}"]`);
                            if (correctOption) correctOption.classList.add('correct');
                        }
                    }
                });
                
                // Check if all questions answered
                if (questions.every(q => document.querySelector(`[data-question="${q}"].selected`))) {
                    state.totalQuestions += 3;
                    state.correctAnswers += correctCount;
                    
                    // Show feedback
                    showPartFeedback(3, correctCount === 3);
                    
                    return correctCount === 3;
                } else {
                    alert('Please answer all questions before checking.');
                    return false;
                }
            }

            // Initialize part 1
            function initPart1() {
                const quizOptions = document.querySelectorAll('#law-basics .quiz-option');
                
                quizOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const question = this.dataset.question;
                        
                        // Question 1 is multi-select
                        if (question === '1') {
                            this.classList.toggle('selected');
                        } else {
                            // Single select for other questions
                            const allOptions = document.querySelectorAll(`[data-question="${question}"]`);
                            allOptions.forEach(opt => opt.classList.remove('selected'));
                            this.classList.add('selected');
                        }
                    });
                });
            }

            // Initialize part 3
            function initPart3() {
                const quizOptions = document.querySelectorAll('#quiz-part .quiz-option');
                
                quizOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const question = this.dataset.question;
                        
                        // Single select for all part 3 questions
                        const allOptions = document.querySelectorAll(`[data-question="${question}"]`);
                        allOptions.forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                    });
                });
            }

            // Navigate to next part
            nextBtn.addEventListener('click', function() {
                if (state.currentPart < state.totalParts) {
                    // Hide current part
                    activityParts.forEach((part, index) => {
                        part.style.display = index === state.currentPart ? 'block' : 'none';
                    });
                    
                    // Show next part
                    state.currentPart++;
                    
                    // Update progress
                    updateProgress();
                    
                    // Initialize next part
                    if (state.currentPart === 2) {
                        initPart2();
                    } else if (state.currentPart === 3) {
                        initPart3();
                    }
                    
                    // Update button text
                    this.textContent = state.currentPart === state.totalParts ? 
                        'Check Final Section' : 'Next Section';
                    this.disabled = true;
                    checkBtn.disabled = false;
                }
            });

            // Check current part
            checkBtn.addEventListener('click', function() {
                let isComplete = false;
                
                switch(state.currentPart) {
                    case 1:
                        isComplete = checkPart1();
                        break;
                    case 2:
                        // Part 2 is completed automatically when all scenarios are done
                        isComplete = state.simulationAnswers.clear !== null && 
                                    state.simulationAnswers.busy !== null && 
                                    state.simulationAnswers.construction !== null;
                        if (!isComplete) {
                            alert('Please complete all 3 scenarios first.');
                        }
                        break;
                    case 3:
                        isComplete = checkPart3();
                        break;
                }
                
                if (isComplete && state.currentPart !== 2) {
                    this.disabled = true;
                    this.style.opacity = '0.5';
                    this.style.cursor = 'not-allowed';
                }
            });

            // Complete assessment
            completeBtn.addEventListener('click', function() {
                // Calculate final score
                const finalScore = calculateScore();
                finalScoreEl.textContent = `${finalScore}%`;
                
                // Show results panel
                resultsPanel.classList.add('show');
                resultsPanel.scrollIntoView({ behavior: 'smooth' });
                
                // Update activity status
                activityStatus.textContent = 'Completed';
                activityStatus.style.color = 'var(--color-success)';
                document.getElementById('main-activity').classList.add('completed');
                
                // Disable all buttons except restart
                nextBtn.disabled = true;
                checkBtn.disabled = true;
                completeBtn.disabled = true;
                this.style.opacity = '0.5';
                this.style.cursor = 'not-allowed';
            });

            // Restart lesson
            restartLessonBtn.addEventListener('click', function() {
                location.reload();
            });

            // Reset lesson
            resetBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to reset the lesson? All progress will be lost.')) {
                    location.reload();
                }
            });

            // Initialize
            initPart1();
            updateTimer();
            updateProgress();
            updateStats();
            
            // Initially disable next button until part 1 is checked
            nextBtn.disabled = true;
            checkBtn.disabled = false;
            completeBtn.disabled = true;
        });
    </script>
</body>
</html>
