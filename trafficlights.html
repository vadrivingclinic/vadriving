<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VA Driving Clinic - Module 1: Traffic Control & Road Safety</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --color-primary: #5f17eb; /* Your exact brand purple */
            --color-primary-soft: #8a5feb;
            --color-secondary: #000000; /* Black */
            --color-accent: #7c3aed;
            --color-success: #10b981;
            --color-error: #ef4444;
            --color-warning: #f59e0b;
            --color-bg: #ffffff; /* White */
            --color-text: #000000; /* Black */
            --color-muted: #6b7280;
            --color-dark: #000000; /* Black */
            --color-light: #f9fafb;
            --radius-lg: 20px;
            --radius-md: 12px;
            --radius-sm: 8px;
            --shadow-soft: 0 10px 30px rgba(95, 23, 235, 0.1);
            --shadow-hover: 0 15px 35px rgba(95, 23, 235, 0.15);
            --shadow-card: 0 8px 25px rgba(0, 0, 0, 0.08);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 24px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            color: var(--color-text);
            line-height: 1.6;
        }

        @media (max-width: 600px) {
            body { padding: 12px; }
        }

        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(95, 23, 235, 0.5); }
            50% { box-shadow: 0 0 20px rgba(95, 23, 235, 0.8); }
        }

        /* Main Container */
        .page {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: var(--color-bg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 30px;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.8s ease-out;
            border: 1px solid rgba(95, 23, 235, 0.1);
        }

        @media (max-width: 900px) {
            .page { padding: 20px; }
        }

        @media (max-width: 480px) {
            body { padding: 0; }
            .page {
                border-radius: 0;
                box-shadow: none;
                padding: 16px 12px 20px;
            }
        }

        /* Header */
        .brand-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            width: 100%;
            animation: fadeIn 0.6s ease-out 0.2s both;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .brand-logo {
            height: 50px;
            width: auto;
            max-width: 100%;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .brand-logo:hover { 
            transform: scale(1.05); 
            animation: glow 2s infinite;
        }

        .course-meta {
            display: flex;
            flex-direction: column;
            gap: 4px;
            max-width: 100%;
        }

        .course-name {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--color-primary);
            font-weight: 700;
        }

        .week-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 999px;
            background: rgba(95, 23, 235, 0.1);
            font-size: 0.8rem;
            color: var(--color-primary);
            font-weight: 600;
            border: 1px solid rgba(95, 23, 235, 0.2);
        }

        .week-label-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--color-primary);
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }

        .badge-mode {
            padding: 6px 12px;
            border-radius: 999px;
            background: rgba(95, 23, 235, 0.08);
            border: 1px solid rgba(95, 23, 235, 0.15);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--color-primary);
            white-space: nowrap;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .badge-mode:hover {
            background: rgba(95, 23, 235, 0.15);
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        h1 {
            font-size: clamp(1.8rem, 3vw, 2.4rem);
            line-height: 1.1;
            color: var(--color-text);
            margin-bottom: 10px;
            animation: fadeInUp 0.6s ease-out 0.3s both;
        }

        .module-subtitle {
            font-size: 1rem;
            color: var(--color-muted);
            max-width: 800px;
            margin-bottom: 28px;
            animation: fadeInUp 0.6s ease-out 0.4s both;
            line-height: 1.7;
        }

        /* Time Estimate Banner */
        .time-estimate-banner {
            background: linear-gradient(135deg, rgba(95, 23, 235, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%);
            border: 2px solid rgba(95, 23, 235, 0.2);
            border-radius: var(--radius-md);
            padding: 15px 20px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: fadeIn 0.5s ease;
        }

        .time-estimate-icon {
            font-size: 1.5rem;
            color: var(--color-primary);
            background: rgba(95, 23, 235, 0.1);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .time-estimate-content h3 {
            color: var(--color-primary);
            font-size: 1rem;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .time-estimate-content p {
            color: var(--color-text);
            font-size: 0.9rem;
            margin: 0;
        }

        .time-highlight {
            color: var(--color-primary);
            font-weight: 800;
            font-size: 1.1em;
        }

        /* Progress Tracker */
        .progress-tracker {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
            padding: 0 20px;
        }

        .progress-tracker::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 50px;
            right: 50px;
            height: 3px;
            background: rgba(95, 23, 235, 0.1);
            z-index: 1;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 2px solid rgba(95, 23, 235, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-circle {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
            transform: scale(1.1);
            animation: pulse 2s infinite;
        }

        .progress-step.completed .step-circle {
            background: var(--color-success);
            border-color: var(--color-success);
            color: white;
        }

        .step-label {
            font-size: 0.75rem;
            color: var(--color-muted);
            text-align: center;
            font-weight: 600;
        }

        .progress-step.active .step-label {
            color: var(--color-primary);
            font-weight: 700;
        }

        /* Stats Display */
        .stats-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 600px) {
            .stats-display { grid-template-columns: 1fr; }
        }

        .stat-card {
            background: rgba(95, 23, 235, 0.05);
            border-radius: var(--radius-md);
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(95, 23, 235, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--color-primary);
            box-shadow: 0 10px 25px rgba(95, 23, 235, 0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--color-primary);
            display: block;
            line-height: 1;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--color-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
        }

        /* Activity Grid */
        .activity-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .activity-grid { grid-template-columns: 1fr; }
        }

        .activity-card {
            background: var(--color-bg);
            border-radius: var(--radius-md);
            border: 1px solid rgba(95, 23, 235, 0.15);
            padding: 24px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .activity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--color-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: var(--color-primary);
        }

        .activity-card:hover::before { 
            opacity: 1;
            animation: glow 2s infinite;
        }

        .activity-card.completed {
            border-color: var(--color-success);
        }

        .activity-card.completed::before {
            background: var(--color-success);
            opacity: 1;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .activity-number {
            font-size: 0.85rem;
            font-weight: 800;
            color: var(--color-primary);
            background: rgba(95, 23, 235, 0.1);
            padding: 4px 12px;
            border-radius: 20px;
            border: 1px solid rgba(95, 23, 235, 0.2);
        }

        .activity-status {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 12px;
            background: rgba(95, 23, 235, 0.08);
            color: var(--color-primary);
            font-weight: 600;
            border: 1px solid rgba(95, 23, 235, 0.15);
        }

        .activity-card.completed .activity-status {
            background: rgba(16, 185, 129, 0.1);
            color: var(--color-success);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .activity-title {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--color-text);
            margin-bottom: 12px;
        }

        .activity-description {
            font-size: 0.95rem;
            color: var(--color-muted);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* Activity Time Estimate */
        .activity-time-estimate {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            padding: 8px 12px;
            background: rgba(95, 23, 235, 0.05);
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--color-primary);
        }

        .activity-time-icon {
            color: var(--color-primary);
            font-weight: bold;
        }

        .activity-time-text {
            font-size: 0.85rem;
            color: var(--color-text);
            font-weight: 600;
        }

        /* Traffic Light Activity */
        .traffic-light-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .traffic-light {
            width: 120px;
            height: 320px;
            background: #1a1a1a;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            padding: 20px 0;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 3px solid #333;
        }

        .light {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: #2a2a2a;
            position: relative;
            transition: all 0.3s ease;
            border: 3px solid #444;
        }

        .light.red.active { 
            background: #ef4444; 
            box-shadow: 0 0 30px #ef4444, inset 0 0 10px rgba(255, 255, 255, 0.3);
            animation: pulse 1.5s infinite;
        }
        
        .light.yellow.active { 
            background: #f59e0b; 
            box-shadow: 0 0 30px #f59e0b, inset 0 0 10px rgba(255, 255, 255, 0.3);
            animation: pulse 1.5s infinite;
        }
        
        .light.green.active { 
            background: #10b981; 
            box-shadow: 0 0 30px #10b981, inset 0 0 10px rgba(255, 255, 255, 0.3);
            animation: pulse 1.5s infinite;
        }

        .light-label {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--color-text);
            margin-top: 8px;
            text-align: center;
            padding: 8px 16px;
            background: rgba(95, 23, 235, 0.05);
            border-radius: var(--radius-sm);
            border: 1px solid rgba(95, 23, 235, 0.1);
            min-width: 200px;
        }

        .light-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .light-btn {
            padding: 10px 18px;
            border-radius: var(--radius-sm);
            border: 2px solid var(--color-primary);
            background: white;
            color: var(--color-primary);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .light-btn:hover {
            background: var(--color-primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(95, 23, 235, 0.3);
        }

        /* Signal Matching Activity */
        .signal-matching-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 600px) {
            .signal-matching-grid { grid-template-columns: 1fr; }
        }

        .matching-column {
            background: rgba(95, 23, 235, 0.02);
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 2px dashed rgba(95, 23, 235, 0.2);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .matching-column-title {
            font-size: 0.9rem;
            font-weight: 800;
            color: var(--color-primary);
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(95, 23, 235, 0.1);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .signal-item {
            background: rgba(95, 23, 235, 0.08);
            border-radius: var(--radius-sm);
            padding: 12px 15px;
            cursor: grab;
            border: 2px solid rgba(95, 23, 235, 0.15);
            transition: all 0.3s ease;
            user-select: none;
            font-size: 0.85rem;
            color: var(--color-text);
            font-weight: 500;
        }

        .signal-item:hover {
            background: rgba(95, 23, 235, 0.15);
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(95, 23, 235, 0.1);
        }

        .signal-item.dragging {
            opacity: 0.7;
            transform: scale(0.98);
            border-color: var(--color-primary);
        }

        .signal-item.matched {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--color-success);
            cursor: default;
        }

        .signal-item.incorrect {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--color-error);
            animation: shake 0.5s ease;
        }

        /* Match Area */
        .match-area {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .match-pair {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .match-slot {
            background: rgba(95, 23, 235, 0.03);
            border-radius: var(--radius-sm);
            padding: 15px;
            border: 2px dashed rgba(95, 23, 235, 0.3);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
        }

        .match-slot.hover {
            border-color: var(--color-primary);
            background: rgba(95, 23, 235, 0.05);
            animation: glow 1s infinite;
        }

        .match-slot.filled {
            border: 2px solid var(--color-primary);
            background: rgba(95, 23, 235, 0.08);
        }

        .match-slot.correct {
            border-color: var(--color-success);
            background: rgba(16, 185, 129, 0.1);
        }

        .match-slot.incorrect {
            border-color: var(--color-error);
            background: rgba(239, 68, 68, 0.1);
        }

        .match-label {
            font-size: 0.75rem;
            color: var(--color-primary);
            text-align: center;
            margin-top: 5px;
            font-weight: 700;
        }

        /* Quiz Activity */
        .quiz-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .quiz-question {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(95, 23, 235, 0.1);
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            padding: 14px 16px;
            border-radius: var(--radius-sm);
            border: 2px solid rgba(95, 23, 235, 0.2);
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .quiz-option:hover {
            border-color: var(--color-primary);
            background: rgba(95, 23, 235, 0.05);
            transform: translateX(5px);
        }

        .quiz-option.selected {
            border-color: var(--color-primary);
            background: rgba(95, 23, 235, 0.1);
            font-weight: 600;
        }

        .quiz-option.correct {
            border-color: var(--color-success);
            background: rgba(16, 185, 129, 0.1);
        }

        .quiz-option.incorrect {
            border-color: var(--color-error);
            background: rgba(239, 68, 68, 0.1);
        }

        .option-label {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(95, 23, 235, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
            color: var(--color-primary);
            border: 1px solid rgba(95, 23, 235, 0.2);
        }

        .quiz-option.selected .option-label {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .quiz-option.correct .option-label {
            background: var(--color-success);
            color: white;
            border-color: var(--color-success);
        }

        /* Feedback */
        .feedback-container {
            background: rgba(95, 23, 235, 0.03);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 1px solid rgba(95, 23, 235, 0.15);
            margin-top: 20px;
            display: none;
            border-left: 4px solid var(--color-primary);
        }

        .feedback-container.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .feedback-title {
            font-size: 0.95rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .feedback-icon {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .feedback-icon.correct { 
            color: var(--color-success); 
        }
        
        .feedback-icon.incorrect { 
            color: var(--color-error); 
        }

        .feedback-content {
            font-size: 0.9rem;
            color: var(--color-text);
            line-height: 1.7;
        }

        .feedback-content strong { 
            color: var(--color-primary); 
            font-weight: 700;
        }

        .correction-details {
            background: rgba(239, 68, 68, 0.05);
            border-left: 3px solid var(--color-error);
            padding: 14px 18px;
            margin: 14px 0;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 28px;
            border-radius: var(--radius-md);
            border: none;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
            border: 2px solid var(--color-primary);
        }

        .btn-primary:hover {
            background: #4c0fcf;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(95, 23, 235, 0.4);
            animation: glow 1.5s infinite;
        }

        .btn-secondary {
            background: white;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .btn-secondary:hover {
            background: rgba(95, 23, 235, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(95, 23, 235, 0.2);
        }

        .btn-icon { 
            font-size: 1.2em; 
            font-weight: bold;
        }

        /* Results Panel */
        .results-panel {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: white;
            border-radius: var(--radius-md);
            padding: 40px;
            margin-top: 40px;
            display: none;
            animation: fadeInUp 0.6s ease;
            border: 2px solid var(--color-primary);
        }

        .results-panel.show { 
            display: block; 
            animation: glow 2s infinite;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .results-title {
            font-size: 1.6rem;
            font-weight: 800;
            color: white;
        }

        .score-display {
            font-size: 3.5rem;
            font-weight: 900;
            color: var(--color-primary);
            text-align: center;
            margin: 30px 0;
            text-shadow: 0 0 20px rgba(95, 23, 235, 0.7);
            animation: pulse 2s infinite;
        }

        .safety-insights {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 25px;
            margin-top: 25px;
            border-left: 4px solid var(--color-primary);
        }

        .insights-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .insights-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .insights-list li {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            font-size: 0.95rem;
            color: #e5e7eb;
            line-height: 1.6;
        }

        .insight-dot {
            width: 8px;
            height: 8px;
            margin-top: 10px;
            border-radius: 999px;
            background: var(--color-primary);
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <main class="page" aria-labelledby="module-heading">
        <!-- Header -->
        <header class="brand-row">
            <div class="brand">
                <img
                    src="https://lwfiles.mycourse.app/vadrivingclinic-public/9f5c6b8121721c8ef241f929fd983b3e.png"
                    alt="VA Driving Clinic logo"
                    class="brand-logo"
                />
                <div class="course-meta">
                    <span class="course-name">VA Driving Clinic ‚Ä¢ Module 1</span>
                    <div class="week-label">
                        <span class="week-label-dot"></span>
                        <span>Traffic Control & Road Safety</span>
                    </div>
                </div>
            </div>
            <span class="badge-mode">Interactive Learning</span>
        </header>

        <h1 id="module-heading">Master Traffic Control Systems</h1>
        <p class="module-subtitle">
            A comprehensive interactive module covering traffic signals, right-of-way rules, and intersection safety. 
            Learn through hands-on activities and simulations that reinforce safe driving practices. 
            Understanding these systems is crucial for preventing the 1.8+ million intersection crashes that occur annually.
        </p>

        <!-- Time Estimate Banner -->
        <div class="time-estimate-banner">
            <div class="time-estimate-icon">
                ‚è±Ô∏è
            </div>
            <div class="time-estimate-content">
                <h3>Module Time Estimate</h3>
                <p>Complete all 3 activities in approximately <span class="time-highlight">5 minutes</span>. This module is designed for focused, efficient learning with clear objectives and immediate feedback.</p>
            </div>
        </div>

        <!-- Stats Display -->
        <div class="stats-display">
            <div class="stat-card">
                <span class="stat-number" id="completed-count">0</span>
                <span class="stat-label">Activities Completed</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="accuracy-rate">0%</span>
                <span class="stat-label">Accuracy Rate</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="time-spent">0:00</span>
                <span class="stat-label">Time Learning</span>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-step active" data-step="1">
                <div class="step-circle">1</div>
                <div class="step-label">Traffic Lights</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-circle">2</div>
                <div class="step-label">Signal Matching</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-circle">3</div>
                <div class="step-label">Safety Quiz</div>
            </div>
        </div>

        <!-- Activity Grid -->
        <div class="activity-grid">
            <!-- Activity 1: Traffic Light Simulation -->
            <section class="activity-card" id="activity-1" data-activity="1">
                <div class="activity-header">
                    <span class="activity-number">Activity 1</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">Traffic Light Simulation & Response</h3>
                <p class="activity-description">
                    Interact with this realistic traffic light to understand the exact meaning and required response for each signal color. 
                    Practice proper stopping distances and learn about advanced features like sensors and timing systems.
                </p>

                <div class="activity-time-estimate">
                    <span class="activity-time-icon">‚è±Ô∏è</span>
                    <span class="activity-time-text">Estimated time: <strong>1-2 minutes</strong></span>
                </div>

                <div class="traffic-light-container">
                    <div class="traffic-light">
                        <div class="light red active" id="red-light"></div>
                        <div class="light yellow" id="yellow-light"></div>
                        <div class="light green" id="green-light"></div>
                    </div>
                    
                    <div class="light-label" id="light-instruction">üõë STOP - Come to a complete stop behind the stop line</div>
                    
                    <div class="light-actions">
                        <button class="light-btn" data-light="red">Red Light</button>
                        <button class="light-btn" data-light="yellow">Yellow Light</button>
                        <button class="light-btn" data-light="green">Green Light</button>
                        <button class="light-btn" data-light="cycle">Auto Cycle</button>
                    </div>
                </div>

                <!-- Feedback -->
                <div class="feedback-container" id="feedback-1">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">‚úì</span>
                        Traffic Light Mastery Achieved
                    </div>
                    <div class="feedback-content">
                        <strong>Correct Responses Verified:</strong><br><br>
                        ‚Ä¢ <strong>üõë Red Light:</strong> Complete stop required. In 2024, red light running caused 219,000 crashes.<br>
                        ‚Ä¢ <strong>üü° Yellow Light:</strong> Prepare to stop if safe. Light must be yellow as you exit intersection.<br>
                        ‚Ä¢ <strong>üü¢ Green Light:</strong> Proceed with caution after checking for pedestrians and clear path.<br><br>
                        
                        <strong>Safety Statistics:</strong> On average, a motorist runs a red light every 20 minutes at busy intersections during rush hour. 
                        Virginia law permits motorcycles to proceed after 120 seconds if sensors fail to detect them.
                    </div>
                </div>
            </section>

            <!-- Activity 2: Signal Matching -->
            <section class="activity-card" id="activity-2" data-activity="2">
                <div class="activity-header">
                    <span class="activity-number">Activity 2</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">Advanced Signal Recognition</h3>
                <p class="activity-description">
                    Match specialized traffic signals with their correct meanings. This activity covers arrow signals, 
                    flashing lights, pedestrian signals, and railroad crossings‚Äîessential knowledge for navigating complex intersections safely.
                </p>

                <div class="activity-time-estimate">
                    <span class="activity-time-icon">‚è±Ô∏è</span>
                    <span class="activity-time-text">Estimated time: <strong>1-2 minutes</strong></span>
                </div>

                <!-- Match Area -->
                <div class="match-area" id="match-area">
                    <div class="match-pair" data-pair="1">
                        <div class="match-slot" data-type="signal" id="slot-signal-1">
                            Drag signal here
                        </div>
                        <div class="match-slot" data-type="meaning" id="slot-meaning-1">
                            Drag meaning here
                        </div>
                        <div class="match-label">Pair 1</div>
                    </div>
                    <div class="match-pair" data-pair="2">
                        <div class="match-slot" data-type="signal" id="slot-signal-2">
                            Drag signal here
                        </div>
                        <div class="match-slot" data-type="meaning" id="slot-meaning-2">
                            Drag meaning here
                        </div>
                        <div class="match-label">Pair 2</div>
                    </div>
                    <div class="match-pair" data-pair="3">
                        <div class="match-slot" data-type="signal" id="slot-signal-3">
                            Drag signal here
                        </div>
                        <div class="match-slot" data-type="meaning" id="slot-meaning-3">
                            Drag meaning here
                        </div>
                        <div class="match-label">Pair 3</div>
                    </div>
                </div>

                <!-- Items to Drag -->
                <div class="signal-matching-grid">
                    <div class="matching-column" id="signals-column">
                        <div class="matching-column-title">Traffic Signals</div>
                        <div class="signal-item draggable" data-signal="flashing-red" draggable="true">Flashing Red Light</div>
                        <div class="signal-item draggable" data-signal="flashing-yellow" draggable="true">Flashing Yellow Light</div>
                        <div class="signal-item draggable" data-signal="green-arrow" draggable="true">Green Arrow</div>
                        <div class="signal-item draggable" data-signal="red-arrow" draggable="true">Red Arrow</div>
                        <div class="signal-item draggable" data-signal="pedestrian-walk" draggable="true">"Walk" Signal</div>
                        <div class="signal-item draggable" data-signal="railroad-flashing" draggable="true">Railroad Flashing Lights</div>
                    </div>
                    <div class="matching-column" id="meanings-column">
                        <div class="matching-column-title">Meanings</div>
                        <div class="signal-item draggable" data-meaning="flashing-red" draggable="true">Treat as stop sign</div>
                        <div class="signal-item draggable" data-meaning="flashing-yellow" draggable="true">Proceed with caution</div>
                        <div class="signal-item draggable" data-meaning="green-arrow" draggable="true">Protected turn allowed</div>
                        <div class="signal-item draggable" data-meaning="red-arrow" draggable="true">No turn in this direction</div>
                        <div class="signal-item draggable" data-meaning="pedestrian-walk" draggable="true">Pedestrians may cross</div>
                        <div class="signal-item draggable" data-meaning="railroad-flashing" draggable="true">Stop, train approaching</div>
                    </div>
                </div>

                <!-- Feedback -->
                <div class="feedback-container" id="feedback-2">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">‚úì</span>
                        Signal Matching Complete
                    </div>
                    <div class="feedback-content">
                        <strong>Correct Matches:</strong><br>
                        ‚Ä¢ <strong>Flashing Red Light</strong> ‚Üí Treat as stop sign<br>
                        ‚Ä¢ <strong>Flashing Yellow Light</strong> ‚Üí Proceed with caution<br>
                        ‚Ä¢ <strong>Green Arrow</strong> ‚Üí Protected turn allowed<br>
                        ‚Ä¢ <strong>Red Arrow</strong> ‚Üí No turn in this direction<br>
                        ‚Ä¢ <strong>"Walk" Signal</strong> ‚Üí Pedestrians may cross<br>
                        ‚Ä¢ <strong>Railroad Flashing Lights</strong> ‚Üí Stop, train approaching<br><br>
                        
                        <strong>Safety Application:</strong> Specialized signals like railroad crossings and pedestrian 
                        signals require extra attention. Always yield to pedestrians and never drive around lowered crossing gates.
                    </div>
                </div>
            </section>

            <!-- Activity 3: Safety Quiz -->
            <section class="activity-card" id="activity-3" data-activity="3">
                <div class="activity-header">
                    <span class="activity-number">Activity 3</span>
                    <span class="activity-status">Not Started</span>
                </div>
                <h3 class="activity-title">Road Safety Knowledge Check</h3>
                <p class="activity-description">
                    Test your understanding of traffic control principles with this multiple-choice quiz.
                    Select the best answer for each question based on the information covered in this module.
                </p>

                <div class="activity-time-estimate">
                    <span class="activity-time-icon">‚è±Ô∏è</span>
                    <span class="activity-time-text">Estimated time: <strong>1-2 minutes</strong></span>
                </div>

                <div class="quiz-container" id="quiz-container">
                    <!-- Question 1 -->
                    <div class="quiz-question">1. What should you do when approaching a yellow traffic light?</div>
                    <div class="quiz-options">
                        <div class="quiz-option" data-question="1" data-option="A">
                            <span class="option-label">A</span>
                            <span>Speed up to clear the intersection before it turns red</span>
                        </div>
                        <div class="quiz-option" data-question="1" data-option="B">
                            <span class="option-label">B</span>
                            <span>Prepare to stop if it's safe to do so</span>
                        </div>
                        <div class="quiz-option" data-question="1" data-option="C">
                            <span class="option-label">C</span>
                            <span>Continue at your current speed</span>
                        </div>
                        <div class="quiz-option" data-question="1" data-option="D">
                            <span class="option-label">D</span>
                            <span>Honk your horn and proceed quickly</span>
                        </div>
                    </div>

                    <!-- Question 2 -->
                    <div class="quiz-question">2. If a traffic signal isn't detecting your motorcycle, Virginia law allows you to:</div>
                    <div class="quiz-options">
                        <div class="quiz-option" data-question="2" data-option="A">
                            <span class="option-label">A</span>
                            <span>Proceed immediately if no traffic is visible</span>
                        </div>
                        <div class="quiz-option" data-question="2" data-option="B">
                            <span class="option-label">B</span>
                            <span>Wait 120 seconds or two complete light cycles, then proceed with caution</span>
                        </div>
                        <div class="quiz-option" data-question="2" data-option="C">
                            <span class="option-label">C</span>
                            <span>Back up and find another route</span>
                        </div>
                        <div class="quiz-option" data-question="2" data-option="D">
                            <span class="option-label">D</span>
                            <span>Flash your high beams to trigger the sensor</span>
                        </div>
                    </div>

                    <!-- Question 3 -->
                    <div class="quiz-question">3. What is the primary purpose of a flashing yellow traffic light?</div>
                    <div class="quiz-options">
                        <div class="quiz-option" data-question="3" data-option="A">
                            <span class="option-label">A</span>
                            <span>To signal an emergency vehicle is approaching</span>
                        </div>
                        <div class="quiz-option" data-question="3" data-option="B">
                            <span class="option-label">B</span>
                            <span>To indicate the intersection is closed</span>
                        </div>
                        <div class="quiz-option" data-question="3" data-option="C">
                            <span class="option-label">C</span>
                            <span>To warn drivers to proceed with caution</span>
                        </div>
                        <div class="quiz-option" data-question="3" data-option="D">
                            <span class="option-label">D</span>
                            <span>To mark a school zone during active hours</span>
                        </div>
                    </div>
                </div>

                <!-- Feedback -->
                <div class="feedback-container" id="feedback-3">
                    <div class="feedback-title">
                        <span class="feedback-icon correct">‚úì</span>
                        Quiz Results
                    </div>
                    <div class="feedback-content">
                        <strong>Correct Answers:</strong><br>
                        1. <strong>B - Prepare to stop if it's safe to do so</strong><br>
                        2. <strong>B - Wait 120 seconds or two complete light cycles, then proceed with caution</strong><br>
                        3. <strong>C - To warn drivers to proceed with caution</strong><br><br>
                        
                        <strong>Key Takeaways:</strong><br>
                        ‚Ä¢ Yellow lights mean prepare to stop, not accelerate.<br>
                        ‚Ä¢ Virginia law provides specific guidance for motorcycles at malfunctioning signals.<br>
                        ‚Ä¢ Flashing yellow signals require caution but don't mandate a full stop.<br><br>
                        
                        <div class="correction-details" id="correction-details-3" style="display: none;">
                            <strong>Review These Areas:</strong><br>
                            <span id="correction-text-3"></span>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-secondary" id="reset-all-btn">
                <span class="btn-icon">‚Üª</span>
                Reset All Activities
            </button>
            <button class="btn btn-secondary" id="check-answers-btn">
                <span class="btn-icon">‚úì</span>
                Check All Answers
            </button>
            <button class="btn btn-primary" id="view-results-btn">
                <span class="btn-icon">üìä</span>
                View Final Results
            </button>
        </div>

        <!-- Results Panel -->
        <div class="results-panel" id="results-panel">
            <div class="results-header">
                <h2 class="results-title">Traffic Control Proficiency</h2>
                <div class="score-display" id="final-score">0%</div>
            </div>
            
            <div class="safety-insights">
                <h3 class="insights-title">
                    <span>üö¶</span> Traffic Safety Insights
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Intersection Safety:</strong> Over 1.8 million intersection crashes occurred in the U.S. in 2024, with approximately 219,000 attributed to red light running. Proper understanding of traffic signals could prevent many of these incidents.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Defensive Driving:</strong> Always maintain a safe following distance that allows you to see where the front vehicle's rear tires meet the pavement. This provides an escape route if the vehicle behind cannot stop in time.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Pedestrian Priority:</strong> When turning at intersections, always yield to pedestrians in crosswalks, even if you have a green light. Pedestrian signals are designed to coordinate with traffic lights for safe crossing.</span>
                    </li>
                </ul>
            </div>
            
            <div class="safety-insights" style="margin-top: 20px;">
                <h3 class="insights-title">
                    <span>üìö</span> Advanced Signal Knowledge
                </h3>
                <ul class="insights-list">
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Specialized Signals:</strong> Railroad crossing signals, school zone flashers, and emergency vehicle pre-emption systems are designed for specific safety scenarios. Understanding these reduces confusion and improves reaction time.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Right-of-Way Rules:</strong> Green arrows provide protected turns, but you must still check for pedestrians. Red arrows prohibit movement in that direction even if the main light is green.</span>
                    </li>
                    <li>
                        <span class="insight-dot"></span>
                        <span><strong>Technology Integration:</strong> Modern traffic systems include sensors, countdown timers, and adaptive signals that respond to traffic flow. Awareness of these features helps drivers make safer decisions.</span>
                    </li>
                </ul>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // State Management
            const state = {
                activities: {
                    1: { completed: false, correct: 0, total: 3, score: 0 },
                    2: { completed: false, correct: 0, total: 6, score: 0, matches: {} },
                    3: { completed: false, correct: 0, total: 3, score: 0, answers: {} }
                },
                startedAt: new Date(),
                timeSpent: 0
            };

            // Correct answers for Activity 2 (signal matching)
            const correctMatches = {
                'flashing-red': 'flashing-red',
                'flashing-yellow': 'flashing-yellow',
                'green-arrow': 'green-arrow',
                'red-arrow': 'red-arrow',
                'pedestrian-walk': 'pedestrian-walk',
                'railroad-flashing': 'railroad-flashing'
            };

            // Correct answers for Activity 3 (quiz)
            const quizAnswers = {
                1: 'B',
                2: 'B',
                3: 'C'
            };

            // DOM Elements
            const progressSteps = document.querySelectorAll('.progress-step');
            const activityCards = document.querySelectorAll('.activity-card');
            const completedCount = document.getElementById('completed-count');
            const accuracyRate = document.getElementById('accuracy-rate');
            const timeSpentEl = document.getElementById('time-spent');
            const resetBtn = document.getElementById('reset-all-btn');
            const checkBtn = document.getElementById('check-answers-btn');
            const resultsBtn = document.getElementById('view-results-btn');
            const resultsPanel = document.getElementById('results-panel');
            const finalScore = document.getElementById('final-score');

            // Timer for time spent
            function updateTimer() {
                const now = new Date();
                const diff = Math.floor((now - state.startedAt) / 1000);
                state.timeSpent = diff;
                const minutes = Math.floor(diff / 60);
                const seconds = diff % 60;
                timeSpentEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // Update stats display
                let completed = 0;
                let totalCorrect = 0;
                let totalItems = 0;
                
                Object.values(state.activities).forEach(activity => {
                    if (activity.completed) completed++;
                    totalCorrect += activity.correct;
                    totalItems += activity.total;
                });
                
                completedCount.textContent = completed;
                const accuracy = totalItems > 0 ? Math.round((totalCorrect / totalItems) * 100) : 0;
                accuracyRate.textContent = `${accuracy}%`;
            }

            setInterval(updateTimer, 1000);

            // Update Progress Summary
            function updateProgressSummary() {
                let completed = 0;
                let totalCorrect = 0;
                let totalItems = 0;
                
                Object.values(state.activities).forEach(activity => {
                    if (activity.completed) completed++;
                    totalCorrect += activity.correct;
                    totalItems += activity.total;
                });

                // Update progress steps
                progressSteps.forEach((step, index) => {
                    if (index < completed) {
                        step.classList.add('completed');
                        step.classList.remove('active');
                    } else if (index === completed) {
                        step.classList.add('active');
                        step.classList.remove('completed');
                    } else {
                        step.classList.remove('active', 'completed');
                    }
                });
            }

            // Activity 1: Traffic Light Simulation
            function initActivity1() {
                const redLight = document.getElementById('red-light');
                const yellowLight = document.getElementById('yellow-light');
                const greenLight = document.getElementById('green-light');
                const instruction = document.getElementById('light-instruction');
                const lightBtns = document.querySelectorAll('.light-btn');
                const status = document.querySelector('#activity-1 .activity-status');
                const feedback = document.getElementById('feedback-1');
                
                let interactions = 0;
                
                // Light responses
                const lightResponses = {
                    red: { instruction: "üõë STOP - Come to a complete stop behind the stop line or crosswalk.", safety: "Red light running causes approximately 219,000 crashes annually in the U.S." },
                    yellow: { instruction: "üü° CAUTION - Prepare to stop if safe to do so. Do not speed up.", safety: "The light must still be yellow as you exit the intersection to avoid running a red light." },
                    green: { instruction: "üü¢ GO - Proceed with caution after checking for pedestrians and clear intersection.", safety: "Even with a green light, check both directions before entering the intersection." }
                };
                
                // Set active light
                function setActiveLight(light) {
                    // Reset all lights
                    redLight.classList.remove('active');
                    yellowLight.classList.remove('active');
                    greenLight.classList.remove('active');
                    
                    // Activate selected light
                    if (light === 'red') {
                        redLight.classList.add('active');
                        instruction.textContent = lightResponses.red.instruction;
                    } else if (light === 'yellow') {
                        yellowLight.classList.add('active');
                        instruction.textContent = lightResponses.yellow.instruction;
                    } else if (light === 'green') {
                        greenLight.classList.add('active');
                        instruction.textContent = lightResponses.green.instruction;
                    }
                    
                    // Track interactions
                    interactions++;
                    if (interactions >= 3 && !state.activities[1].completed) {
                        state.activities[1].completed = true;
                        state.activities[1].correct = 3;
                        state.activities[1].score = 100;
                        status.textContent = 'Completed';
                        status.style.color = '#10b981';
                        document.querySelector('#activity-1').classList.add('completed');
                        feedback.classList.add('show');
                        updateProgressSummary();
                    }
                }
                
                // Cycle through lights
                function cycleLights() {
                    const lights = ['red', 'yellow', 'green'];
                    let current = 0;
                    
                    // Set initial
                    setActiveLight(lights[current]);
                    
                    // Cycle every 2 seconds
                    const interval = setInterval(() => {
                        current = (current + 1) % lights.length;
                        setActiveLight(lights[current]);
                        
                        // Stop after 3 full cycles
                        if (current === 0 && interactions >= 9) {
                            clearInterval(interval);
                        }
                    }, 2000);
                }
                
                // Button event listeners
                lightBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const light = this.dataset.light;
                        
                        if (light === 'cycle') {
                            cycleLights();
                        } else {
                            setActiveLight(light);
                        }
                    });
                });
                
                // Initialize with red light
                setActiveLight('red');
            }

            // Activity 2: Signal Matching
            function initActivity2() {
                const draggableItems = document.querySelectorAll('#activity-2 .signal-item');
                const matchSlots = document.querySelectorAll('#activity-2 .match-slot');
                const feedback = document.getElementById('feedback-2');
                const status = document.querySelector('#activity-2 .activity-status');
                
                let placedItems = 0;
                let userMatches = {};
                
                // Make all items draggable
                draggableItems.forEach(item => {
                    item.addEventListener('dragstart', function(e) {
                        const type = this.dataset.signal ? 'signal' : 'meaning';
                        const id = this.dataset.signal || this.dataset.meaning;
                        
                        e.dataTransfer.setData('text/plain', JSON.stringify({
                            type: type,
                            id: id,
                            text: this.textContent
                        }));
                        
                        this.classList.add('dragging');
                    });
                    
                    item.addEventListener('dragend', function() {
                        this.classList.remove('dragging');
                    });
                });
                
                // Setup match slots
                matchSlots.forEach(slot => {
                    slot.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        if (!this.classList.contains('filled')) {
                            this.classList.add('hover');
                        }
                    });
                    
                    slot.addEventListener('dragleave', function() {
                        this.classList.remove('hover');
                    });
                    
                    slot.addEventListener('drop', function(e) {
                        e.preventDefault();
                        this.classList.remove('hover');
                        
                        if (this.classList.contains('filled')) return;
                        
                        const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                        const slotType = this.dataset.type;
                        
                        // Check if this type of item can go in this slot
                        if (data.type !== slotType) {
                            this.classList.add('incorrect');
                            setTimeout(() => {
                                this.classList.remove('incorrect');
                            }, 500);
                            return;
                        }
                        
                        // Check if this item is already placed elsewhere
                        const alreadyPlaced = Array.from(matchSlots).some(slot => 
                            slot.textContent.includes(data.text)
                        );
                        
                        if (alreadyPlaced) return;
                        
                        // Place the item
                        this.classList.add('filled');
                        this.innerHTML = `<strong>${data.text}</strong>`;
                        this.dataset.itemId = data.id;
                        
                        // Hide the original draggable item
                        const originalItem = data.type === 'signal'
                            ? document.querySelector(`[data-signal="${data.id}"]`)
                            : document.querySelector(`[data-meaning="${data.id}"]`);
                        
                        if (originalItem) {
                            originalItem.style.display = 'none';
                            placedItems++;
                        }
                        
                        // Record the placement
                        const pairNumber = this.closest('.match-pair').dataset.pair;
                        if (!userMatches[pairNumber]) {
                            userMatches[pairNumber] = {};
                        }
                        
                        userMatches[pairNumber][slotType] = data.id;
                        
                        // Check if pair is complete and validate
                        if (userMatches[pairNumber].signal && userMatches[pairNumber].meaning) {
                            const isCorrect = userMatches[pairNumber].signal === userMatches[pairNumber].meaning;
                            const signalSlot = document.querySelector(`#slot-signal-${pairNumber}`);
                            const meaningSlot = document.querySelector(`#slot-meaning-${pairNumber}`);
                            
                            if (isCorrect) {
                                signalSlot.classList.add('correct');
                                meaningSlot.classList.add('correct');
                            } else {
                                signalSlot.classList.add('incorrect');
                                meaningSlot.classList.add('incorrect');
                                
                                setTimeout(() => {
                                    signalSlot.classList.remove('incorrect');
                                    meaningSlot.classList.remove('incorrect');
                                }, 1000);
                            }
                            
                            state.activities[2].matches = userMatches;
                        }
                        
                        // Check if all items are placed
                        if (placedItems === 12) { // 6 signals + 6 meanings
                            checkActivity2();
                        }
                    });
                });
                
                function checkActivity2() {
                    let correctCount = 0;
                    
                    // Check each pair
                    Object.keys(userMatches).forEach(pairNumber => {
                        const pair = userMatches[pairNumber];
                        if (pair.signal && pair.meaning) {
                            const isCorrect = pair.signal === pair.meaning;
                            if (isCorrect) {
                                correctCount += 2; // Both items in the pair are correct
                            }
                        }
                    });
                    
                    state.activities[2].completed = true;
                    state.activities[2].correct = correctCount;
                    state.activities[2].score = Math.round((correctCount / 12) * 100);
                    
                    status.textContent = 'Completed';
                    status.style.color = '#10b981';
                    document.querySelector('#activity-2').classList.add('completed');
                    feedback.classList.add('show');
                    
                    updateProgressSummary();
                }
            }

            // Activity 3: Safety Quiz
            function initActivity3() {
                const quizOptions = document.querySelectorAll('#activity-3 .quiz-option');
                const feedback = document.getElementById('feedback-3');
                const status = document.querySelector('#activity-3 .activity-status');
                const correctionDetails = document.getElementById('correction-details-3');
                const correctionText = document.getElementById('correction-text-3');
                
                let answeredQuestions = 0;
                
                quizOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const question = this.dataset.question;
                        const selectedOption = this.dataset.option;
                        
                        // Remove selected class from all options for this question
                        const allOptionsForQuestion = document.querySelectorAll(`[data-question="${question}"]`);
                        allOptionsForQuestion.forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        // Add selected class to clicked option
                        this.classList.add('selected');
                        
                        // Store the answer
                        state.activities[3].answers[question] = selectedOption;
                        
                        // Check if all questions are answered
                        answeredQuestions = Object.keys(state.activities[3].answers).length;
                        if (answeredQuestions === 3 && !state.activities[3].completed) {
                            checkActivity3();
                        }
                    });
                });
                
                function checkActivity3() {
                    let correctCount = 0;
                    let correctionMessages = [];
                    
                    // Check each answer
                    Object.keys(quizAnswers).forEach(question => {
                        const userAnswer = state.activities[3].answers[question];
                        const correctAnswer = quizAnswers[question];
                        
                        if (userAnswer === correctAnswer) {
                            correctCount++;
                            
                            // Mark correct option
                            const correctOption = document.querySelector(`[data-question="${question}"][data-option="${correctAnswer}"]`);
                            correctOption.classList.add('correct');
                        } else {
                            // Mark incorrect user selection
                            const userOption = document.querySelector(`[data-question="${question}"][data-option="${userAnswer}"]`);
                            if (userOption) userOption.classList.add('incorrect');
                            
                            // Mark correct answer
                            const correctOption = document.querySelector(`[data-question="${question}"][data-option="${correctAnswer}"]`);
                            correctOption.classList.add('correct');
                            
                            // Add correction message
                            const questionText = document.querySelector(`#activity-3 .quiz-question:nth-of-type(${question})`).textContent;
                            correctionMessages.push(`‚Ä¢ Question ${question}: You selected ${userAnswer}, correct answer is ${correctAnswer}`);
                        }
                    });
                    
                    state.activities[3].completed = true;
                    state.activities[3].correct = correctCount;
                    state.activities[3].score = Math.round((correctCount / 3) * 100);
                    
                    status.textContent = 'Completed';
                    status.style.color = '#10b981';
                    document.querySelector('#activity-3').classList.add('completed');
                    feedback.classList.add('show');
                    
                    if (correctionMessages.length > 0) {
                        correctionDetails.style.display = 'block';
                        correctionText.innerHTML = correctionMessages.join('<br>');
                    }
                    
                    updateProgressSummary();
                }
            }

            // Reset All Activities
            function resetAllActivities() {
                // Reset state
                Object.keys(state.activities).forEach(key => {
                    state.activities[key] = {
                        completed: false,
                        correct: 0,
                        total: parseInt(key) === 1 ? 3 : parseInt(key) === 2 ? 12 : 3,
                        score: 0,
                        matches: {},
                        answers: {}
                    };
                });
                
                // Reset UI
                activityCards.forEach(card => {
                    card.classList.remove('completed');
                    const status = card.querySelector('.activity-status');
                    status.textContent = 'Not Started';
                    status.style.color = '';
                    const feedback = card.querySelector('.feedback-container');
                    feedback.classList.remove('show');
                });
                
                // Reset Activity 1
                const redLight = document.getElementById('red-light');
                const yellowLight = document.getElementById('yellow-light');
                const greenLight = document.getElementById('green-light');
                const instruction = document.getElementById('light-instruction');
                
                redLight.classList.add('active');
                yellowLight.classList.remove('active');
                greenLight.classList.remove('active');
                instruction.textContent = 'üõë STOP - Come to a complete stop behind the stop line';
                
                // Reset Activity 2
                document.querySelectorAll('#activity-2 .signal-item').forEach(item => {
                    item.style.display = '';
                    item.classList.remove('dragging', 'matched', 'incorrect');
                });
                
                document.querySelectorAll('#activity-2 .match-slot').forEach(slot => {
                    slot.classList.remove('filled', 'correct', 'incorrect', 'hover');
                    slot.innerHTML = slot.dataset.type === 'signal' ? 'Drag signal here' : 'Drag meaning here';
                    delete slot.dataset.itemId;
                });
                
                // Reset Activity 3
                document.querySelectorAll('#activity-3 .quiz-option').forEach(option => {
                    option.classList.remove('selected', 'correct', 'incorrect');
                });
                
                const correctionDetails = document.getElementById('correction-details-3');
                if (correctionDetails) correctionDetails.style.display = 'none';
                
                // Reset results
                resultsPanel.classList.remove('show');
                
                // Reset timer
                state.startedAt = new Date();
                state.timeSpent = 0;
                updateTimer();
                
                // Update progress
                updateProgressSummary();
            }

            // Check All Answers
            function checkAllAnswers() {
                // Force check all activities
                if (!state.activities[1].completed) {
                    state.activities[1].completed = true;
                    state.activities[1].correct = 3;
                    state.activities[1].score = 100;
                    document.querySelector('#activity-1 .activity-status').textContent = 'Completed';
                    document.querySelector('#activity-1').classList.add('completed');
                    document.querySelector('#feedback-1').classList.add('show');
                }
                
                if (!state.activities[2].completed) {
                    // Auto-match all pairs
                    const pairs = document.querySelectorAll('#activity-2 .match-pair');
                    pairs.forEach((pair, index) => {
                        const pairNum = index + 1;
                        const signals = ['flashing-red', 'flashing-yellow', 'green-arrow', 'red-arrow', 'pedestrian-walk', 'railroad-flashing'];
                        const meanings = ['flashing-red', 'flashing-yellow', 'green-arrow', 'red-arrow', 'pedestrian-walk', 'railroad-flashing'];
                        
                        if (signals[pairNum-1] && meanings[pairNum-1]) {
                            const signalSlot = document.querySelector(`#slot-signal-${pairNum}`);
                            const meaningSlot = document.querySelector(`#slot-meaning-${pairNum}`);
                            
                            const signalText = document.querySelector(`[data-signal="${signals[pairNum-1]}"]`).textContent;
                            const meaningText = document.querySelector(`[data-meaning="${meanings[pairNum-1]}"]`).textContent;
                            
                            signalSlot.innerHTML = `<strong>${signalText}</strong>`;
                            signalSlot.classList.add('filled', 'correct');
                            signalSlot.dataset.itemId = signals[pairNum-1];
                            
                            meaningSlot.innerHTML = `<strong>${meaningText}</strong>`;
                            meaningSlot.classList.add('filled', 'correct');
                            meaningSlot.dataset.itemId = meanings[pairNum-1];
                            
                            // Hide draggable items
                            document.querySelector(`[data-signal="${signals[pairNum-1]}"]`).style.display = 'none';
                            document.querySelector(`[data-meaning="${meanings[pairNum-1]}"]`).style.display = 'none';
                        }
                    });
                    
                    state.activities[2].completed = true;
                    state.activities[2].correct = 12;
                    state.activities[2].score = 100;
                    document.querySelector('#activity-2 .activity-status').textContent = 'Completed';
                    document.querySelector('#activity-2').classList.add('completed');
                    document.querySelector('#feedback-2').classList.add('show');
                }
                
                if (!state.activities[3].completed) {
                    // Auto-select correct answers
                    Object.keys(quizAnswers).forEach(question => {
                        const correctOption = document.querySelector(`[data-question="${question}"][data-option="${quizAnswers[question]}"]`);
                        if (correctOption) {
                            correctOption.classList.add('selected', 'correct');
                            state.activities[3].answers[question] = quizAnswers[question];
                        }
                    });
                    
                    state.activities[3].completed = true;
                    state.activities[3].correct = 3;
                    state.activities[3].score = 100;
                    document.querySelector('#activity-3 .activity-status').textContent = 'Completed';
                    document.querySelector('#activity-3').classList.add('completed');
                    document.querySelector('#feedback-3').classList.add('show');
                }
                
                updateProgressSummary();
            }

            // View Final Results
            function viewFinalResults() {
                let totalScore = 0;
                let activityCount = 0;
                
                Object.values(state.activities).forEach(activity => {
                    if (activity.completed) {
                        totalScore += activity.score;
                        activityCount++;
                    }
                });
                
                const averageScore = activityCount > 0 ? Math.round(totalScore / activityCount) : 0;
                finalScore.textContent = `${averageScore}%`;
                
                resultsPanel.classList.add('show');
                resultsPanel.scrollIntoView({ behavior: 'smooth' });
            }

            // Initialize all activities
            initActivity1();
            initActivity2();
            initActivity3();

            // Event listeners
            resetBtn.addEventListener('click', resetAllActivities);
            checkBtn.addEventListener('click', checkAllAnswers);
            resultsBtn.addEventListener('click', viewFinalResults);

            // Initial progress update
            updateTimer();
            updateProgressSummary();
        });
    </script>
</body>
</html>
